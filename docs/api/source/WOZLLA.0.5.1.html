<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">var WOZLLA;
(function (WOZLLA) {
    var event;
    (function (event) {
<span id='WOZLLA-event-EventPhase'>        /**
</span>         * @enum {number} WOZLLA.event.EventPhase
         * all enumerations of event phase
         */
        (function (EventPhase) {
<span id='WOZLLA-event-EventPhase-property-CAPTURE'>            /** @property {number} [CAPTURE] */
</span>            EventPhase[EventPhase[&quot;CAPTURE&quot;] = 0] = &quot;CAPTURE&quot;;
<span id='WOZLLA-event-EventPhase-property-BUBBLE'>            /** @property {number} [BUBBLE] */
</span>            EventPhase[EventPhase[&quot;BUBBLE&quot;] = 1] = &quot;BUBBLE&quot;;
<span id='WOZLLA-event-EventPhase-property-TARGET'>            /** @property {number} [TARGET] */
</span>            EventPhase[EventPhase[&quot;TARGET&quot;] = 2] = &quot;TARGET&quot;;
        })(event.EventPhase || (event.EventPhase = {}));
        var EventPhase = event.EventPhase;
<span id='WOZLLA-event-Event'>        /**
</span>         * @class WOZLLA.event.Event
         * Base class for all event object of WOZLLA engine.    &lt;br/&gt;
         * see also:    &lt;br/&gt;
         * {@link WOZLLA.event.EventPhase}  &lt;br/&gt;
         * {@link WOZLLA.event.EventDispatcher}     &lt;br/&gt;
         */
        var Event = (function () {
<span id='WOZLLA-event-Event-method-constructor'>            /**
</span>             * @method constructor
             * create a new Event object
             * @member WOZLLA.event.Event
             * @param {string} type
             * @param {boolean} bubbles
             * @param {any} data
             * @param {boolean} canStopBubbles
             */
            function Event(type, bubbles, data, canStopBubbles) {
                if (bubbles === void 0) { bubbles = false; }
                if (data === void 0) { data = null; }
                if (canStopBubbles === void 0) { canStopBubbles = true; }
                this._eventPhase = 0 /* CAPTURE */;
                this._immediatePropagationStoped = false;
                this._propagationStoped = false;
                this._listenerRemove = false;
                this._type = type;
                this._bubbles = bubbles;
                this._data = data;
                this._canStopBubbles = canStopBubbles;
            }
            Object.defineProperty(Event.prototype, &quot;data&quot;, {
<span id='WOZLLA-event-Event-property-data'>                /**
</span>                 * event data.
                 * @member WOZLLA.event.Event
                 * @property {any} data
                 * @readonly
                 */
                get: function () {
                    return this._data;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Event.prototype, &quot;type&quot;, {
<span id='WOZLLA-event-Event-property-type'>                /**
</span>                 * event type.
                 * @member WOZLLA.event.Event
                 * @property {string} type
                 * @readonly
                 */
                get: function () {
                    return this._type;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Event.prototype, &quot;target&quot;, {
<span id='WOZLLA-event-Event-property-target'>                /**
</span>                 * event origin target.
                 * @member WOZLLA.event.Event
                 * @property {WOZLLA.event.EventDispatcher} target
                 * @readonly
                 */
                get: function () {
                    return this._target;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Event.prototype, &quot;currentTarget&quot;, {
<span id='WOZLLA-event-Event-property-currentTarget'>                /**
</span>                 * current event target in event bubbling.
                 * @member WOZLLA.event.Event
                 * @property {WOZLLA.event.EventDispatcher} currentTarget
                 * @readonly
                 */
                get: function () {
                    return this._currentTarget;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Event.prototype, &quot;eventPhase&quot;, {
<span id='WOZLLA-event-Event-property-eventPhase'>                /**
</span>                 * which phase this event is in.
                 * @member WOZLLA.event.Event
                 * @property {WOZLLA.event.EventPhase} eventPhase
                 * @readonly
                 */
                get: function () {
                    return this._eventPhase;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Event.prototype, &quot;bubbles&quot;, {
<span id='WOZLLA-event-Event-property-bubbles'>                /**
</span>                 * true to identify this event could be bubbled, false otherwise.
                 * @member WOZLLA.event.Event
                 * @property {boolean} bubbles
                 * @readonly
                 */
                get: function () {
                    return this._bubbles;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Event.prototype, &quot;canStopBubbles&quot;, {
<span id='WOZLLA-event-Event-property-canStopBubbles'>                /**
</span>                 * true to identify this event could be stop bubbles, false otherwise.
                 * @member WOZLLA.event.Event
                 * @property {boolean} canStopBubbles
                 * @readonly
                 */
                get: function () {
                    return this._canStopBubbles;
                },
                enumerable: true,
                configurable: true
            });
<span id='WOZLLA-event-Event-method-isStopPropagation'>            /**
</span>             * @method isStopPropagation
             * @member WOZLLA.event.Event
             * @returns {boolean}
             */
            Event.prototype.isStopPropagation = function () {
                return this._propagationStoped;
            };
<span id='WOZLLA-event-Event-method-stopPropagation'>            /**
</span>             * stop bubble to next parent
             * @method stopPropagation
             * @member WOZLLA.event.Event
             */
            Event.prototype.stopPropagation = function () {
                if (!this._canStopBubbles) {
                    return;
                }
                this._propagationStoped = true;
            };
<span id='WOZLLA-event-Event-method-isStopImmediatePropagation'>            /**
</span>             * @method isStopImmediatePropagation
             * @member WOZLLA.event.Event
             * @returns {boolean}
             */
            Event.prototype.isStopImmediatePropagation = function () {
                return this._immediatePropagationStoped;
            };
<span id='WOZLLA-event-Event-method-stopImmediatePropagation'>            /**
</span>             * stop event bubble immediately even other listeners dosen&#39;t receive this event.
             * @method stopImmediatePropagation
             * @member WOZLLA.event.Event
             */
            Event.prototype.stopImmediatePropagation = function () {
                if (!this._canStopBubbles) {
                    return;
                }
                this._immediatePropagationStoped = true;
                this._propagationStoped = true;
            };
<span id='WOZLLA-event-Event-method-removeCurrentListener'>            /**
</span>             * call from current listener to remove the current listener
             */
            Event.prototype.removeCurrentListener = function () {
                this._listenerRemove = true;
            };
            return Event;
        })();
        event.Event = Event;
    })(event = WOZLLA.event || (WOZLLA.event = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Event.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var event;
    (function (_event) {
        var ListenerList = (function () {
            function ListenerList() {
                this._listeners = [];
            }
            ListenerList.prototype.add = function (listener) {
                this._listeners.push(listener);
            };
            ListenerList.prototype.remove = function (listener) {
                var i, len = this._listeners.length;
                for (i = 0; i &lt; len; i++) {
                    if (this._listeners[i] === listener) {
                        this._listeners.splice(i, 1);
                        return true;
                    }
                }
                return false;
            };
            ListenerList.prototype.removeAt = function (idx) {
                return this._listeners.splice(idx, 1);
            };
            ListenerList.prototype.get = function (idx) {
                return this._listeners[idx];
            };
            ListenerList.prototype.length = function () {
                return this._listeners.length;
            };
            ListenerList.prototype.clear = function () {
                this._listeners.length = 0;
            };
            return ListenerList;
        })();
<span id='WOZLLA-event-EventDispatcher'>        /**
</span>         * @class WOZLLA.event.EventDispatcher
         * Base class for bubblable event system
         *
         */
        var EventDispatcher = (function () {
            function EventDispatcher() {
                this._captureDict = {};
                this._bubbleDict = {};
            }
<span id='WOZLLA-event-EventDispatcher-method-setBubbleParent'>            /**
</span>             * @method setBubbleParent
             * set bubble parent of this dispatcher
             * @param {WOZLLA.event.EventDispatcher} bubbleParent
             */
            EventDispatcher.prototype.setBubbleParent = function (bubbleParent) {
                this._bubbleParent = bubbleParent;
            };
<span id='WOZLLA-event-EventDispatcher-method-hasListener'>            /**
</span>             * @method hasListener
             * @param {string} type
             * @param {boolean} useCapture true to check capture phase, false to check bubble and target phases.
             */
            EventDispatcher.prototype.hasListener = function (type, useCapture) {
                if (useCapture === void 0) { useCapture = false; }
                return this._getListenerList(type, useCapture).length() &gt; 0;
            };
<span id='WOZLLA-event-EventDispatcher-method-getListenerCount'>            /**
</span>             * @method getListenerCount
             * @param {string} type
             * @param {boolean} useCapture true to check capture phase, false to check bubble and target phases.
             * @returns {number}
             */
            EventDispatcher.prototype.getListenerCount = function (type, useCapture) {
                return this._getListenerList(type, useCapture).length();
            };
<span id='WOZLLA-event-EventDispatcher-method-addListener'>            /**
</span>             * @method addListener
             * @param {string} type
             * @param {boolean} useCapture true to check capture phase, false to check bubble and target phases.
             */
            EventDispatcher.prototype.addListener = function (type, listener, useCapture) {
                if (useCapture === void 0) { useCapture = false; }
                this._getListenerList(type, useCapture).add(listener);
            };
<span id='WOZLLA-event-EventDispatcher-method-removeListener'>            /**
</span>             * @method removeListener
             * @param {string} type
             * @param {boolean} useCapture true to check capture phase, false to check bubble and target phases.
             */
            EventDispatcher.prototype.removeListener = function (type, listener, useCapture) {
                if (useCapture === void 0) { useCapture = false; }
                return this._getListenerList(type, useCapture).remove(listener);
            };
<span id='WOZLLA-event-EventDispatcher-method-clearListeners'>            /**
</span>             * @method clearListeners
             * @param {string} type
             * @param {boolean} useCapture true to check capture phase, false to check bubble and target phases.
             */
            EventDispatcher.prototype.clearListeners = function (type, useCapture) {
                this._getListenerList(type, useCapture).clear();
            };
<span id='WOZLLA-event-EventDispatcher-method-clearAllListeners'>            /**
</span>             * @method clearAllListeners
             *  clear all listeners
             */
            EventDispatcher.prototype.clearAllListeners = function () {
                this._captureDict = {};
                this._bubbleDict = {};
            };
<span id='WOZLLA-event-EventDispatcher-method-dispatch'>            /**
</span>             * @method dispatch an event
             * @param {WOZLLA.event.Event} event
             */
            EventDispatcher.prototype.dispatchEvent = function (event) {
                var i, len, ancients, ancient;
                event._target = this;
                if (!event.bubbles) {
                    this._dispatchEventInPhase(event, 2 /* TARGET */);
                    return;
                }
                ancients = this._getAncients();
                len = ancients.length;
                for (i = len - 1; i &gt;= 0; i--) {
                    ancient = ancients[i];
                    if (ancient._dispatchEventInPhase(event, 0 /* CAPTURE */)) {
                        return;
                    }
                }
                if (this._dispatchEventInPhase(event, 0 /* CAPTURE */)) {
                    return;
                }
                if (this._dispatchEventInPhase(event, 2 /* TARGET */)) {
                    return;
                }
                for (i = 0; i &lt; len; i++) {
                    ancient = ancients[i];
                    if (ancient._dispatchEventInPhase(event, 1 /* BUBBLE */)) {
                        return;
                    }
                }
            };
            EventDispatcher.prototype._dispatchEventInPhase = function (event, phase) {
                var i, len;
                var listener;
                var listenerList;
                event._eventPhase = phase;
                event._listenerRemove = false;
                event._currentTarget = this;
                listenerList = this._getListenerList(event.type, phase === 0 /* CAPTURE */);
                len = listenerList.length();
                if (len &gt; 0) {
                    for (i = len - 1; i &gt;= 0; i--) {
                        listener = listenerList.get(i);
                        listener(event);
                        // handle remove listener when client call event.removeCurrentListener();
                        if (event._listenerRemove) {
                            event._listenerRemove = false;
                            listenerList.removeAt(i);
                        }
                        if (event.isStopImmediatePropagation()) {
                            return true;
                        }
                    }
                    if (event.isStopPropagation()) {
                        return true;
                    }
                }
                return false;
            };
            EventDispatcher.prototype._getAncients = function () {
                var ancients = [];
                var parent = this;
                while (parent._bubbleParent) {
                    parent = parent._bubbleParent;
                    ancients.push(parent);
                }
                return ancients;
            };
            EventDispatcher.prototype._getListenerList = function (type, useCapture) {
                var listenerList;
                var dict = useCapture ? this._captureDict : this._bubbleDict;
                listenerList = dict[type];
                if (!listenerList) {
                    listenerList = new ListenerList();
                    dict[type] = listenerList;
                }
                return listenerList;
            };
            return EventDispatcher;
        })();
        _event.EventDispatcher = EventDispatcher;
    })(event = WOZLLA.event || (WOZLLA.event = {}));
})(WOZLLA || (WOZLLA = {}));
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
/// &lt;reference path=&quot;../event/EventDispatcher.ts&quot;/&gt;
/// &lt;reference path=&quot;../event/Event.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var assets;
    (function (assets) {
<span id='WOZLLA-assets-Asset'>        /**
</span>         * Base class of all assets in WOZLLA engine.
         * an asset contains a reference count which increase by **retain** function,
         * decrease by **release** function.
         * an asset would be unload when reference count reach 0.
         * @class WOZLLA.assets.Asset
         * @extends WOZLLA.event.EventDispatcher
         * @abstract
         */
        var Asset = (function (_super) {
            __extends(Asset, _super);
            function Asset(src) {
                _super.call(this);
                this._refCount = 0;
                this._src = src;
            }
            Object.defineProperty(Asset.prototype, &quot;src&quot;, {
<span id='WOZLLA-assets-Asset-property-src'>                /**
</span>                 * @property {string} src
                 * @readonly
                 */
                get: function () {
                    return this._src;
                },
                enumerable: true,
                configurable: true
            });
<span id='WOZLLA-assets-Asset-method-retain'>            /**
</span>             * retain this asset
             */
            Asset.prototype.retain = function () {
                this._refCount++;
            };
<span id='WOZLLA-assets-Asset-method-release'>            /**
</span>             * release this asset
             * @param {boolean} [decreaceRefCount=true]
             */
            Asset.prototype.release = function (decreaceRefCount) {
                if (decreaceRefCount === void 0) { decreaceRefCount = true; }
                if (decreaceRefCount) {
                    if (this._refCount &gt; 0) {
                        this._refCount--;
                    }
                }
                if (this._refCount === 0) {
                    this.unload();
                }
            };
<span id='WOZLLA-assets-Asset-method-load'>            /**
</span>             * load this asset
             * @param onSuccess
             * @param onError
             */
            Asset.prototype.load = function (onSuccess, onError) {
                onSuccess();
            };
<span id='WOZLLA-assets-Asset-method-unload'>            /**
</span>             * unload this asset
             * @fires unload event
             */
            Asset.prototype.unload = function () {
                var event = new WOZLLA.event.Event(Asset.EVENT_UNLOAD, false);
                event.target = event.currentTarget = this;
                this.dispatchEvent(event);
            };
            Asset.EVENT_UNLOAD = &#39;unload&#39;;
            return Asset;
        })(WOZLLA.event.EventDispatcher);
        assets.Asset = Asset;
    })(assets = WOZLLA.assets || (WOZLLA.assets = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var assets;
    (function (assets) {
<span id='WOZLLA-assets-AssetLoader'>        /**
</span>         * an singleton class for asset loading and asset management
         * @class WOZLLA.assets.AssetLoader
         * @singleton
         */
        var AssetLoader = (function () {
            function AssetLoader() {
                this._loadedAssets = {};
                this._loadingUnits = {};
            }
<span id='WOZLLA-assets-AssetLoader-static-method-getInstance'>            /**
</span>             * return the singleton of this class
             * @method getInstance
             * @static
             * @returns {WOZLLA.assets.AssetLoader}
             */
            AssetLoader.getInstance = function () {
                if (!AssetLoader.instance) {
                    AssetLoader.instance = new AssetLoader();
                }
                return AssetLoader.instance;
            };
<span id='WOZLLA-assets-AssetLoader-method-getAsset'>            /**
</span>             * get an asset by src
             * @param src
             * @returns {any}
             */
            AssetLoader.prototype.getAsset = function (src) {
                return this._loadedAssets[src];
            };
<span id='WOZLLA-assets-AssetLoader-method-addAsset'>            /**
</span>             * add asset to asset loader, the asset would be auto removed when unloaded.
             * @param asset
             */
            AssetLoader.prototype.addAsset = function (asset) {
                var _this = this;
                this._loadedAssets[asset.src] = asset;
                asset.addListener(assets.Asset.EVENT_UNLOAD, function (e) {
                    e.removeCurrentListener();
                    _this.removeAsset(asset);
                });
            };
<span id='WOZLLA-assets-AssetLoader-method-removeAsset'>            /**
</span>             * remove asset from asset loader
             * @param asset
             */
            AssetLoader.prototype.removeAsset = function (asset) {
                delete this._loadedAssets[asset.src];
            };
<span id='WOZLLA-assets-AssetLoader-method-loadAll'>            /**
</span>             * load all asset
             * @param items
             */
            AssetLoader.prototype.loadAll = function (items) {
                var item, i, len;
                for (i = 0, len = items.length; i &lt; len; i++) {
                    item = items[i];
                    this.load(item.src, item.AssetClass, item.callback);
                }
            };
<span id='WOZLLA-assets-AssetLoader-method-load'>            /**
</span>             * load an asset by src, AssetClass(constructor/factory)
             * @param src
             * @param AssetClass
             * @param callback
             */
            AssetLoader.prototype.load = function (src, AssetClass, callback) {
                var _this = this;
                var asset, loadUnit;
                asset = this._loadedAssets[src];
                if (asset) {
                    callback &amp;&amp; callback();
                    return;
                }
                loadUnit = this._loadingUnits[src];
                if (loadUnit) {
                    loadUnit.addCallback(callback, callback);
                    return;
                }
                asset = (new AssetClass(src));
                loadUnit = new LoadUnit(src);
                loadUnit.addCallback(callback, callback);
                this._loadingUnits[src] = loadUnit;
                asset.load(function () {
                    delete _this._loadingUnits[src];
                    _this.addAsset(asset);
                    loadUnit.complete(null, asset);
                }, function (error) {
                    console.log(error);
                    delete _this._loadingUnits[src];
                    loadUnit.complete(error);
                });
            };
            return AssetLoader;
        })();
        assets.AssetLoader = AssetLoader;
        var LoadUnit = (function () {
            function LoadUnit(src) {
                this.callbacks = [];
                this.src = src;
            }
            LoadUnit.prototype.addCallback = function (onSuccess, onError) {
                this.callbacks.push({
                    onSuccess: onSuccess,
                    onError: onError
                });
            };
            LoadUnit.prototype.complete = function (error, asset) {
                this.callbacks.forEach(function (callback) {
                    if (error) {
                        callback.onError &amp;&amp; callback.onError(error);
                    }
                    else {
                        callback.onSuccess &amp;&amp; callback.onSuccess(asset);
                    }
                });
            };
            return LoadUnit;
        })();
    })(assets = WOZLLA.assets || (WOZLLA.assets = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var ITexture;
        (function (ITexture) {
<span id='WOZLLA-renderer-ITexture-static-property-DOC'>            /**
</span>             * @property DOC
             * @readonly
             * @static
             * @member WOZLLA.renderer.ITexture
             */
            ITexture.DOC = &#39;DOC&#39;;
        })(ITexture = renderer.ITexture || (renderer.ITexture = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var IRenderer;
        (function (IRenderer) {
<span id='WOZLLA-renderer-IRenderer-static-property-DOC'>            /**
</span>             * @property DOC
             * @readonly
             * @static
             * @member WOZLLA.renderer.IRenderer
             */
            IRenderer.DOC = &#39;DOC&#39;;
        })(IRenderer = renderer.IRenderer || (renderer.IRenderer = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var math;
    (function (math) {
<span id='WOZLLA-math-Matrix'>        /**
</span>         * @class WOZLLA.math.Matrix
         * a util class for 2d matrix
         */
        var Matrix = (function () {
            function Matrix() {
<span id='WOZLLA-math-Matrix-property-values'>                /**
</span>                 * get values of this matrix
                 * @property {Float32Array} values
                 * @readonly
                 */
                this.values = new Float32Array(9);
                this.identity();
            }
<span id='WOZLLA-math-Matrix-method-applyMatrix'>            /**
</span>             * apply from another matrix
             * @param matrix
             */
            Matrix.prototype.applyMatrix = function (matrix) {
                this.values.set(matrix.values);
            };
<span id='WOZLLA-math-Matrix-method-identity'>            /**
</span>             * identify this matrix
             */
            Matrix.prototype.identity = function () {
                this.values[0] = 1; // a
                this.values[1] = 0; // b
                this.values[2] = 0;
                this.values[3] = 0; // c
                this.values[4] = 1; // d
                this.values[5] = 0;
                this.values[6] = 0; // tx
                this.values[7] = 0; // ty
                this.values[8] = 1;
            };
<span id='WOZLLA-math-Matrix-method-invert'>            /**
</span>             * invert this matrix
             */
            Matrix.prototype.invert = function () {
                var a1 = this.values[0];
                var b1 = this.values[1];
                var c1 = this.values[3];
                var d1 = this.values[4];
                var tx1 = this.values[6];
                var ty1 = this.values[7];
                var n = a1 * d1 - b1 * c1;
                this.values[0] = d1 / n;
                this.values[1] = -b1 / n;
                this.values[3] = -c1 / n;
                this.values[4] = a1 / n;
                this.values[6] = (c1 * ty1 - d1 * tx1) / n;
                this.values[7] = -(a1 * ty1 - b1 * tx1) / n;
            };
<span id='WOZLLA-math-Matrix-method-prepend'>            /**
</span>             * prepend 2d params to this matrix
             * @param a
             * @param b
             * @param c
             * @param d
             * @param tx
             * @param ty
             */
            Matrix.prototype.prepend = function (a, b, c, d, tx, ty) {
                var a1, b1, c1, d1;
                var values = this.values;
                var tx1 = values[6];
                var ty1 = values[7];
                if (a != 1 || b != 0 || c != 0 || d != 1) {
                    a1 = values[0];
                    b1 = values[1];
                    c1 = values[3];
                    d1 = values[4];
                    values[0] = a1 * a + b1 * c;
                    values[1] = a1 * b + b1 * d;
                    values[3] = c1 * a + d1 * c;
                    values[4] = c1 * b + d1 * d;
                }
                values[6] = tx1 * a + ty1 * c + tx;
                values[7] = tx1 * b + ty1 * d + ty;
            };
<span id='WOZLLA-math-Matrix-method-append'>            /**
</span>             * append 2d params to this matrix
             * @param a
             * @param b
             * @param c
             * @param d
             * @param tx
             * @param ty
             */
            Matrix.prototype.append = function (a, b, c, d, tx, ty) {
                var a1, b1, c1, d1;
                var values = this.values;
                a1 = values[0];
                b1 = values[1];
                c1 = values[3];
                d1 = values[4];
                values[0] = a * a1 + b * c1;
                values[1] = a * b1 + b * d1;
                values[3] = c * a1 + d * c1;
                values[4] = c * b1 + d * d1;
                values[6] = tx * a1 + ty * c1 + values[6];
                values[7] = tx * b1 + ty * d1 + values[7];
            };
<span id='WOZLLA-math-Matrix-method-prependTransform'>            /**
</span>             * prepend 2d transform params to this matrix
             * @param x
             * @param y
             * @param scaleX
             * @param scaleY
             * @param rotation
             * @param skewX
             * @param skewY
             * @param regX
             * @param regY
             * @returns {WOZLLA.math.Matrix}
             */
            Matrix.prototype.prependTransform = function (x, y, scaleX, scaleY, rotation, skewX, skewY, regX, regY) {
                if (rotation % 360) {
                    var r = rotation * Matrix.DEG_TO_RAD;
                    var cos = Math.cos(r);
                    var sin = Math.sin(r);
                }
                else {
                    cos = 1;
                    sin = 0;
                }
                if (regX || regY) {
                    this.values[6] -= regX;
                    this.values[7] -= regY;
                }
                if (skewX || skewY) {
                    skewX *= Matrix.DEG_TO_RAD;
                    skewY *= Matrix.DEG_TO_RAD;
                    this.prepend(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
                    this.prepend(Math.cos(skewY), Math.sin(skewY), -Math.sin(skewX), Math.cos(skewX), x, y);
                }
                else {
                    this.prepend(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
                }
                return this;
            };
<span id='WOZLLA-math-Matrix-method-appendTransform'>            /**
</span>             * append 2d transform params to this matrix
             * @param x
             * @param y
             * @param scaleX
             * @param scaleY
             * @param rotation
             * @param skewX
             * @param skewY
             * @param regX
             * @param regY
             * @returns {WOZLLA.math.Matrix}
             */
            Matrix.prototype.appendTransform = function (x, y, scaleX, scaleY, rotation, skewX, skewY, regX, regY) {
                if (rotation % 360) {
                    var r = rotation * Matrix.DEG_TO_RAD;
                    var cos = Math.cos(r);
                    var sin = Math.sin(r);
                }
                else {
                    cos = 1;
                    sin = 0;
                }
                if (skewX || skewY) {
                    skewX *= Matrix.DEG_TO_RAD;
                    skewY *= Matrix.DEG_TO_RAD;
                    this.append(Math.cos(skewY), Math.sin(skewY), -Math.sin(skewX), Math.cos(skewX), x, y);
                    this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
                }
                else {
                    this.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
                }
                if (regX || regY) {
                    // prepend the registration offset:
                    this.values[6] -= regX * this.values[0] + regY * this.values[3];
                    this.values[7] -= regX * this.values[1] + regY * this.values[4];
                }
                return this;
            };
<span id='WOZLLA-math-Matrix-static-property-DEG_TO_RAD'>            /**
</span>             * @property DEG_TO_RAD
             * @member WOZLLA.math.Matrix
             * @readonly
             * @static
             */
            Matrix.DEG_TO_RAD = Math.PI / 180;
            return Matrix;
        })();
        math.Matrix = Matrix;
    })(math = WOZLLA.math || (WOZLLA.math = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var utils;
    (function (utils) {
        var Tween = (function () {
            function Tween(target, props, pluginData) {
                this._target = null;
                this._useTicks = false;
                this.ignoreGlobalPause = false;
                this.loop = false;
                this.pluginData = null;
                this._steps = null;
                this._actions = null;
                this.paused = false;
                this.duration = 0;
                this._prevPos = -1;
                this.position = null;
                this._prevPosition = 0;
                this._stepPosition = 0;
                this.passive = false;
                this.initialize(target, props, pluginData);
            }
            Tween.get = function (target, props, pluginData, override) {
                if (props === void 0) { props = null; }
                if (pluginData === void 0) { pluginData = null; }
                if (override === void 0) { override = false; }
                if (override) {
                    Tween.removeTweens(target);
                }
                return new Tween(target, props, pluginData);
            };
            Tween.removeTweens = function (target) {
                if (!target.tween_count) {
                    return;
                }
                var tweens = Tween._tweens;
                for (var i = tweens.length - 1; i &gt;= 0; i--) {
                    if (tweens[i]._target == target) {
                        tweens[i].paused = true;
                        tweens.splice(i, 1);
                    }
                }
                target.tween_count = 0;
            };
            Tween.tick = function (delta, paused) {
                if (paused === void 0) { paused = false; }
                var tweens = Tween._tweens.concat();
                for (var i = tweens.length - 1; i &gt;= 0; i--) {
                    var tween = tweens[i];
                    if ((paused &amp;&amp; !tween.ignoreGlobalPause) || tween.paused) {
                        continue;
                    }
                    tween.tick(tween._useTicks ? 1 : delta);
                }
            };
            Tween._register = function (tween, value) {
                var target = tween._target;
                var tweens = Tween._tweens;
                if (value) {
                    if (target) {
                        target.tween_count = target.tween_count ? target.tween_count + 1 : 1;
                    }
                    tweens.push(tween);
                }
                else {
                    if (target) {
                        target.tween_count--;
                    }
                    var i = tweens.length;
                    while (i--) {
                        if (tweens[i] == tween) {
                            tweens.splice(i, 1);
                            return;
                        }
                    }
                }
            };
            Tween.removeAllTweens = function () {
                var tweens = Tween._tweens;
                for (var i = 0, l = tweens.length; i &lt; l; i++) {
                    var tween = tweens[i];
                    tween.paused = true;
                    tween._target.tweenjs_count = 0;
                }
                tweens.length = 0;
            };
            Tween.prototype.initialize = function (target, props, pluginData) {
                this._target = target;
                if (props) {
                    this._useTicks = props.useTicks;
                    this.ignoreGlobalPause = props.ignoreGlobalPause;
                    this.loop = props.loop;
                    //                props.onChange &amp;&amp; this.addEventListener(&quot;change&quot;, props.onChange, props.onChangeObj);
                    if (props.override) {
                        Tween.removeTweens(target);
                    }
                }
                this.pluginData = pluginData || {};
                this._curQueueProps = {};
                this._initQueueProps = {};
                this._steps = [];
                this._actions = [];
                if (props &amp;&amp; props.paused) {
                    this.paused = true;
                }
                else {
                    Tween._register(this, true);
                }
                if (props &amp;&amp; props.position != null) {
                    this.setPosition(props.position, Tween.NONE);
                }
            };
            Tween.prototype.setPosition = function (value, actionsMode) {
                if (actionsMode === void 0) { actionsMode = 1; }
                if (value &lt; 0) {
                    value = 0;
                }
                var t = value;
                var end = false;
                if (t &gt;= this.duration) {
                    if (this.loop) {
                        t = t % this.duration;
                    }
                    else {
                        t = this.duration;
                        end = true;
                    }
                }
                if (t == this._prevPos) {
                    return end;
                }
                var prevPos = this._prevPos;
                this.position = this._prevPos = t;
                this._prevPosition = value;
                if (this._target) {
                    if (end) {
                        this._updateTargetProps(null, 1);
                    }
                    else if (this._steps.length &gt; 0) {
                        for (var i = 0, l = this._steps.length; i &lt; l; i++) {
                            if (this._steps[i].t &gt; t) {
                                break;
                            }
                        }
                        var step = this._steps[i - 1];
                        this._updateTargetProps(step, (this._stepPosition = t - step.t) / step.d);
                    }
                }
                if (actionsMode != 0 &amp;&amp; this._actions.length &gt; 0) {
                    if (this._useTicks) {
                        this._runActions(t, t);
                    }
                    else if (actionsMode == 1 &amp;&amp; t &lt; prevPos) {
                        if (prevPos != this.duration) {
                            this._runActions(prevPos, this.duration);
                        }
                        this._runActions(0, t, true);
                    }
                    else {
                        this._runActions(prevPos, t);
                    }
                }
                if (end) {
                    this.setPaused(true);
                }
                //            this.dispatchEventWith(&quot;change&quot;);
                return end;
            };
            Tween.prototype._runActions = function (startPos, endPos, includeStart) {
                if (includeStart === void 0) { includeStart = false; }
                var sPos = startPos;
                var ePos = endPos;
                var i = -1;
                var j = this._actions.length;
                var k = 1;
                if (startPos &gt; endPos) {
                    sPos = endPos;
                    ePos = startPos;
                    i = j;
                    j = k = -1;
                }
                while ((i += k) != j) {
                    var action = this._actions[i];
                    var pos = action.t;
                    if (pos == ePos || (pos &gt; sPos &amp;&amp; pos &lt; ePos) || (includeStart &amp;&amp; pos == startPos)) {
                        action.f.apply(action.o, action.p);
                    }
                }
            };
            Tween.prototype._updateTargetProps = function (step, ratio) {
                var p0, p1, v, v0, v1, arr;
                if (!step &amp;&amp; ratio == 1) {
                    this.passive = false;
                    p0 = p1 = this._curQueueProps;
                }
                else {
                    this.passive = !!step.v;
                    if (this.passive) {
                        return;
                    }
                    if (step.e) {
                        ratio = step.e(ratio, 0, 1, 1);
                    }
                    p0 = step.p0;
                    p1 = step.p1;
                }
                for (var n in this._initQueueProps) {
                    if ((v0 = p0[n]) == null) {
                        p0[n] = v0 = this._initQueueProps[n];
                    }
                    if ((v1 = p1[n]) == null) {
                        p1[n] = v1 = v0;
                    }
                    if (v0 == v1 || ratio == 0 || ratio == 1 || (typeof (v0) != &quot;number&quot;)) {
                        v = ratio == 1 ? v1 : v0;
                    }
                    else {
                        v = v0 + (v1 - v0) * ratio;
                    }
                    var ignore = false;
                    if (arr = Tween._plugins[n]) {
                        for (var i = 0, l = arr.length; i &lt; l; i++) {
                            var v2 = arr[i].tween(this, n, v, p0, p1, ratio, !!step &amp;&amp; p0 == p1, !step);
                            if (v2 == Tween.IGNORE) {
                                ignore = true;
                            }
                            else {
                                v = v2;
                            }
                        }
                    }
                    if (!ignore) {
                        this._target[n] = v;
                    }
                }
            };
            Tween.prototype.setPaused = function (value) {
                this.paused = value;
                Tween._register(this, !value);
                return this;
            };
            Tween.prototype._cloneProps = function (props) {
                var o = {};
                for (var n in props) {
                    o[n] = props[n];
                }
                return o;
            };
            Tween.prototype._addStep = function (o) {
                if (o.d &gt; 0) {
                    this._steps.push(o);
                    o.t = this.duration;
                    this.duration += o.d;
                }
                return this;
            };
            Tween.prototype._appendQueueProps = function (o) {
                var arr, oldValue, i, l, injectProps;
                for (var n in o) {
                    if (this._initQueueProps[n] === undefined) {
                        oldValue = this._target[n];
                        if (arr = Tween._plugins[n]) {
                            for (i = 0, l = arr.length; i &lt; l; i++) {
                                oldValue = arr[i].init(this, n, oldValue);
                            }
                        }
                        this._initQueueProps[n] = this._curQueueProps[n] = (oldValue === undefined) ? null : oldValue;
                    }
                    else {
                        oldValue = this._curQueueProps[n];
                    }
                }
                for (var n in o) {
                    oldValue = this._curQueueProps[n];
                    if (arr = Tween._plugins[n]) {
                        injectProps = injectProps || {};
                        for (i = 0, l = arr.length; i &lt; l; i++) {
                            if (arr[i].step) {
                                arr[i].step(this, n, oldValue, o[n], injectProps);
                            }
                        }
                    }
                    this._curQueueProps[n] = o[n];
                }
                if (injectProps) {
                    this._appendQueueProps(injectProps);
                }
                return this._curQueueProps;
            };
            Tween.prototype._addAction = function (o) {
                o.t = this.duration;
                this._actions.push(o);
                return this;
            };
            Tween.prototype._set = function (props, o) {
                for (var n in props) {
                    o[n] = props[n];
                }
            };
            Tween.prototype.wait = function (duration, passive) {
                if (passive === void 0) { passive = false; }
                if (duration == null || duration &lt;= 0) {
                    return this;
                }
                var o = this._cloneProps(this._curQueueProps);
                return this._addStep({ d: duration, p0: o, p1: o, v: passive });
            };
            Tween.prototype.to = function (props, duration, ease) {
                if (ease === void 0) { ease = undefined; }
                if (isNaN(duration) || duration &lt; 0) {
                    duration = 0;
                }
                return this._addStep({ d: duration || 0, p0: this._cloneProps(this._curQueueProps), e: ease, p1: this._cloneProps(this._appendQueueProps(props)) });
            };
            Tween.prototype.call = function (callback, thisObj, params) {
                if (thisObj === void 0) { thisObj = undefined; }
                if (params === void 0) { params = undefined; }
                if (!callback) {
                    callback = function () {
                    };
                }
                return this._addAction({ f: callback, p: params ? params : [this], o: thisObj ? thisObj : this._target });
            };
            Tween.prototype.set = function (props, target) {
                if (target === void 0) { target = null; }
                return this._addAction({ f: this._set, o: this, p: [props, target ? target : this._target] });
            };
            Tween.prototype.play = function (tween) {
                if (!tween) {
                    tween = this;
                }
                return this.call(tween.setPaused, [false], tween);
            };
            Tween.prototype.pause = function (tween) {
                if (!tween) {
                    tween = this;
                }
                return this.call(tween.setPaused, [true], tween);
            };
            Tween.prototype.tick = function (delta) {
                if (this.paused) {
                    return;
                }
                this.setPosition(this._prevPosition + delta);
            };
            Tween.NONE = 0;
            Tween.LOOP = 1;
            Tween.REVERSE = 2;
            Tween._tweens = [];
            Tween.IGNORE = {};
            Tween._plugins = {};
            Tween._inited = false;
            return Tween;
        })();
        utils.Tween = Tween;
    })(utils = WOZLLA.utils || (WOZLLA.utils = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../math/Matrix.ts&quot;/&gt;
/// &lt;reference path=&quot;../utils/Tween.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var helpMatrix = new WOZLLA.math.Matrix();
<span id='WOZLLA-Transform'>    /**
</span>     * this class define the position, scale, rotation and about transform information of {@link WOZLLA.GameObject}
     * @class WOZLLA.Transform
     */
    var Transform = (function () {
        function Transform() {
<span id='WOZLLA-Transform-property-worldMatrix'>            /**
</span>             * @property {WOZLLA.math.Matrix} worldMatrix
             * @readonly
             */
            this.worldMatrix = new WOZLLA.math.Matrix();
<span id='WOZLLA-Transform-property-useGLCoords'>            /**
</span>             * specify this tranform
             * @type {boolean}
             */
            this.useGLCoords = false;
            this._relative = true;
            this._dirty = false;
            this._values = new Array(9);
            this.reset();
        }
        Object.defineProperty(Transform.prototype, &quot;x&quot;, {
            get: function () {
                return this._values[0];
            },
            set: function (value) {
                this._values[0] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;y&quot;, {
            get: function () {
                return this._values[1];
            },
            set: function (value) {
                this._values[1] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;rotation&quot;, {
            get: function () {
                return this._values[4];
            },
            set: function (value) {
                this._values[4] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;scaleX&quot;, {
            get: function () {
                return this._values[5];
            },
            set: function (value) {
                this._values[5] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;scaleY&quot;, {
            get: function () {
                return this._values[6];
            },
            set: function (value) {
                this._values[6] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;skewX&quot;, {
            get: function () {
                return this._values[7];
            },
            set: function (value) {
                this._values[7] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;skewY&quot;, {
            get: function () {
                return this._values[8];
            },
            set: function (value) {
                this._values[8] = value;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;relative&quot;, {
            get: function () {
                return this._relative;
            },
            set: function (relative) {
                this._relative = relative;
                this._dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Transform.prototype, &quot;dirty&quot;, {
            get: function () {
                return this._dirty;
            },
            set: function (value) {
                this._dirty = value;
            },
            enumerable: true,
            configurable: true
        });
        Transform.prototype.setPosition = function (x, y) {
            this._values[0] = x;
            this._values[1] = y;
            this._dirty = true;
        };
        Transform.prototype.setAnchor = function (anchorX, anchorY) {
            this._values[2] = anchorX;
            this._values[3] = anchorY;
            this._dirty = true;
        };
        Transform.prototype.setRotation = function (rotation) {
            this._values[4] = rotation;
            this._dirty = true;
        };
        Transform.prototype.setScale = function (scaleX, scaleY) {
            this._values[5] = scaleX;
            this._values[6] = scaleY;
            this._dirty = true;
        };
        Transform.prototype.setSkew = function (skewX, skewY) {
            this._values[7] = skewX;
            this._values[8] = skewY;
            this._dirty = true;
        };
        Transform.prototype.reset = function () {
            this._values[0] = 0; // x
            this._values[1] = 0; // y
            this._values[2] = 0; // @deprecated
            this._values[3] = 0; // @deprecated
            this._values[4] = 0; // rotation
            this._values[5] = 1; // scaleX
            this._values[6] = 1; // scaleY
            this._values[7] = 0; // skewX
            this._values[8] = 0; // skewY
        };
        Transform.prototype.set = function (transform) {
            if (typeof transform.x === &quot;number&quot;) {
                this._values[0] = transform.x; //x
            }
            if (typeof transform.y === &quot;number&quot;) {
                this._values[1] = transform.y; // y
            }
            if (typeof transform.rotation === &#39;number&#39;) {
                this._values[4] = transform.rotation; // rotation
            }
            if (typeof transform.scaleX === &#39;number&#39;) {
                this._values[5] = transform.scaleX; // scaleX
            }
            if (typeof transform.scaleY === &#39;number&#39;) {
                this._values[6] = transform.scaleY; // scaleY
            }
            if (typeof transform.skewX === &#39;number&#39;) {
                this._values[7] = transform.skewX; // skewX
            }
            if (typeof transform.skewY === &#39;number&#39;) {
                this._values[8] = transform.skewY; // skewY
            }
            if (typeof transform.relative !== &#39;undefined&#39;) {
                this._relative = transform.relative;
            }
            this._dirty = true;
        };
        Transform.prototype.transform = function (parentTransform) {
            if (parentTransform === void 0) { parentTransform = null; }
            var cos, sin, r;
            var worldMatrix = this.worldMatrix;
            var x = this._values[0];
            var y = this._values[1];
            var rotation = this._values[4];
            var scaleX = this._values[5];
            var scaleY = this._values[6];
            var skewX = this._values[7];
            var skewY = this._values[8];
            if (this.useGLCoords) {
                skewX += 180;
            }
            if (parentTransform &amp;&amp; this._relative) {
                worldMatrix.applyMatrix(parentTransform.worldMatrix);
            }
            else {
                //                worldMatrix.identity();
                //                parentTransform = Director.getInstance().getStage().transform;
                // if this is the transform of stage
                if (this === parentTransform) {
                    worldMatrix.identity();
                }
                else {
                    worldMatrix.applyMatrix(parentTransform.worldMatrix);
                }
            }
            if (rotation % 360) {
                r = rotation * Transform.DEG_TO_RAD;
                cos = Math.cos(r);
                sin = Math.sin(r);
            }
            else {
                cos = 1;
                sin = 0;
            }
            if (skewX || skewY) {
                skewX *= Transform.DEG_TO_RAD;
                skewY *= Transform.DEG_TO_RAD;
                worldMatrix.append(Math.cos(skewY), Math.sin(skewY), -Math.sin(skewX), Math.cos(skewX), x, y);
                worldMatrix.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, 0, 0);
            }
            else {
                worldMatrix.append(cos * scaleX, sin * scaleX, -sin * scaleY, cos * scaleY, x, y);
            }
            this._dirty = false;
        };
        Transform.prototype.updateWorldMatrix = function () {
            if (!this._dirty) {
                return;
            }
            var matrix = this.worldMatrix;
            if (matrix) {
                matrix.identity();
            }
            else {
                matrix = new WOZLLA.math.Matrix();
            }
            var o = this;
            while (o != null) {
                matrix.prependTransform(o.x, o.y, o.scaleX, o.scaleY, o.rotation, o.skewX, o.skewY, 0, 0);
                o = o.parent;
            }
        };
        Transform.prototype.globalToLocal = function (x, y, updateMatrix) {
            if (updateMatrix === void 0) { updateMatrix = false; }
            if (updateMatrix) {
                this.updateWorldMatrix();
            }
            helpMatrix.applyMatrix(this.worldMatrix);
            helpMatrix.invert();
            helpMatrix.append(1, 0, 0, 1, x, y);
            return {
                x: helpMatrix.values[6],
                y: helpMatrix.values[7]
            };
        };
        Transform.prototype.localToGlobal = function (x, y, updateMatrix) {
            if (updateMatrix === void 0) { updateMatrix = false; }
            if (updateMatrix) {
                this.updateWorldMatrix();
            }
            helpMatrix.applyMatrix(this.worldMatrix);
            helpMatrix.append(1, 0, 0, 1, x, y);
            return {
                x: helpMatrix.values[6],
                y: helpMatrix.values[7]
            };
        };
        Transform.prototype.tween = function (override) {
            return WOZLLA.utils.Tween.get(this, null, null, override);
        };
        Transform.prototype.clearTweens = function () {
            return WOZLLA.utils.Tween.removeTweens(this);
        };
<span id='WOZLLA-Transform-static-property-DEG_TO_RAD'>        /**
</span>         * @property {number} DEG_TO_RAD
         * @readonly
         * @static
         */
        Transform.DEG_TO_RAD = Math.PI / 180;
        return Transform;
    })();
    WOZLLA.Transform = Transform;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Transform.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-RectTransform'>    /**
</span>     * RectTransform is a subclass of {@link WOZLLA.Transform}, define a rect region
     * for {@WOZLLA.GameObject} and a anchor mode to specify how to related to it&#39;s parent.
     * @class WOZLLA.RectTransform
     */
    var RectTransform = (function (_super) {
        __extends(RectTransform, _super);
        function RectTransform() {
            _super.apply(this, arguments);
            this._width = 0;
            this._height = 0;
            this._top = 0;
            this._left = 0;
            this._right = 0;
            this._bottom = 0;
            this._px = 0;
            this._py = 0;
            this._anchorMode = RectTransform.ANCHOR_CENTER | RectTransform.ANCHOR_MIDDLE;
        }
        Object.defineProperty(RectTransform.prototype, &quot;width&quot;, {
<span id='WOZLLA-RectTransform-property-width'>            /**
</span>             * get or set width, this property only effect on fixed size mode
             * @property {number} width
             */
            get: function () {
                return this._width;
            },
            set: function (value) {
                if (this._width === value)
                    return;
                this._width = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;height&quot;, {
<span id='WOZLLA-RectTransform-property-height'>            /**
</span>             * get or set height, this property only effect on fixed size mode
             * @property {number} height
             */
            get: function () {
                return this._height;
            },
            set: function (value) {
                if (this._height === value)
                    return;
                this._height = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;top&quot;, {
<span id='WOZLLA-RectTransform-property-top'>            /**
</span>             * get or set top
             * @property {number} top
             */
            get: function () {
                return this._top;
            },
            set: function (value) {
                if (this._top === value)
                    return;
                this._top = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;left&quot;, {
<span id='WOZLLA-RectTransform-property-left'>            /**
</span>             * get or set left
             * @property {number} left
             */
            get: function () {
                return this._left;
            },
            set: function (value) {
                if (this._left === value)
                    return;
                this._left = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;right&quot;, {
<span id='WOZLLA-RectTransform-property-right'>            /**
</span>             * get or set right
             * @property {number} right
             */
            get: function () {
                return this._right;
            },
            set: function (value) {
                if (this._right === value)
                    return;
                this._right = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;bottom&quot;, {
<span id='WOZLLA-RectTransform-property-bottom'>            /**
</span>             * get or set bottom
             * @property {number} bottom
             */
            get: function () {
                return this._bottom;
            },
            set: function (value) {
                if (this._bottom === value)
                    return;
                this._bottom = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;px&quot;, {
<span id='WOZLLA-RectTransform-property-px'>            /**
</span>             * get or set px, this only effect on strengthen mode
             * @property {number} px specify x coords
             */
            get: function () {
                return this._px;
            },
            set: function (value) {
                if (this._px === value)
                    return;
                this._px = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;py&quot;, {
<span id='WOZLLA-RectTransform-property-py'>            /**
</span>             * get or set py, this only effect on strengthen mode
             * @property {number} py specify y coords
             */
            get: function () {
                return this._py;
            },
            set: function (value) {
                if (this._py === value)
                    return;
                this._py = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RectTransform.prototype, &quot;anchorMode&quot;, {
<span id='WOZLLA-RectTransform-property-anchorMode'>            /**
</span>             * get or set anchor mode
             * @property {number} anchorMode
             */
            get: function () {
                return this._anchorMode;
            },
            set: function (value) {
                if (this._anchorMode === value)
                    return;
                this._anchorMode = value;
                this.dirty = true;
            },
            enumerable: true,
            configurable: true
        });
<span id='WOZLLA-RectTransform-method-set'>        /**
</span>         * set rect transform
         * @param {WOZLLA.RectTransform} rectTransform
         */
        RectTransform.prototype.set = function (rectTransform) {
            this._anchorMode = rectTransform.anchorMode;
            this._width = rectTransform.width || 0;
            this._height = rectTransform.height || 0;
            this._top = rectTransform.top || 0;
            this._left = rectTransform.left || 0;
            this._right = rectTransform.right || 0;
            this._bottom = rectTransform.bottom || 0;
            this._px = rectTransform.px || 0;
            this._px = rectTransform.py || 0;
            this.dirty = true;
        };
<span id='WOZLLA-RectTransform-method-transform'>        /**
</span>         * transform with parent transform
         * @param {WOZLLA.Transform} parentTransform
         */
        RectTransform.prototype.transform = function (parentTransform) {
            if (parentTransform === void 0) { parentTransform = null; }
            var m, R, p;
            if (!parentTransform || !this._relative || !(parentTransform instanceof RectTransform)) {
                p = WOZLLA.Director.getInstance().viewRectTransform;
            }
            else {
                p = parentTransform;
            }
            m = this._anchorMode;
            R = RectTransform;
            if ((m &amp; R.ANCHOR_LEFT) === R.ANCHOR_LEFT) {
                this.x = this._px;
            }
            else if ((m &amp; R.ANCHOR_RIGHT) === R.ANCHOR_RIGHT) {
                this.x = p._width + this._px;
            }
            else if ((m &amp; R.ANCHOR_HORIZONTAL_STRENGTH) === R.ANCHOR_HORIZONTAL_STRENGTH) {
                this.x = this._left;
                this._width = p._width - this._left - this._right;
            }
            else {
                this.x = p._width / 2 + this._px;
            }
            if ((m &amp; R.ANCHOR_TOP) === R.ANCHOR_TOP) {
                this.y = this._py;
            }
            else if ((m &amp; R.ANCHOR_BOTTOM) === R.ANCHOR_BOTTOM) {
                this.y = p._height + this._py;
            }
            else if ((m &amp; R.ANCHOR_VERTICAL_STRENGTH) === R.ANCHOR_VERTICAL_STRENGTH) {
                this.y = this._top;
                this._height = p._height - this._top - this._bottom;
            }
            else {
                this.y = p._height / 2 + this._py;
            }
            _super.prototype.transform.call(this, parentTransform);
        };
<span id='WOZLLA-RectTransform-static-property-ANCHOR_TOP'>        /**
</span>         * vertical anchor mode
         * @property {number} ANCHOR_TOP
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_TOP = 0x1;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_MIDDLE'>        /**
</span>         * vertical anchor mode
         * @property {number} ANCHOR_MIDDLE
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_MIDDLE = 0x10;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_BOTTOM'>        /**
</span>         * vertical anchor mode
         * @property {number} ANCHOR_BOTTOM
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_BOTTOM = 0x100;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_VERTICAL_STRENGTH'>        /**
</span>         * vertical anchor mode
         * @property {number} ANCHOR_VERTICAL_STRENGTH
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_VERTICAL_STRENGTH = 0x1000;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_LEFT'>        /**
</span>         * horizontal anchor mode
         * @property {number} ANCHOR_LEFT
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_LEFT = 0x10000;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_CENTER'>        /**
</span>         * horizontal anchor mode
         * @property {number} ANCHOR_CENTER
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_CENTER = 0x100000;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_RIGHT'>        /**
</span>         * horizontal anchor mode
         * @property {number} ANCHOR_RIGHT
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_RIGHT = 0x1000000;
<span id='WOZLLA-RectTransform-static-property-ANCHOR_HORIZONTAL_STRENGTH'>        /**
</span>         * horizontal anchor mode
         * @property {number} ANCHOR_HORIZONTAL_STRENGTH
         * @readonly
         * @static
         */
        RectTransform.ANCHOR_HORIZONTAL_STRENGTH = 0x10000000;
        return RectTransform;
    })(WOZLLA.Transform);
    WOZLLA.RectTransform = RectTransform;
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var Assert = (function () {
        function Assert() {
        }
        Assert.isTrue = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            if (test !== true) {
                throw new Error(msg);
            }
        };
        Assert.isFalse = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            if (test !== false) {
                throw new Error(msg);
            }
        };
        Assert.isTypeof = function (test, type, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            if (typeof test !== type) {
                throw new Error(msg);
            }
        };
        Assert.isNotTypeof = function (test, type, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            if (typeof test === type) {
                throw new Error(msg);
            }
        };
        Assert.isString = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            Assert.isTypeof(test, &#39;string&#39;, msg);
        };
        Assert.isObject = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            Assert.isTypeof(test, &#39;object&#39;, msg);
        };
        Assert.isUndefined = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            Assert.isTypeof(test, &#39;undefined&#39;, msg);
        };
        Assert.isNotUndefined = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            Assert.isNotTypeof(test, &#39;undefined&#39;, msg);
        };
        Assert.isFunction = function (test, msg) {
            if (msg === void 0) { msg = Assert.DEFAULT_MESSAGE; }
            Assert.isTypeof(test, &#39;function&#39;, msg);
        };
        Assert.DEFAULT_MESSAGE = &#39;Assertion Fail&#39;;
        return Assert;
    })();
    WOZLLA.Assert = Assert;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Transform.ts&quot;/&gt;
/// &lt;reference path=&quot;../utils/Assert.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Component'>    /**
</span>     * Top class of all components
     * @class WOZLLA.Component
     * @abstract
     */
    var Component = (function () {
        function Component() {
        }
        Object.defineProperty(Component.prototype, &quot;gameObject&quot;, {
<span id='WOZLLA-Component-property-gameObject'>            /**
</span>             * get the GameObject of this component belongs to.
             * @property {WOZLLA.GameObject} gameObject
             * @readonly
             */
            get: function () {
                return this._gameObject;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Component.prototype, &quot;transform&quot;, {
<span id='WOZLLA-Component-property-transform'>            /**
</span>             *  get transform of the gameObject of this component
             *  @property {WOZLLA.Transform} transform
             */
            get: function () {
                return this._gameObject.transform;
            },
            enumerable: true,
            configurable: true
        });
<span id='WOZLLA-Component-method-init'>        /**
</span>         * init this component
         */
        Component.prototype.init = function () {
        };
<span id='WOZLLA-Component-method-destroy'>        /**
</span>         * destroy this component
         */
        Component.prototype.destroy = function () {
        };
        Component.prototype.listRequiredComponents = function () {
            return [];
        };
<span id='WOZLLA-Component-static-method-register'>        /**
</span>         * register an component class and it&#39;s configuration
         * @method register
         * @static
         * @param ctor
         * @param configuration
         */
        Component.register = function (ctor, configuration) {
            WOZLLA.Assert.isObject(configuration);
            WOZLLA.Assert.isString(configuration.name);
            WOZLLA.Assert.isUndefined(Component.configMap[configuration.name]);
            Component.configMap[configuration.name] = ctor;
        };
<span id='WOZLLA-Component-method-create'>        /**
</span>         * create component by it&#39;s registed name.
         * @param name the component name
         * @returns {WOZLLA.Component}
         */
        Component.create = function (name) {
            var ctor = Component.configMap[name];
            WOZLLA.Assert.isFunction(ctor);
            return new ctor();
        };
        Component.configMap = {};
        return Component;
    })();
    WOZLLA.Component = Component;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Component.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Collider'>    /**
</span>     * abstract base class for all colliders
     * @class WOZLLA.Collider
     * @extends WOZLLA.Component
     * @abstract
     */
    var Collider = (function (_super) {
        __extends(Collider, _super);
        function Collider() {
            _super.apply(this, arguments);
        }
<span id='WOZLLA-Collider-method-collideXY'>        /**
</span>         * @method {boolean} containsXY
         * @param localX x coords relate to the gameObject of this collider
         * @param localY y coords relate to the gameObject of this collider
         * @returns {boolean}
         */
        Collider.prototype.collideXY = function (localX, localY) {
            return false;
        };
        Collider.prototype.collide = function (collider) {
            return false;
        };
        return Collider;
    })(WOZLLA.Component);
    WOZLLA.Collider = Collider;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Transform.ts&quot;/&gt;
/// &lt;reference path=&quot;RectTransform.ts&quot;/&gt;
/// &lt;reference path=&quot;Collider.ts&quot;/&gt;
/// &lt;reference path=&quot;../event/EventDispatcher.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var comparator = function (a, b) {
        return a.z - b.z;
    };
    var idMap = {};
<span id='WOZLLA-GameObject'>    /**
</span>     * GameObject is the base element in WOZLLA engine. It contains
     * many child instance of {@link WOZLLA.GameObject} and many
     * instance of {@link WOZLLA.Component}.
     * &lt;br/&gt;
     * &lt;br/&gt;
     * Tree structure of the GameObject is the core of WOZLLA engine.
     *
     * @class WOZLLA.GameObject
     * @extends WOZLLA.event.EventDispatcher
     */
    var GameObject = (function (_super) {
        __extends(GameObject, _super);
<span id='WOZLLA-GameObject-method-constructor'>        /**
</span>         * new a GameObject
         * @method constructor
         * @member WOZLLA.GameObject
         * @param {boolean} useRectTransform specify which transform this game object should be used.
         */
        function GameObject(useRectTransform) {
            if (useRectTransform === void 0) { useRectTransform = false; }
            _super.call(this);
            this._active = true;
            this._visible = true;
            this._initialized = false;
            this._destroyed = false;
            this._touchable = false;
            this._name = &#39;GameObject&#39;;
            this._children = [];
            this._components = [];
            this._transform = useRectTransform ? new WOZLLA.RectTransform() : new WOZLLA.Transform();
            this._rectTransform = useRectTransform ? this._transform : null;
            this._z = 0;
            this._behaviours = [];
        }
<span id='WOZLLA-GameObject-static-method-getById'>        /**
</span>         * return the GameObject with the specified id.
         * @method {WOZLLA.GameObject} getById
         * @static
         * @param id the specified id
         * @member WOZLLA.GameObject
         */
        GameObject.getById = function (id) {
            return idMap[id];
        };
        Object.defineProperty(GameObject.prototype, &quot;id&quot;, {
<span id='WOZLLA-GameObject-property-id'>            /**
</span>             * get or set the id of this game object
             * @property {string} id
             * @member WOZLLA.GameObject
             */
            get: function () {
                return this._id;
            },
            set: function (value) {
                var oldId = this._id;
                this._id = value;
                if (oldId) {
                    delete idMap[oldId];
                }
                idMap[value] = this;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;name&quot;, {
<span id='WOZLLA-GameObject-property-name'>            /**
</span>             * get or set the name of this game object
             * @property {string} name
             * @member WOZLLA.GameObject
             */
            get: function () {
                return this._name;
            },
            set: function (value) {
                this._name = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;transform&quot;, {
<span id='WOZLLA-GameObject-property-transform'>            /**
</span>             * get transform of this game object
             * @property {WOZLLA.Transform} transform
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._transform;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;rectTransform&quot;, {
<span id='WOZLLA-GameObject-property-rectTransform'>            /**
</span>             * get rect transform of this game object
             * @property {WOZLLA.RectTransform} rectTransform
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._rectTransform;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;parent&quot;, {
<span id='WOZLLA-GameObject-property-parent'>            /**
</span>             * get parent game object
             * @property {WOZLLA.GameObject} parent
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._parent;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;children&quot;, {
<span id='WOZLLA-GameObject-property-children'>            /**
</span>             * get children of this game object
             * @property {WOZLLA.GameObject[]} children
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._children.slice(0);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;z&quot;, {
<span id='WOZLLA-GameObject-property-z'>            /**
</span>             * get or set z order of this game object, and then resort children.
             * @property {number} z
             * @member WOZLLA.GameObject
             */
            get: function () {
                return this._z;
            },
            set: function (value) {
                this.setZ(value, true);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;active&quot;, {
<span id='WOZLLA-GameObject-property-active'>            /**
</span>             * get or set active of this game object.
             * the update method would be call every frame when active was true, false otherwise.
             * if active is set from false to true, the transform dirty would be true.
             * @property {boolean} active
             * @member WOZLLA.GameObject
             */
            get: function () {
                return this._active;
            },
            set: function (value) {
                var oldActive = this._active;
                this._active = value;
                if (!oldActive &amp;&amp; value) {
                    this._transform.dirty = true;
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;visible&quot;, {
<span id='WOZLLA-GameObject-property-visible'>            /**
</span>             * get visible of this game object.
             * the render method would be call every frame when visible and active both true.
             * @property {boolean} visible
             * @member WOZLLA.GameObject
             */
            get: function () {
                return this._visible;
            },
            set: function (value) {
                this._visible = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;initialized&quot;, {
<span id='WOZLLA-GameObject-property-initialized'>            /**
</span>             * get initialized of this game object
             * @property {boolean} initialized
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._initialized;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;destroyed&quot;, {
<span id='WOZLLA-GameObject-property-destroyed'>            /**
</span>             * get destroyed of this game object
             * @property {boolean} destroyed
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._destroyed;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;touchable&quot;, {
<span id='WOZLLA-GameObject-property-touchable'>            /**
</span>             * get or set touchable of this game object. identify this game object is interactive.
             * @property {boolean} touchable
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._touchable;
            },
            set: function (value) {
                this._touchable = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;renderer&quot;, {
<span id='WOZLLA-GameObject-property-renderer'>            /**
</span>             * get renderer component of this game object
             * @property {WOZLLA.Renderer} renderer
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._renderer;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;collider&quot;, {
<span id='WOZLLA-GameObject-property-collider'>            /**
</span>             * get collider of this game object
             * @property {WOZLLA.Collider} collider
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._collider;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;behaviours&quot;, {
<span id='WOZLLA-GameObject-property-behaviours'>            /**
</span>             * get behaviours of this game object
             * @property {WOZLLA.Behaviour[]} behaviours
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._behaviours.slice(0);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(GameObject.prototype, &quot;mask&quot;, {
<span id='WOZLLA-GameObject-property-mask'>            /**
</span>             * get mask component of this game object
             * @property {WOZLLA.Mask} mask
             * @member WOZLLA.GameObject
             * @readonly
             */
            get: function () {
                return this._mask;
            },
            enumerable: true,
            configurable: true
        });
<span id='WOZLLA-GameObject-method-setZ'>        /**
</span>         * set z order
         * @param value
         * @param sort true is set to resort children
         */
        GameObject.prototype.setZ = function (value, sort) {
            if (sort === void 0) { sort = true; }
            if (this._z === value)
                return;
            this._z = value;
            if (sort) {
                this._children.sort(comparator);
            }
        };
<span id='WOZLLA-GameObject-method-addChild'>        /**
</span>         * add a child game object, it would be fail when this game object has contains the child.
         * @param child
         * @param sort true is set to resort children
         * @returns {boolean} true is success to, false otherwise.
         */
        GameObject.prototype.addChild = function (child, sort) {
            if (sort === void 0) { sort = true; }
            if (this._children.indexOf(child) !== -1) {
                return false;
            }
            if (child._parent) {
                child.removeMe();
            }
            child.dispatchEvent(new WOZLLA.CoreEvent(&#39;beforeadd&#39;, true));
            this._children.push(child);
            if (sort) {
                this._children.sort(comparator);
            }
            child._parent = this;
            child._transform.dirty = true;
            child.dispatchEvent(new WOZLLA.CoreEvent(&#39;add&#39;, true));
            return true;
        };
<span id='WOZLLA-GameObject-method-removeChild'>        /**
</span>         * remove the specified child.
         * @param child
         * @returns {boolean} true is success to, false otherwise.
         */
        GameObject.prototype.removeChild = function (child) {
            var idx = this._children.indexOf(child);
            if (idx !== -1) {
                child.dispatchEvent(new WOZLLA.CoreEvent(&#39;beforeremove&#39;, true, null, false));
                this._children.splice(idx, 1);
                child._parent = null;
                child.dispatchEvent(new WOZLLA.CoreEvent(&#39;remove&#39;, true, null, false));
                return true;
            }
            return false;
        };
<span id='WOZLLA-GameObject-method-getChild'>        /**
</span>         * get the first child with the specified name.
         * @param name
         * @returns {WOZLLA.GameObject}
         */
        GameObject.prototype.getChild = function (name) {
            var child, i, len;
            for (i = 0, len = this._children.length; i &lt; len; i++) {
                child = this._children[i];
                if (child._name === name) {
                    return child;
                }
            }
            return null;
        };
<span id='WOZLLA-GameObject-method-getChildren'>        /**
</span>         * get all children with the specified name.
         * @param name
         * @returns {Array}
         */
        GameObject.prototype.getChildren = function (name) {
            var child, i, len;
            var result = [];
            for (i = 0, len = this._children.length; i &lt; len; i++) {
                child = this._children[i];
                if (child._name === name) {
                    result.push(child);
                }
            }
            return result;
        };
<span id='WOZLLA-GameObject-method-removeMe'>        /**
</span>         * remove this game object from parent.
         * @returns {boolean}
         */
        GameObject.prototype.removeMe = function () {
            var parent = this._parent;
            return parent &amp;&amp; parent.removeChild(this);
        };
<span id='WOZLLA-GameObject-method-eachChild'>        /**
</span>         * iterator children of this game object
         * @param func interator function.
         */
        GameObject.prototype.eachChild = function (func) {
            this._children.forEach(func);
        };
<span id='WOZLLA-GameObject-method-sortChildren'>        /**
</span>         * sort children
         */
        GameObject.prototype.sortChildren = function () {
            this._children.sort(comparator);
        };
<span id='WOZLLA-GameObject-method-getPath'>        /**
</span>         * get path of this game object
         * @param split delimiter
         * @returns {string}
         */
        GameObject.prototype.getPath = function (split) {
            if (split === void 0) { split = &#39;/&#39;; }
            var arr = [];
            var obj = this;
            while (obj) {
                arr.unshift(obj.name);
                obj = obj.parent;
            }
            return arr.join(split);
        };
<span id='WOZLLA-GameObject-method-contains'>        /**
</span>         * whether contains the specified game object of this tree structure.
         * @param child
         * @returns {boolean}
         */
        GameObject.prototype.contains = function (child) {
            if (child === this) {
                return true;
            }
            var parent = child;
            while (parent = parent.parent) {
                if (parent === this) {
                    return true;
                }
            }
            return false;
        };
<span id='WOZLLA-GameObject-method-getComponent'>        /**
</span>         * get first component of type of the specified Type(constructor).
         * @param Type
         * @returns {WOZLLA.Component}
         */
        GameObject.prototype.getComponent = function (Type) {
            var comp, i, len;
            if (this._components.length &lt;= 0) {
                return null;
            }
            for (i = 0, len = this._components.length; i &lt; len; i++) {
                comp = this._components[i];
                if (comp instanceof Type) {
                    return comp;
                }
            }
            return null;
        };
<span id='WOZLLA-GameObject-method-hasComponent'>        /**
</span>         * @method hasComponent
         * @param Type
         * @returns {boolean}
         */
        GameObject.prototype.hasComponent = function (Type) {
            var comp, i, len;
            if (this._components.length &lt;= 0) {
                return false;
            }
            for (i = 0, len = this._components.length; i &lt; len; i++) {
                comp = this._components[i];
                if (comp instanceof Type) {
                    return true;
                }
            }
            return false;
        };
<span id='WOZLLA-GameObject-method-getComponents'>        /**
</span>         * get all components of type of Type(constructor).
         * @param Type
         * @returns {Array}
         */
        GameObject.prototype.getComponents = function (Type) {
            var comp, i, len;
            var result = [];
            if (this._components.length &lt;= 0) {
                return result;
            }
            for (i = 0, len = this._components.length; i &lt; len; i++) {
                comp = this._components[i];
                if (comp instanceof Type) {
                    result.push(comp);
                }
            }
            return result;
        };
<span id='WOZLLA-GameObject-method-addComponent'>        /**
</span>         * add componen to this game object. this method would check component dependency
         * by method of component&#39;s listRequiredComponents.
         * @param comp
         * @returns {boolean}
         */
        GameObject.prototype.addComponent = function (comp) {
            if (this._components.indexOf(comp) !== -1) {
                return false;
            }
            if (!this.checkComponentDependency(comp)) {
                throw new Error(&#39;Can\&#39;t not add, because of dependency&#39;);
            }
            if (comp._gameObject) {
                comp._gameObject.removeComponent(comp);
            }
            this._components.push(comp);
            comp._gameObject = this;
            if (comp instanceof WOZLLA.Behaviour) {
                this._behaviours.push(comp);
            }
            else if (comp instanceof WOZLLA.Renderer) {
                this._renderer = comp;
            }
            else if (comp instanceof WOZLLA.Collider) {
                this._collider = comp;
            }
            else if (comp instanceof WOZLLA.Mask) {
                this._mask = comp;
            }
            return true;
        };
<span id='WOZLLA-GameObject-method-removeComponent'>        /**
</span>         * remove the specified component
         * @param comp
         * @returns {boolean}
         */
        GameObject.prototype.removeComponent = function (comp) {
            var i, len, otherComp;
            var idx = this._components.indexOf(comp);
            if (idx !== -1) {
                for (i = 0, len = this._components.length; i &lt; len; i++) {
                    otherComp = this._components[i];
                    if (otherComp !== comp) {
                        if (this.checkComponentDependency(otherComp)) {
                            throw new Error(&#39;Can\&#39;t not remove, because of dependency&#39;);
                        }
                    }
                }
                this._components.splice(idx, 1);
                if (comp instanceof WOZLLA.Behaviour) {
                    this._behaviours.splice(this._behaviours.indexOf(comp), 1);
                }
                else if (comp instanceof WOZLLA.Renderer) {
                    this._renderer = null;
                }
                else if (comp instanceof WOZLLA.Collider) {
                    this._collider = null;
                }
                else if (comp instanceof WOZLLA.Mask) {
                    this._mask = null;
                }
                comp._gameObject = null;
                return true;
            }
            return false;
        };
<span id='WOZLLA-GameObject-method-init'>        /**
</span>         * init this game object.
         */
        GameObject.prototype.init = function () {
            var i, len;
            if (this._initialized || this._destroyed)
                return;
            for (i = 0, len = this._components.length; i &lt; len; i++) {
                this._components[i].init();
            }
            for (i = 0, len = this._children.length; i &lt; len; i++) {
                this._children[i].init();
            }
            this._initialized = true;
        };
<span id='WOZLLA-GameObject-method-destroy'>        /**
</span>         * destroy this game object.
         */
        GameObject.prototype.destroy = function () {
            var i, len;
            if (this._destroyed || !this._initialized)
                return;
            for (i = 0, len = this._components.length; i &lt; len; i++) {
                this._components[i].destroy();
            }
            for (i = 0, len = this._children.length; i &lt; len; i++) {
                this._children[i].destroy();
            }
            if (this._id) {
                delete idMap[this._id];
            }
            this.clearAllListeners();
            this._destroyed = true;
        };
<span id='WOZLLA-GameObject-method-update'>        /**
</span>         * call every frame when active was true.
         */
        GameObject.prototype.update = function () {
            var i, len, behaviour;
            if (!this._active)
                return;
            if (this._behaviours.length &gt; 0) {
                for (i = 0, len = this._behaviours.length; i &lt; len; i++) {
                    behaviour = this._behaviours[i];
                    behaviour.enabled &amp;&amp; behaviour.update();
                }
            }
            if (this._children.length &gt; 0) {
                for (i = 0, len = this._children.length; i &lt; len; i++) {
                    this._children[i].update();
                }
            }
        };
<span id='WOZLLA-GameObject-method-visit'>        /**
</span>         * visit this game object and it&#39;s all chidlren, children of children.
         * @param renderer
         * @param parentTransform
         * @param flags
         */
        GameObject.prototype.visit = function (renderer, parentTransform, flags) {
            var i, len;
            if (!this._active || !this._initialized || this._destroyed) {
                if ((flags &amp; GameObject.MASK_TRANSFORM_DIRTY) === GameObject.MASK_TRANSFORM_DIRTY) {
                    this._transform.dirty = true;
                }
                return;
            }
            if (this._transform.dirty) {
                flags |= GameObject.MASK_TRANSFORM_DIRTY;
            }
            if ((flags &amp; GameObject.MASK_TRANSFORM_DIRTY) == GameObject.MASK_TRANSFORM_DIRTY) {
                this._transform.transform(parentTransform);
            }
            if (!this._visible) {
                flags &amp;= (~GameObject.MASK_VISIBLE);
            }
            if ((flags &amp; GameObject.MASK_VISIBLE) === GameObject.MASK_VISIBLE) {
                this.render(renderer, flags);
            }
            for (i = 0, len = this._children.length; i &lt; len; i++) {
                this._children[i].visit(renderer, this._transform, flags);
            }
        };
<span id='WOZLLA-GameObject-method-render'>        /**
</span>         * render this game object
         * @param renderer
         * @param flags
         */
        GameObject.prototype.render = function (renderer, flags) {
            this._mask &amp;&amp; this._mask.render(renderer, flags);
            this._renderer &amp;&amp; this._renderer.render(renderer, flags);
        };
<span id='WOZLLA-GameObject-method-getUnderPoint'>        /**
</span>         * get a game object under the point.
         * @param x
         * @param y
         * @param touchable
         * @returns {WOZLLA.GameObject}
         */
        GameObject.prototype.getUnderPoint = function (x, y, touchable) {
            if (touchable === void 0) { touchable = false; }
            var found, localP, child;
            var childrenArr;
            if (!this._active || !this._visible)
                return null;
            childrenArr = this._children;
            if (childrenArr.length &gt; 0) {
                for (var i = childrenArr.length - 1; i &gt;= 0; i--) {
                    child = childrenArr[i];
                    found = child.getUnderPoint(x, y, touchable);
                    if (found) {
                        return found;
                    }
                }
            }
            if (!touchable || this._touchable) {
                localP = this.transform.globalToLocal(x, y);
                if (this.testHit(localP.x, localP.y)) {
                    return this;
                }
            }
            return null;
        };
<span id='WOZLLA-GameObject-method-testHit'>        /**
</span>         * try to do a hit test
         * @param localX
         * @param localY
         * @returns {boolean}
         */
        GameObject.prototype.testHit = function (localX, localY) {
            var collider = this._collider;
            return collider &amp;&amp; collider.collideXY(localX, localY);
        };
        GameObject.prototype.checkComponentDependency = function (comp) {
            var Type;
            var requires = comp.listRequiredComponents();
            var ret = true;
            for (var i = 0, len = requires.length; i &lt; len; i++) {
                Type = requires[i];
                ret = ret &amp;&amp; this.hasComponent(Type);
            }
            return ret;
        };
        GameObject.MASK_TRANSFORM_DIRTY = 0x1;
        GameObject.MASK_VISIBLE = 0x10;
        return GameObject;
    })(WOZLLA.event.EventDispatcher);
    WOZLLA.GameObject = GameObject;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;GameObject.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Stage'>    /**
</span>     * the root game object of WOZLLA engine
     * @class WOZLLA.Stage
     * @extends WOZLLA.GameObject
     */
    var Stage = (function (_super) {
        __extends(Stage, _super);
        function Stage() {
            _super.call(this);
            this.id = Stage.ID;
            this.name = Stage.ID;
            this._rootTransform = new WOZLLA.Transform();
            this._viewRectTransform = new WOZLLA.RectTransform();
            this._viewRectTransform.anchorMode = WOZLLA.RectTransform.ANCHOR_TOP | WOZLLA.RectTransform.ANCHOR_LEFT;
            this._viewRectTransform.width = WOZLLA.Director.getInstance().renderer.viewport.width;
            this._viewRectTransform.height = WOZLLA.Director.getInstance().renderer.viewport.height;
            this.init();
        }
        Object.defineProperty(Stage.prototype, &quot;viewRectTransform&quot;, {
            get: function () {
                return this._viewRectTransform;
            },
            enumerable: true,
            configurable: true
        });
        Stage.prototype.visitStage = function (renderer) {
            _super.prototype.visit.call(this, renderer, this._rootTransform, WOZLLA.GameObject.MASK_VISIBLE);
        };
        Stage.ID = &#39;WOZLLAStage&#39;;
        return Stage;
    })(WOZLLA.GameObject);
    WOZLLA.Stage = Stage;
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Time'>    /**
</span>     * @class WOZLLA.Time
     * @static
     */
    var Time = (function () {
        function Time() {
        }
        Time.update = function (timeScale) {
            var now = Date.now() + this._nowIncrease;
            if (this.now) {
                this.delta = (now - this.now) * timeScale;
                this._nowIncrease += this.delta * (timeScale - 1);
                this.now += this.delta;
                this.measuredFPS = 1000 / this.delta;
            }
            else {
                this.now = now;
                this.delta = 1000 / 60;
            }
        };
        Time.reset = function () {
            this.delta = 0;
            this.now = 0;
            this._nowIncrease = 0;
            this.measuredFPS = 0;
        };
<span id='WOZLLA-Time-static-property-delta'>        /**
</span>         * @property {number} delta
         * @readonly
         * @static
         */
        Time.delta = 0;
<span id='WOZLLA-Time-static-property-now'>        /**
</span>         * @property {number} now
         * @readonly
         * @static
         */
        Time.now = 0;
<span id='WOZLLA-Time-static-property-measuredFPS'>        /**
</span>         * @property {number} measuredFPS
         * @readonly
         * @static
         */
        Time.measuredFPS = 0;
        Time._nowIncrease = 0;
        return Time;
    })();
    WOZLLA.Time = Time;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Time.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Scheduler'>    /**
</span>     * @class WOZLLA.Scheduler
     * @singleton
     */
    var Scheduler = (function () {
        function Scheduler() {
            this._scheduleCount = 0;
            this._schedules = {};
            this._runScheduleCount = 0;
        }
<span id='WOZLLA-Scheduler-static-method-getInstance'>        /**
</span>         * @method {WOZLLA.Scheduler} getInstance
         * @static
         * @member WOZLLA.Scheduler
         */
        Scheduler.getInstance = function () {
            if (!Scheduler.instance) {
                Scheduler.instance = new Scheduler();
            }
            return Scheduler.instance;
        };
        Scheduler.prototype.runSchedule = function () {
            var scheduleId, scheduleItem;
            this._runScheduleCount = 0;
            for (scheduleId in this._schedules) {
                scheduleItem = this._schedules[scheduleId];
                if (scheduleItem.isFrame &amp;&amp; !scheduleItem.paused) {
                    scheduleItem.frame--;
                    if (scheduleItem.frame &lt; 0) {
                        delete this._schedules[scheduleId];
                        scheduleItem.task.apply(scheduleItem, scheduleItem.args);
                    }
                }
                else if (scheduleItem.isTime &amp;&amp; !scheduleItem.paused) {
                    scheduleItem.time -= WOZLLA.Time.delta;
                    if (scheduleItem.time &lt; 0) {
                        delete this._schedules[scheduleId];
                        scheduleItem.task.apply(scheduleItem, scheduleItem.args);
                    }
                }
                else if (scheduleItem.isInterval &amp;&amp; !scheduleItem.paused) {
                    scheduleItem.time -= WOZLLA.Time.delta;
                    if (scheduleItem.time &lt; 0) {
                        scheduleItem.task.apply(scheduleItem, scheduleItem.args);
                        scheduleItem.time += scheduleItem.intervalTime;
                    }
                }
                else if (scheduleItem.isLoop &amp;&amp; !scheduleItem.paused) {
                    scheduleItem.task.apply(scheduleItem, scheduleItem.args);
                }
                this._runScheduleCount++;
            }
        };
<span id='WOZLLA-Scheduler-method-removeSchedule'>        /**
</span>         * remove the specify schedule by id
         * @param id
         */
        Scheduler.prototype.removeSchedule = function (id) {
            delete this._schedules[id];
        };
<span id='WOZLLA-Scheduler-method-scheduleLoop'>        /**
</span>         * schedule the task to each frame
         * @param task
         * @param args
         * @returns {string} schedule id
         */
        Scheduler.prototype.scheduleLoop = function (task, args) {
            var scheduleId = &#39;Schedule_&#39; + (this._scheduleCount++);
            this._schedules[scheduleId] = {
                task: task,
                args: args,
                isLoop: true
            };
            return scheduleId;
        };
<span id='WOZLLA-Scheduler-method-scheduleFrame'>        /**
</span>         * schedule the task to the next speficied frame
         * @param task
         * @param {number} frame
         * @param args
         * @returns {string} schedule id
         */
        Scheduler.prototype.scheduleFrame = function (task, frame, args) {
            var scheduleId = &#39;Schedule_&#39; + (this._scheduleCount++);
            frame = frame || 0;
            this._schedules[scheduleId] = {
                task: task,
                frame: frame,
                args: args,
                isFrame: true
            };
            return scheduleId;
        };
<span id='WOZLLA-Scheduler-method-scheduleInterval'>        /**
</span>         * schedule the task to internal, like setInterval
         * @param task
         * @param time
         * @param args
         * @returns {string} schedule id
         */
        Scheduler.prototype.scheduleInterval = function (task, time, args) {
            var scheduleId = &#39;Schedule_&#39; + (this._scheduleCount++);
            this._schedules[scheduleId] = {
                task: task,
                intervalTime: time,
                time: time,
                args: args,
                isInterval: true
            };
            return scheduleId;
        };
<span id='WOZLLA-Scheduler-method-scheduleTime'>        /**
</span>         * schedule the task to time, like setTimeout
         * @param task
         * @param time
         * @param args
         * @returns {string} schedule id
         */
        Scheduler.prototype.scheduleTime = function (task, time, args) {
            var scheduleId = &#39;Schedule_&#39; + (this._scheduleCount++);
            time = time || 0;
            this._schedules[scheduleId] = {
                task: task,
                time: time,
                args: args,
                isTime: true
            };
            return scheduleId;
        };
<span id='WOZLLA-Scheduler-method-resumeSchedule'>        /**
</span>         * resume the specified schedule
         * @param scheduleId
         */
        Scheduler.prototype.resumeSchedule = function (scheduleId) {
            this._schedules[scheduleId].paused = false;
        };
<span id='WOZLLA-Scheduler-method-pauseSchedule'>        /**
</span>         * pause the specified schedule
         * @param scheduleId
         */
        Scheduler.prototype.pauseSchedule = function (scheduleId) {
            this._schedules[scheduleId].paused = true;
        };
        return Scheduler;
    })();
    WOZLLA.Scheduler = Scheduler;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../../libs/hammerjs.d.ts&quot;/&gt;
/// &lt;reference path=&quot;Scheduler.ts&quot;/&gt;
/// &lt;reference path=&quot;Stage.ts&quot;/&gt;
/// &lt;reference path=&quot;Director.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    function getCanvasOffset(canvas) {
        var obj = canvas;
        var offset = { x: obj.offsetLeft, y: obj.offsetTop };
        while (obj = obj.offsetParent) {
            offset.x += obj.offsetLeft;
            offset.y += obj.offsetTop;
        }
        return offset;
    }
    var GestureEvent = (function (_super) {
        __extends(GestureEvent, _super);
        function GestureEvent(params) {
            _super.call(this, params.type, params.bubbles, params.data);
            this.touchMoveDetection = false;
            this.x = params.x;
            this.y = params.y;
            this.touch = params.touch;
            this.touchMoveDetection = params.touchMoveDetection;
            this.gesture = params.gesture;
            this.identifier = params.identifier;
        }
        GestureEvent.prototype.setTouchMoveDetection = function (value) {
            this.touchMoveDetection = value;
        };
        return GestureEvent;
    })(WOZLLA.event.Event);
    WOZLLA.GestureEvent = GestureEvent;
<span id='WOZLLA-Touch'>    /**
</span>     * class for touch management &lt;br/&gt;
     * get the instance form {@link WOZLLA.Director}
     * @class WOZLLA.Touch
     * @protected
     */
    var Touch = (function () {
        function Touch(canvas, touchScale) {
            if (touchScale === void 0) { touchScale = 1; }
<span id='WOZLLA-Touch-property-enabled'>            /**
</span>             * get or set enabled of touch system
             * @property {boolean} enabled
             */
            this.enabled = true;
            this.canvas = null;
            this.canvasOffset = null;
            this.channelMap = {};
            var me = this;
            var nav = window.navigator;
            me.canvas = canvas;
            me.canvasOffset = getCanvasOffset(canvas);
            me.touchScale = touchScale;
            Hammer(nav.isCocoonJS ? document : canvas, {
                transform: false,
                doubletap: false,
                hold: false,
                rotate: false,
                pinch: false
            }).on(Touch.enabledGestures || &#39;touch release tap swipe drag dragstart dragend&#39;, function (e) {
                if (e.type === &#39;release&#39; || me.enabled) {
                    WOZLLA.Scheduler.getInstance().scheduleFrame(function () {
                        me.onGestureEvent(e);
                    });
                }
            });
        }
        Touch.setEanbledGestures = function (gestures) {
            this.enabledGestures = gestures;
        };
        Touch.prototype.onGestureEvent = function (e) {
            var x, y, i, len, touch, identifier, channel, changedTouches, target, type = e.type, stage = WOZLLA.Director.getInstance().stage;
            var me = this;
            var canvasScale = this.touchScale || 1;
            changedTouches = e.gesture.srcEvent.changedTouches;
            if (!changedTouches) {
                identifier = 1;
                x = e.gesture.srcEvent.pageX - me.canvasOffset.x;
                y = e.gesture.srcEvent.pageY - me.canvasOffset.y;
                x *= canvasScale;
                y *= canvasScale;
                if (type === &#39;touch&#39;) {
                    target = stage.getUnderPoint(x, y, true);
                    if (target) {
                        me.channelMap[identifier] = me.createDispatchChanel(target);
                    }
                    else {
                        delete me.channelMap[identifier];
                    }
                }
                channel = me.channelMap[identifier];
                channel &amp;&amp; channel.onGestureEvent(e, target, x, y, identifier);
            }
            else {
                len = changedTouches.length;
                for (i = 0; i &lt; len; i++) {
                    touch = changedTouches[i];
                    identifier = parseInt(touch.identifier);
                    x = touch.pageX - me.canvasOffset.x;
                    y = touch.pageY - me.canvasOffset.y;
                    x *= canvasScale;
                    y *= canvasScale;
                    if (type === &#39;touch&#39;) {
                        target = stage.getUnderPoint(x, y, true);
                        if (target) {
                            me.channelMap[identifier] = me.createDispatchChanel(target);
                            delete me.channelMap[identifier - 10];
                        }
                    }
                    channel = me.channelMap[identifier];
                    channel &amp;&amp; channel.onGestureEvent(e, target, x, y, identifier);
                }
            }
        };
        Touch.prototype.createDispatchChanel = function (touchTarget) {
            var touchMoveDetection = true;
            return {
                onGestureEvent: function (e, target, x, y, identifier) {
                    var touchEvent, type = e.type, stage = WOZLLA.Director.getInstance().stage;
                    switch (type) {
                        case &#39;drag&#39;:
                            if (!touchMoveDetection) {
                                target = touchTarget;
                                break;
                            }
                        case &#39;tap&#39;:
                        case &#39;release&#39;:
                            target = stage.getUnderPoint(x, y, true);
                            break;
                    }
                    if (type === &#39;tap&#39; &amp;&amp; touchTarget !== target) {
                        return;
                    }
                    touchEvent = new GestureEvent({
                        x: x,
                        y: y,
                        type: type,
                        bubbles: true,
                        touch: target,
                        gesture: e.gesture,
                        identifier: identifier,
                        touchMoveDetection: false
                    });
                    touchTarget.dispatchEvent(touchEvent);
                    touchMoveDetection = touchEvent.touchMoveDetection;
                }
            };
        };
        return Touch;
    })();
    WOZLLA.Touch = Touch;
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        function applyProperties(target, source) {
            for (var i in source) {
                if (typeof target[i] === &#39;undefined&#39;) {
                    target[i] = source[i];
                }
            }
            return target;
        }
<span id='WOZLLA-renderer-WebGLUtils'>        /**
</span>         * @class WOZLLA.renderer.WebGLUtils
         * @abstract
         */
        var WebGLUtils = (function () {
            function WebGLUtils() {
            }
            WebGLUtils.getGLContext = function (canvas, options) {
                var gl;
                options = applyProperties(options || {}, {
                    alpha: true,
                    antialias: true,
                    premultipliedAlpha: false,
                    stencil: true
                });
                try {
                    gl = canvas.getContext(&#39;experimental-webgl&#39;, options);
                }
                catch (e) {
                    try {
                        gl = canvas.getContext(&#39;webgl&#39;, options);
                    }
                    catch (e2) {
                    }
                }
                return gl;
            };
            WebGLUtils.compileShader = function (gl, shaderType, shaderSrc) {
                var src = shaderSrc;
                var shader = gl.createShader(shaderType);
                gl.shaderSource(shader, src);
                gl.compileShader(shader);
                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    console.log(gl.getShaderInfoLog(shader));
                    return null;
                }
                return shader;
            };
            WebGLUtils.compileProgram = function (gl, vertexSrc, fragmentSrc) {
                var vertexShader = WebGLUtils.compileShader(gl, gl.VERTEX_SHADER, vertexSrc);
                var fragmentShader = WebGLUtils.compileShader(gl, gl.FRAGMENT_SHADER, fragmentSrc);
                var shaderProgram = gl.createProgram();
                gl.attachShader(shaderProgram, vertexShader);
                gl.attachShader(shaderProgram, fragmentShader);
                gl.linkProgram(shaderProgram);
                if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
                    console.log(&quot;Could not initialise program&quot;);
                }
                return {
                    program: shaderProgram,
                    vertexShader: vertexShader,
                    fragmentShader: fragmentShader
                };
            };
            return WebGLUtils;
        })();
        renderer.WebGLUtils = WebGLUtils;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var ILayerManager;
        (function (ILayerManager) {
<span id='WOZLLA-renderer-ILayerManager-static-property-DEFAULT'>            /**
</span>             * @property {string} DEFAULT
             * @readonly
             * @static
             * @member WOZLLA.renderer.ILayerManager
             */
            ILayerManager.DEFAULT = &#39;default&#39;;
        })(ILayerManager = renderer.ILayerManager || (renderer.ILayerManager = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../ILayerManager.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-LayerManager'>        /**
</span>         * @class WOZLLA.renderer.LayerManager
         * @extends WOZLLA.renderer.ILayerManager
         */
        var LayerManager = (function () {
            function LayerManager() {
                this._layerIndexMap = {};
                this._sortedLayers = [];
                this.define(renderer.ILayerManager.DEFAULT, 0);
            }
            LayerManager.prototype.define = function (layer, zindex) {
                var _this = this;
                if (this._layerIndexMap[layer]) {
                    throw new Error(&#39;Layer has been defined: &#39; + layer);
                }
                this._layerIndexMap[layer] = zindex;
                this._sortedLayers.push(layer);
                this._sortedLayers.sort(function (a, b) {
                    return _this.getZIndex(a) - _this.getZIndex(b);
                });
            };
            LayerManager.prototype.undefine = function (layer) {
                this._sortedLayers.splice(this._sortedLayers.indexOf(layer), 1);
                delete this._layerIndexMap[layer];
            };
            LayerManager.prototype.getZIndex = function (layer) {
                return this._layerIndexMap[layer];
            };
            LayerManager.prototype.getSortedLayers = function () {
                return this._sortedLayers.slice(0);
            };
            LayerManager.prototype._getSortedLayers = function () {
                return this._sortedLayers;
            };
            return LayerManager;
        })();
        renderer.LayerManager = LayerManager;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-BlendType'>        /**
</span>         * @class WOZLLA.renderer.BlendType
         */
        var BlendType = (function () {
            function BlendType(srcFactor, distFactor) {
                this._srcFactor = srcFactor;
                this._distFactor = distFactor;
            }
            Object.defineProperty(BlendType.prototype, &quot;srcFactor&quot;, {
                get: function () {
                    return this._srcFactor;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(BlendType.prototype, &quot;distFactor&quot;, {
                get: function () {
                    return this._distFactor;
                },
                enumerable: true,
                configurable: true
            });
            BlendType.prototype.applyBlend = function (gl) {
                gl.blendFunc(this._srcFactor, this._distFactor);
            };
            BlendType.NORMAL = 1;
            BlendType.ADD = 2;
            BlendType.MULTIPLY = 3;
            BlendType.SCREEN = 4;
            return BlendType;
        })();
        renderer.BlendType = BlendType;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-Material'>        /**
</span>         * @class WOZLLA.renderer.Material
         * @extends WOZLLA.renderer.IMaterial
         */
        var Material = (function () {
            function Material(id, shaderProgramId, blendType) {
                this._id = id;
                this._shaderProgramId = shaderProgramId;
                this._blendType = blendType;
            }
            Object.defineProperty(Material.prototype, &quot;id&quot;, {
                get: function () {
                    return this._id;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Material.prototype, &quot;shaderProgramId&quot;, {
                get: function () {
                    return this._shaderProgramId;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Material.prototype, &quot;blendType&quot;, {
                get: function () {
                    return this._blendType;
                },
                enumerable: true,
                configurable: true
            });
            Material.prototype.equals = function (other) {
                return other.blendType === this._blendType &amp;&amp; other.shaderProgramId === this._shaderProgramId;
            };
            return Material;
        })();
        renderer.Material = Material;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var IMaterial;
        (function (IMaterial) {
<span id='WOZLLA-renderer-IMaterial-static-property-DEFAULT'>            /**
</span>             * default material key of built-in
             * @property {string} DEFAULT
             * @readonly
             * @static
             * @member WOZLLA.renderer.IMaterial
             */
            IMaterial.DEFAULT = &#39;Builtin_default&#39;;
        })(IMaterial = renderer.IMaterial || (renderer.IMaterial = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var IShaderProgram;
        (function (IShaderProgram) {
<span id='WOZLLA-renderer-IShaderProgram-static-property-V2T2C1A1'>            /**
</span>             * @property {string} V2T2C1A1
             * @readonly
             * @static
             * @member WOZLLA.renderer.IShaderProgram
             */
            IShaderProgram.V2T2C1A1 = &#39;Builtin_V2T2C1A1&#39;;
        })(IShaderProgram = renderer.IShaderProgram || (renderer.IShaderProgram = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Material.ts&quot;/&gt;
/// &lt;reference path=&quot;../IMaterial.ts&quot;/&gt;
/// &lt;reference path=&quot;../IShaderProgram.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-MaterialManager'>        /**
</span>         * @class WOZLLA.renderer.MaterialManager
         * @extends WOZLLA.renderer.IMaterialManager
         */
        var MaterialManager = (function () {
            function MaterialManager() {
                this._materialMap = {};
                this._materialMap[renderer.IMaterial.DEFAULT] = this.createMaterial(renderer.IMaterial.DEFAULT, renderer.IShaderProgram.V2T2C1A1, renderer.BlendType.NORMAL);
            }
            MaterialManager.prototype.createMaterial = function (id, shaderProgramId, blendType) {
                var material = new renderer.Material(id, shaderProgramId, blendType);
                this._materialMap[id] = material;
                return material;
            };
            MaterialManager.prototype.getMaterial = function (id) {
                return this._materialMap[id];
            };
            MaterialManager.prototype.deleteMaterial = function (material) {
                delete this._materialMap[material.id];
            };
            MaterialManager.prototype.clear = function () {
                this._materialMap = {};
            };
            return MaterialManager;
        })();
        renderer.MaterialManager = MaterialManager;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-ShaderProgram'>        /**
</span>         * @class WOZLLA.renderer.ShaderProgram
         * @extends WOZLLA.renderer.IShaderProgram
         */
        var ShaderProgram = (function () {
            function ShaderProgram(id, vertexShader, fragmentShader) {
                this._id = id;
                this._vertexShader = vertexShader;
                this._fragmentShader = fragmentShader;
            }
            Object.defineProperty(ShaderProgram.prototype, &quot;id&quot;, {
                get: function () {
                    return this._id;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ShaderProgram.prototype, &quot;vertexShader&quot;, {
                get: function () {
                    return this._vertexShader;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(ShaderProgram.prototype, &quot;fragmentShader&quot;, {
                get: function () {
                    return this._fragmentShader;
                },
                enumerable: true,
                configurable: true
            });
            ShaderProgram.prototype.useProgram = function (gl) {
                gl.useProgram(this._id);
            };
            ShaderProgram.prototype.syncUniforms = function (gl, uniforms) {
            };
            return ShaderProgram;
        })();
        renderer.ShaderProgram = ShaderProgram;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var shader;
        (function (shader) {
<span id='WOZLLA-renderer-shader-V2T2C1A1'>            /**
</span>             * @class WOZLLA.renderer.shader.V2T2C1A1
             */
            var V2T2C1A1 = (function (_super) {
                __extends(V2T2C1A1, _super);
                function V2T2C1A1(id, vertexShader, fragmentShader) {
                    _super.call(this, id, vertexShader, fragmentShader);
                    this._locations = {
                        initialized: false
                    };
                }
                V2T2C1A1.prototype.useProgram = function (gl) {
                    _super.prototype.useProgram.call(this, gl);
                    if (!this._locations.initialized) {
                        this._initLocaitions(gl);
                        this._locations.initialized = true;
                    }
                    this._activate(gl);
                };
                V2T2C1A1.prototype.syncUniforms = function (gl, uniforms) {
                    gl.uniform2f(this._locations.projectionVector, uniforms.projection.x, uniforms.projection.y);
                };
                V2T2C1A1.prototype._initLocaitions = function (gl) {
                    var program = this._id;
                    this._locations.uSampler = gl.getUniformLocation(program, &#39;uSampler&#39;);
                    this._locations.projectionVector = gl.getUniformLocation(program, &#39;projectionVector&#39;);
                    this._locations.offsetVector = gl.getUniformLocation(program, &#39;offsetVector&#39;);
                    this._locations.aVertexPosition = gl.getAttribLocation(program, &#39;aVertexPosition&#39;);
                    this._locations.aTextureCoord = gl.getAttribLocation(program, &#39;aTextureCoord&#39;);
                    this._locations.aColor = gl.getAttribLocation(program, &#39;aColor&#39;);
                };
                V2T2C1A1.prototype._activate = function (gl) {
                    gl.activeTexture(gl.TEXTURE0);
                    var stride = renderer.Quad.V2T2C1A1.strade * 4;
                    gl.vertexAttribPointer(this._locations.aVertexPosition, 2, gl.FLOAT, false, stride, 0);
                    gl.vertexAttribPointer(this._locations.aTextureCoord, 2, gl.FLOAT, false, stride, 2 * 4);
                    gl.vertexAttribPointer(this._locations.aColor, 2, gl.FLOAT, false, stride, 4 * 4);
                    gl.enableVertexAttribArray(this._locations.aVertexPosition);
                    gl.enableVertexAttribArray(this._locations.aTextureCoord);
                    gl.enableVertexAttribArray(this._locations.aColor);
                };
                V2T2C1A1.VERTEX_SOURCE = [
                    &#39;attribute vec2 aVertexPosition;\n&#39;,
                    &#39;attribute vec2 aTextureCoord;\n&#39;,
                    &#39;attribute vec2 aColor;\n&#39;,
                    &#39;uniform vec2 projectionVector;\n&#39;,
                    &#39;uniform vec2 offsetVector;\n&#39;,
                    &#39;varying vec2 vTextureCoord;\n&#39;,
                    &#39;varying vec4 vColor;\n&#39;,
                    &#39;const vec2 center = vec2(-1.0, 1.0);\n&#39;,
                    &#39;void main(void) {\n&#39;,
                    &#39;gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);\n&#39;,
                    &#39;vTextureCoord = aTextureCoord;\n&#39;,
                    &#39;vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;\n&#39;,
                    &#39;vColor = vec4(color * aColor.x, aColor.x);\n&#39;,
                    &#39;}&#39;
                ].join(&#39;&#39;);
                V2T2C1A1.FRAGMENT_SOURCE = [
                    &#39;precision mediump float;\n&#39;,
                    &#39;varying vec2 vTextureCoord;\n&#39;,
                    &#39;varying vec4 vColor;\n&#39;,
                    &#39;uniform sampler2D uSampler;\n&#39;,
                    &#39;void main(void) {\n&#39;,
                    &#39;gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;\n&#39;,
                    &#39;}&#39;
                ].join(&#39;&#39;);
                return V2T2C1A1;
            })(WOZLLA.renderer.ShaderProgram);
            shader.V2T2C1A1 = V2T2C1A1;
        })(shader = renderer.shader || (renderer.shader = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;ShaderProgram.ts&quot;/&gt;
/// &lt;reference path=&quot;../IShaderProgram.ts&quot;/&gt;
/// &lt;reference path=&quot;../shader/V2T2C1A1.ts&quot;/&gt;
/// &lt;reference path=&quot;../WebGLUtils.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-ShaderManager'>        /**
</span>         * @class WOZLLA.renderer.ShaderManager
         * @extends WOZLLA.renderer.IShaderManager
         */
        var ShaderManager = (function () {
            function ShaderManager(gl) {
                this._gl = gl;
                this._shaderMap = {};
                this._shaderMap[renderer.IShaderProgram.V2T2C1A1] = this.createShaderProgram(renderer.shader.V2T2C1A1.VERTEX_SOURCE, renderer.shader.V2T2C1A1.FRAGMENT_SOURCE, renderer.shader.V2T2C1A1);
            }
            ShaderManager.prototype.getShaderProgram = function (id) {
                return this._shaderMap[id];
            };
            ShaderManager.prototype.createShaderProgram = function (vertexSource, fragmentSource, ShaderClass) {
                if (ShaderClass === void 0) { ShaderClass = renderer.ShaderProgram; }
                var result = renderer.WebGLUtils.compileProgram(this._gl, vertexSource, fragmentSource);
                var shaderProgram = new ShaderClass(result.program, result.vertexShader, result.fragmentShader);
                this._shaderMap[shaderProgram.id] = shaderProgram;
                return shaderProgram;
            };
            ShaderManager.prototype.deleteShaderProgram = function (shaderProgram) {
                this._gl.deleteProgram(shaderProgram.id);
                this._gl.deleteShader(shaderProgram.vertexShader);
                this._gl.deleteShader(shaderProgram.fragmentShader);
                delete this._shaderMap[shaderProgram.id];
            };
            ShaderManager.prototype.clear = function () {
                for (var id in this._shaderMap) {
                    this.deleteShaderProgram(this._shaderMap[id]);
                }
            };
            return ShaderManager;
        })();
        renderer.ShaderManager = ShaderManager;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-Texture'>        /**
</span>         * @class WOZLLA.renderer.Texture
         * @extends WOZLLA.renderer.ITexture
         */
        var Texture = (function () {
            function Texture(id, descriptor) {
                this._id = id;
                this._descriptor = descriptor;
            }
            Object.defineProperty(Texture.prototype, &quot;id&quot;, {
                get: function () {
                    return this._id;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Texture.prototype, &quot;descriptor&quot;, {
                get: function () {
                    return this._descriptor;
                },
                enumerable: true,
                configurable: true
            });
            Texture.prototype.bind = function (gl) {
                gl.bindTexture(gl.TEXTURE_2D, this._id);
            };
            return Texture;
        })();
        renderer.Texture = Texture;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Texture.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        function isPowerOf2(num) {
            return (num &amp; (num - 1)) === 0;
        }
<span id='WOZLLA-renderer-TextureManager'>        /**
</span>         * @class WOZLLA.renderer.TextureManager
         * @extends WOZLLA.renderer.ITextureManager
         */
        var TextureManager = (function () {
            function TextureManager(gl) {
                this._gl = gl;
                this._textureMap = {};
            }
            TextureManager.prototype.getTexture = function (id) {
                return this._textureMap[id];
            };
            TextureManager.prototype.generateTexture = function (descriptor) {
                var texture;
                var pvrtcExt;
                var compressedType;
                var gl = this._gl;
                var id = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, id);
                gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
                if (isPowerOf2(descriptor.width) &amp;&amp; isPowerOf2(descriptor.height)) {
                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);
                }
                else {
                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                }
                switch (descriptor.textureFormat) {
                    case 0 /* PNG */:
                    case 1 /* JPEG */:
                        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, descriptor.source);
                        break;
                    case 2 /* PVR */:
                        switch (descriptor.pixelFormat) {
                            case 5 /* PVRTC2 */:
                                pvrtcExt = renderer.WebGLExtension.getExtension(gl, renderer.WebGLExtension.PVRTC);
                                compressedType = pvrtcExt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;
                                break;
                            case 4 /* PVRTC4 */:
                                pvrtcExt = renderer.WebGLExtension.getExtension(gl, renderer.WebGLExtension.PVRTC);
                                compressedType = pvrtcExt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
                                break;
                            default:
                                throw new Error(&#39;Unsupported pixel format: &#39; + descriptor.pixelFormat);
                        }
                        gl.compressedTexImage2D(gl.TEXTURE_2D, 0, compressedType, descriptor.width, descriptor.height, 0, descriptor.source);
                        break;
                    default:
                        throw new Error(&#39;Unsupported texture format: &#39; + descriptor.textureFormat);
                }
                texture = new renderer.Texture(id, descriptor);
                this._textureMap[id] = texture;
                return texture;
            };
            TextureManager.prototype.deleteTexture = function (texture) {
                this._gl.deleteTexture(texture.id);
                delete this._textureMap[texture.id];
            };
            TextureManager.prototype.clear = function () {
                for (var id in this._textureMap) {
                    this.deleteTexture(this._textureMap[id]);
                }
            };
            return TextureManager;
        })();
        renderer.TextureManager = TextureManager;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;LayerManager.ts&quot;/&gt;
/// &lt;reference path=&quot;../BlendType.ts&quot;/&gt;
/// &lt;reference path=&quot;MaterialManager.ts&quot;/&gt;
/// &lt;reference path=&quot;ShaderManager.ts&quot;/&gt;
/// &lt;reference path=&quot;TextureManager.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var Renderer = (function () {
            function Renderer(gl, viewport) {
                this._commandQueueMap = {};
                this._blendModes = {};
                this._uniforms = {};
                this._gl = gl;
                this._viewport = viewport;
                this._blendModes[renderer.BlendType.NORMAL] = new renderer.BlendType(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
                this._blendModes[renderer.BlendType.ADD] = new renderer.BlendType(gl.SRC_ALPHA, gl.DST_ALPHA);
                this._blendModes[renderer.BlendType.MULTIPLY] = new renderer.BlendType(gl.DST_COLOR, gl.ONE_MINUS_SRC_ALPHA);
                this._blendModes[renderer.BlendType.SCREEN] = new renderer.BlendType(gl.SRC_ALPHA, gl.ONE);
                this._layerManager = new renderer.LayerManager();
                this._materialManager = new renderer.MaterialManager();
                this._shaderManager = new renderer.ShaderManager(gl);
                this._textureManager = new renderer.TextureManager(gl);
                this._quadBatch = new QuadBatch(gl);
                this._uniforms.projection = {
                    x: viewport.width / 2,
                    y: -viewport.height / 2
                };
                gl.disable(gl.DEPTH_TEST);
                gl.disable(gl.CULL_FACE);
                gl.enable(gl.BLEND);
            }
            Object.defineProperty(Renderer.prototype, &quot;layerManager&quot;, {
                get: function () {
                    return this._layerManager;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Renderer.prototype, &quot;materialManager&quot;, {
                get: function () {
                    return this._materialManager;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Renderer.prototype, &quot;shaderManager&quot;, {
                get: function () {
                    return this._shaderManager;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Renderer.prototype, &quot;textureManager&quot;, {
                get: function () {
                    return this._textureManager;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Renderer.prototype, &quot;gl&quot;, {
                get: function () {
                    return this._gl;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Renderer.prototype, &quot;viewport&quot;, {
                get: function () {
                    return this._viewport;
                },
                enumerable: true,
                configurable: true
            });
            Renderer.prototype.addCommand = function (command) {
                var layer = command.layer;
                var commandQueue = this._commandQueueMap[layer];
                if (!commandQueue) {
                    commandQueue = this._commandQueueMap[layer] = new CommandQueue(layer);
                }
                commandQueue.add(command);
            };
            Renderer.prototype.render = function () {
                var _this = this;
                var lastCommand;
                var currentTexture;
                var currentMaterial;
                var gl = this._gl;
                gl.viewport(0, 0, this._viewport.width, this._viewport.height);
                gl.clearColor(0, 0, 0, 0);
                gl.clear(gl.COLOR_BUFFER_BIT);
                this._eachCommand(function (command) {
                    var quadCommand;
                    var customCommand;
                    if (!lastCommand) {
                        _this.flush();
                    }
                    else if (lastCommand instanceof renderer.CustomCommand) {
                        _this.flush();
                    }
                    else if (command instanceof renderer.CustomCommand) {
                        _this.flush();
                    }
                    else if (command.materialId !== currentMaterial.id) {
                        _this.flush();
                    }
                    else if (command.texture !== currentTexture) {
                        _this.flush();
                    }
                    if (command instanceof renderer.CustomCommand) {
                        customCommand = command;
                        customCommand.execute(_this);
                    }
                    else {
                        quadCommand = command;
                        if (_this._quadBatch.canFill(quadCommand.quad)) {
                            _this._quadBatch.fillQuad(quadCommand.quad);
                        }
                        else {
                            _this.flush();
                            _this._quadBatch.fillQuad(quadCommand.quad);
                        }
                    }
                    _this._usingMaterial = currentMaterial = _this._materialManager.getMaterial(command.materialId);
                    _this._usingTexture = currentTexture = command.texture;
                    lastCommand = command;
                });
                if (lastCommand) {
                    this.flush();
                    this._clearCommands();
                    this._usingTexture = null;
                    this._usingMaterial = null;
                }
            };
            Renderer.prototype.flush = function () {
                var gl, shaderProgram;
                if (!this._usingMaterial) {
                    return;
                }
                gl = this._gl;
                shaderProgram = this._shaderManager.getShaderProgram(this._usingMaterial.shaderProgramId);
                shaderProgram.useProgram(gl);
                shaderProgram.syncUniforms(gl, this._uniforms);
                this._blendModes[this._usingMaterial.blendType].applyBlend(gl);
                if (this._usingTexture) {
                    this._usingTexture.bind(gl);
                }
                this._quadBatch.flush(gl);
            };
            Renderer.prototype._clearCommands = function () {
                var commandQueueMap = this._commandQueueMap;
                for (var layer in commandQueueMap) {
                    commandQueueMap[layer].clear();
                }
            };
            Renderer.prototype._eachCommand = function (func) {
                var i, len, j, len2;
                var layer;
                var commandQueue;
                var zQueue;
                var command;
                var commandQueueMap = this._commandQueueMap;
                var layers = this._layerManager._getSortedLayers();
                for (i = 0, len = layers.length; i &lt; len; i++) {
                    layer = layers[i];
                    commandQueue = commandQueueMap[layer];
                    if (commandQueue) {
                        zQueue = commandQueue.negativeZQueue;
                        if (zQueue.length &gt; 0) {
                            for (j = 0, len2 = zQueue.length; j &lt; len2; j++) {
                                command = zQueue[j];
                                func(command);
                            }
                        }
                        zQueue = commandQueue.zeroZQueue;
                        if (zQueue.length &gt; 0) {
                            for (j = 0, len2 = zQueue.length; j &lt; len2; j++) {
                                command = zQueue[j];
                                func(command);
                            }
                        }
                        zQueue = commandQueue.positiveZQueue;
                        if (zQueue.length &gt; 0) {
                            for (j = 0, len2 = zQueue.length; j &lt; len2; j++) {
                                command = zQueue[j];
                                func(command);
                            }
                        }
                    }
                }
            };
            Renderer.MAX_QUAD_SIZE = 500;
            return Renderer;
        })();
        renderer.Renderer = Renderer;
        function compareCommandByGlobalZ(a, b) {
            if (a.globalZ === b.globalZ) {
                return a._addIndex - b._addIndex;
            }
            return a.globalZ - b.globalZ;
        }
        var CommandQueue = (function () {
            function CommandQueue(layer) {
                this._addIndex = 0;
                this.negativeZQueue = [];
                this.zeroZQueue = [];
                this.positiveZQueue = [];
                this.layer = layer;
            }
            CommandQueue.prototype.add = function (command) {
                command._addIndex = this._addIndex++;
                if (command.globalZ === 0) {
                    this.zeroZQueue.push(command);
                }
                else if (command.globalZ &gt; 0) {
                    this.positiveZQueue.push(command);
                }
                else {
                    this.negativeZQueue.push(command);
                }
            };
            CommandQueue.prototype.clear = function () {
                var i, len, command;
                for (i = 0, len = this.negativeZQueue.length; i &lt; len; i++) {
                    command = this.negativeZQueue[i];
                    if (command.isPoolable) {
                        command.release();
                    }
                }
                for (i = 0, len = this.zeroZQueue.length; i &lt; len; i++) {
                    command = this.zeroZQueue[i];
                    if (command.isPoolable) {
                        command.release();
                    }
                }
                for (i = 0, len = this.positiveZQueue.length; i &lt; len; i++) {
                    command = this.positiveZQueue[i];
                    if (command.isPoolable) {
                        command.release();
                    }
                }
                this.negativeZQueue.length = 0;
                this.zeroZQueue.length = 0;
                this.positiveZQueue.length = 0;
                this._addIndex = 0;
            };
            CommandQueue.prototype.sort = function () {
                this.positiveZQueue.sort(compareCommandByGlobalZ);
                this.negativeZQueue.sort(compareCommandByGlobalZ);
            };
            return CommandQueue;
        })();
        var QuadBatch = (function () {
            function QuadBatch(gl) {
                this._size = Renderer.MAX_QUAD_SIZE;
                this._curVertexIndex = 0;
                this._curBatchSize = 0;
                this._gl = gl;
                this._initBuffers();
            }
            Object.defineProperty(QuadBatch.prototype, &quot;vertexBuffer&quot;, {
                get: function () {
                    return this._vertexBuffer;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadBatch.prototype, &quot;indexBuffer&quot;, {
                get: function () {
                    return this._indexBuffer;
                },
                enumerable: true,
                configurable: true
            });
            QuadBatch.prototype.canFill = function (quad) {
                return this._curVertexIndex &lt; this._size;
            };
            QuadBatch.prototype.fillQuad = function (quad) {
                var vertexIndex, storage;
                var vertices = this._vertices;
                vertexIndex = this._curVertexIndex;
                if (quad.count === quad.renderCount) {
                    vertices.set(quad.storage, vertexIndex);
                }
                else {
                    var j = 0;
                    var i = quad.renderOffset * quad.type.size;
                    var len = quad.renderCount * quad.type.size;
                    storage = quad.storage;
                    for (; j &lt; len; i++, j++) {
                        vertices[vertexIndex + j] = storage[i];
                    }
                }
                this._curVertexIndex += quad.renderCount * quad.type.size;
                this._curBatchSize += quad.renderCount;
            };
            QuadBatch.prototype.flush = function (gl) {
                if (this._curBatchSize === 0) {
                    return;
                }
                gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, this._vertices, gl.DYNAMIC_DRAW);
                gl.drawElements(gl.TRIANGLES, this._curBatchSize * 6, gl.UNSIGNED_SHORT, 0);
                this._curVertexIndex = 0;
                this._curBatchSize = 0;
            };
            QuadBatch.prototype._initBuffers = function () {
                var i, j;
                var gl = this._gl;
                var numVerts = this._size * 4 * 6;
                var numIndices = this._size * 6;
                this._vertices = new Float32Array(numVerts);
                this._indices = new Uint16Array(numIndices);
                for (i = 0, j = 0; i &lt; numIndices; i += 6, j += 4) {
                    this._indices[i] = j;
                    this._indices[i + 1] = j + 1;
                    this._indices[i + 2] = j + 2;
                    this._indices[i + 3] = j;
                    this._indices[i + 4] = j + 2;
                    this._indices[i + 5] = j + 3;
                }
                // create a couple of buffers
                this._vertexBuffer = gl.createBuffer();
                this._indexBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);
                gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this._indices, gl.STATIC_DRAW);
                gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, this._vertices, gl.DYNAMIC_DRAW);
            };
            return QuadBatch;
        })();
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Stage.ts&quot;/&gt;
/// &lt;reference path=&quot;Touch.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/WebGLUtils.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/internal/Renderer.ts&quot;/&gt;
/// &lt;reference path=&quot;Scheduler.ts&quot;/&gt;
/// &lt;reference path=&quot;../assets/AssetLoader.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var requestAnimationFrame = window.requestAnimationFrame || window.msRequestAnimationFrame || function (frameCall, intervalTime) {
        if (intervalTime === void 0) { intervalTime = 1000 / 62; }
        setTimeout(frameCall, intervalTime);
    };
<span id='WOZLLA-Director'>    /**
</span>     * a director hold this instances: &lt;br/&gt;
     * 1. {@link WOZLLA.Stage} &lt;br/&gt;
     * 2. {@link WOZLLA.renderer.IRenderer} &lt;br/&gt;
     * 3. {@link WOZLLA.Scheduler} &lt;br/&gt;
     * 4. {@link WOZLLA.Touch} &lt;br/&gt;
     * 5. {@link WOZLLA.assets.AssetLoader} &lt;br/&gt;
     * &lt;br/&gt;
     * &lt;br/&gt;
     * and also responsable to setup engine and control main loop.
     *
     * @class WOZLLA.Director
     * @singleton
     */
    var Director = (function () {
        function Director(view, options) {
            if (options === void 0) { options = {}; }
            this._runing = false;
            this._paused = false;
            this._timeScale = 1;
            Director.instance = this;
            this._view = typeof view === &#39;string&#39; ? document.getElementById(&#39;canvas&#39;) : view;
            this._scheduler = WOZLLA.Scheduler.getInstance();
            this._assetLoader = WOZLLA.assets.AssetLoader.getInstance();
            this._touch = new WOZLLA.Touch(view, options.touchScale);
            this._renderer = new WOZLLA.renderer.Renderer(WOZLLA.renderer.WebGLUtils.getGLContext(view, options.renderer), {
                x: 0,
                y: 0,
                width: view.width,
                height: view.height
            });
            this._stage = new WOZLLA.Stage();
        }
        Director.getInstance = function () {
            return Director.instance;
        };
        Object.defineProperty(Director.prototype, &quot;view&quot;, {
<span id='WOZLLA-Director-property-view'>            /**
</span>             * get the canvas element
             * @property {any} view
             */
            get: function () {
                return this._view;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Director.prototype, &quot;touch&quot;, {
<span id='WOZLLA-Director-property-touch'>            /**
</span>             * get the touch instance
             * @property {WOZLLA.Touch} touch
             * @readonly
             */
            get: function () {
                return this._touch;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Director.prototype, &quot;stage&quot;, {
<span id='WOZLLA-Director-property-stage'>            /**
</span>             * get the stage instance
             * @property {WOZLLA.Stage} stage
             * @readonly
             */
            get: function () {
                return this._stage;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Director.prototype, &quot;scheduler&quot;, {
<span id='WOZLLA-Director-property-scheduler'>            /**
</span>             * get the scheduler instance
             * @property {WOZLLA.Scheduler} scheduler
             * @readonly
             */
            get: function () {
                return this._scheduler;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Director.prototype, &quot;renderer&quot;, {
<span id='WOZLLA-Director-property-renderer'>            /**
</span>             * get the renderer instance
             * @property {WOZLLA.renderer.IRenderer} renderer
             * @readonly
             */
            get: function () {
                return this._renderer;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Director.prototype, &quot;assetLoader&quot;, {
<span id='WOZLLA-Director-property-assetLoader'>            /**
</span>             * get the asset loader instance
             * @property {WOZLLA.assets.AssetLoader} assetLoader
             * @readonly
             */
            get: function () {
                return this._assetLoader;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Director.prototype, &quot;viewRectTransform&quot;, {
<span id='WOZLLA-Director-method-get'>            /**
</span>             * get the root instance of RectTransform
             * @returns {WOZLLA.RectTransform}
             */
            get: function () {
                return this._stage.viewRectTransform;
            },
            enumerable: true,
            configurable: true
        });
<span id='WOZLLA-Director-method-start'>        /**
</span>         *  start main loop
         */
        Director.prototype.start = function () {
            var _this = this;
            var frame;
            if (this._runing) {
                return;
            }
            this._runing = true;
            WOZLLA.Time.reset();
            frame = function () {
                if (_this._runing) {
                    requestAnimationFrame(frame);
                }
                _this.runStep();
            };
            requestAnimationFrame(frame);
        };
<span id='WOZLLA-Director-method-stop'>        /**
</span>         * stop main loop
         */
        Director.prototype.stop = function () {
            this._runing = false;
        };
<span id='WOZLLA-Director-method-runStep'>        /**
</span>         * run one frame
         * @param {number} [timeScale=1]
         */
        Director.prototype.runStep = function (timeScale) {
            if (timeScale === void 0) { timeScale = this._timeScale; }
            WOZLLA.Time.update(timeScale);
            this._stage.update();
            this._stage.visitStage(this._renderer);
            this._renderer.render();
            this._scheduler.runSchedule();
            WOZLLA.utils.Tween.tick(WOZLLA.Time.delta);
        };
        return Director;
    })();
    WOZLLA.Director = Director;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Asset.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/ITexture.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/IRenderer.ts&quot;/&gt;
/// &lt;reference path=&quot;../core/Director.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var assets;
    (function (assets) {
<span id='WOZLLA-assets-GLTextureAsset'>        /**
</span>         * internal class
         * @class WOZLLA.assets.GLTextureAsset
         * @extends WOZLLA.assets.Asset
         * @abstract
         */
        var GLTextureAsset = (function (_super) {
            __extends(GLTextureAsset, _super);
            function GLTextureAsset(src) {
                _super.call(this, src);
            }
            Object.defineProperty(GLTextureAsset.prototype, &quot;glTexture&quot;, {
                get: function () {
                    return this._glTexture;
                },
                enumerable: true,
                configurable: true
            });
            GLTextureAsset.prototype._generateTexture = function (image) {
                var renderer = WOZLLA.Director.getInstance().renderer;
                if (!renderer) {
                    throw new Error(&quot;Director not initialized&quot;);
                }
                this._glTexture = renderer.textureManager.generateTexture(new HTMLImageDescriptor(image));
            };
            GLTextureAsset.prototype._generatePVRTexture = function (pvrSource) {
                throw new Error(&quot;Unsupported now&quot;);
            };
            return GLTextureAsset;
        })(assets.Asset);
        assets.GLTextureAsset = GLTextureAsset;
        var HTMLImageDescriptor = (function () {
            function HTMLImageDescriptor(source) {
                this._source = source;
                this._textureFormat = 0 /* PNG */;
                this._pixelFormat = 0 /* RGBA8888 */;
            }
            Object.defineProperty(HTMLImageDescriptor.prototype, &quot;width&quot;, {
                get: function () {
                    return this._source.width;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HTMLImageDescriptor.prototype, &quot;height&quot;, {
                get: function () {
                    return this._source.height;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HTMLImageDescriptor.prototype, &quot;source&quot;, {
                get: function () {
                    return this._source;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HTMLImageDescriptor.prototype, &quot;textureFormat&quot;, {
                get: function () {
                    return this._textureFormat;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(HTMLImageDescriptor.prototype, &quot;pixelFormat&quot;, {
                get: function () {
                    return this._pixelFormat;
                },
                enumerable: true,
                configurable: true
            });
            return HTMLImageDescriptor;
        })();
        assets.HTMLImageDescriptor = HTMLImageDescriptor;
        var PVRDescriptor = (function () {
            function PVRDescriptor(source, pixelFormat) {
                this._source = source;
                this._textureFormat = 2 /* PVR */;
                this._pixelFormat = pixelFormat;
            }
            Object.defineProperty(PVRDescriptor.prototype, &quot;width&quot;, {
                get: function () {
                    return this._source.width;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PVRDescriptor.prototype, &quot;height&quot;, {
                get: function () {
                    return this._source.height;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PVRDescriptor.prototype, &quot;source&quot;, {
                get: function () {
                    return this._source;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PVRDescriptor.prototype, &quot;textureFormat&quot;, {
                get: function () {
                    return this._textureFormat;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(PVRDescriptor.prototype, &quot;pixelFormat&quot;, {
                get: function () {
                    return this._pixelFormat;
                },
                enumerable: true,
                configurable: true
            });
            return PVRDescriptor;
        })();
        assets.PVRDescriptor = PVRDescriptor;
    })(assets = WOZLLA.assets || (WOZLLA.assets = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var assets;
    (function (assets) {
<span id='WOZLLA-assets-Sprite'>        /**
</span>         * an sprite is a part of a sprite atlas
         * @class WOZLLA.assets.Sprite
         * &lt;br/&gt;
         * see also: &lt;br/&gt;
         * {@link WOZLLA.assets.SpriteAtlas}&lt;br/&gt;
         */
        var Sprite = (function () {
<span id='WOZLLA-assets-Sprite-method-constructor'>            /**
</span>             * new a sprite
             * @method constructor
             * @param spriteAtlas
             * @param frame
             * @param name
             */
            function Sprite(spriteAtlas, frame, name) {
                this._spriteAtlas = spriteAtlas;
                this._frame = frame;
                this._name = name;
            }
            Object.defineProperty(Sprite.prototype, &quot;spriteAtlas&quot;, {
<span id='WOZLLA-assets-Sprite-property-spriteAltas'>                /**
</span>                 * get the sprite atlas of this sprite belongs to
                 * @property {WOZLLA.assets.SpriteAtlas} spriteAltas
                 * @readonly
                 */
                get: function () {
                    return this._spriteAtlas;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Sprite.prototype, &quot;frame&quot;, {
<span id='WOZLLA-assets-Sprite-property-frame'>                /**
</span>                 * get frame info
                 * @property {any} frame
                 * @readonly
                 */
                get: function () {
                    return this._frame;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Sprite.prototype, &quot;name&quot;, {
<span id='WOZLLA-assets-Sprite-property-name'>                /**
</span>                 * get sprite name
                 * @property {string} name
                 * @readonly
                 */
                get: function () {
                    return this._name;
                },
                enumerable: true,
                configurable: true
            });
            return Sprite;
        })();
        assets.Sprite = Sprite;
    })(assets = WOZLLA.assets || (WOZLLA.assets = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var utils;
    (function (utils) {
        function applyProperties(target, source) {
            for (var i in source) {
                if (typeof target[i] === &#39;undefined&#39;) {
                    target[i] = source[i];
                }
            }
            return target;
        }
        var contentParser = {
            &#39;json&#39;: function (xhr) {
                return JSON.parse(xhr.responseText);
            },
            &#39;arraybuffer&#39;: function (xhr) {
                return xhr.response;
            }
        };
        var empty = function () {
        };
<span id='WOZLLA-utils-Ajax'>        /**
</span>         * @class WOZLLA.utils.Ajax
         */
        var Ajax = (function () {
            function Ajax() {
            }
<span id='WOZLLA-utils-Ajax-method-request'>            /**
</span>             * send a request with options
             * @param {object} options
             * @param {boolean} options.async
             * @param {string} options.method GET/POST
             * @param {string} options.contentType text/json/xml
             * @param {string} options.responseType text/plain,text/javascript,text/css,arraybuffer
             * @param {number} [options.timeout=30000]
             * @param {function} options.success call when ajax request successfully
             * @param {function} options.error call when ajax request error
             */
            Ajax.request = function (options) {
                if (options === void 0) { options = {}; }
                var xhr;
                var timeoutId;
                options = applyProperties(options, {
                    url: &#39;&#39;,
                    async: true,
                    method: &#39;GET&#39;,
                    contentType: &#39;text&#39;,
                    responseType: &#39;text/plain&#39;,
                    timeout: 30000,
                    success: empty,
                    error: empty
                });
                xhr = new XMLHttpRequest();
                xhr.responseType = options.responseType;
                xhr.onreadystatechange = function () {
                    var parser;
                    if (xhr.readyState === 4) {
                        xhr.onreadystatechange = empty;
                        clearTimeout(timeoutId);
                        parser = contentParser[options.contentType] || function () {
                            return xhr.responseText;
                        };
                        options.success(parser(xhr));
                    }
                };
                xhr.open(options.method, options.url, options.async);
                timeoutId = setTimeout(function () {
                    xhr.onreadystatechange = empty;
                    xhr.abort();
                    options.error({
                        code: Ajax.ERROR_TIMEOUT,
                        message: &#39;request timeout&#39;
                    });
                }, options.timeout);
                xhr.send();
            };
<span id='WOZLLA-utils-Ajax-static-property-ERROR_TIMEOUT'>            /**
</span>             * internal ajax error code when timeout
             * @property ERROR_TIMEOUT
             * @static
             * @readonly
             */
            Ajax.ERROR_TIMEOUT = 1;
<span id='WOZLLA-utils-Ajax-static-property-ERROR_SERVER'>            /**
</span>             * internal ajax error code when server error
             * @property ERROR_SERVER
             * @static
             * @readonly
             */
            Ajax.ERROR_SERVER = 2;
            return Ajax;
        })();
        utils.Ajax = Ajax;
    })(utils = WOZLLA.utils || (WOZLLA.utils = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Sprite.ts&quot;/&gt;
/// &lt;reference path=&quot;../utils/Ajax.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var assets;
    (function (assets) {
        var imageTest = /(\.png|\.jpg)$/i;
        function isImageURL(url) {
            return imageTest.test(url);
        }
        function getFileName(url) {
            var idx = url.lastIndexOf(&#39;/&#39;);
            if (idx !== -1) {
                return url.substr(idx + 1, url.length);
            }
            return url;
        }
<span id='WOZLLA-assets-SpriteAtlas'>        /**
</span>         * a sprite atlas contains many {@link WOZLLA.assets.Sprite}.
         * it&#39;s recommended to user {@link WOZLLA.assets.AssetLoader} to load SpriteAtlas.
         * @class WOZLLA.assets.SpriteAtlas
         * @extends WOZLLA.assets.GLTextureAsset
         * &lt;br/&gt;
         * see also:
         * {@link WOZLLA.assets.Sprite}
         * {@link WOZLLA.assets.AssetLoader}
         */
        var SpriteAtlas = (function (_super) {
            __extends(SpriteAtlas, _super);
<span id='WOZLLA-assets-SpriteAtlas-method-constructor'>            /**
</span>             * new a SpriteAtlas
             * @method constructor
             * @param src
             */
            function SpriteAtlas(src) {
                _super.call(this, src);
                this._spriteCache = {};
            }
            Object.defineProperty(SpriteAtlas.prototype, &quot;imageSrc&quot;, {
<span id='WOZLLA-assets-SpriteAtlas-property-imageSrc'>                /**
</span>                 * @property {string} imageSrc
                 * @readonly
                 */
                get: function () {
                    return this._imageSrc;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteAtlas.prototype, &quot;metaSrc&quot;, {
<span id='WOZLLA-assets-SpriteAtlas-property-metaSrc'>                /**
</span>                 * an file url descript sprite atlas infos.
                 * @property {string} metaSrc
                 * @readonly
                 */
                get: function () {
                    return this._metaSrc;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteAtlas.prototype, &quot;sourceImage&quot;, {
<span id='WOZLLA-assets-SpriteAtlas-property-sourceImage'>                /**
</span>                 * @property {any} sourceImage
                 * @readonly
                 */
                get: function () {
                    return this._sourceImage;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteAtlas.prototype, &quot;spriteData&quot;, {
<span id='WOZLLA-assets-SpriteAtlas-property-spriteData'>                /**
</span>                 * @property {any} spriteData
                 * @readonly
                 */
                get: function () {
                    return this._spriteData;
                },
                enumerable: true,
                configurable: true
            });
<span id='WOZLLA-assets-SpriteAtlas-method-getSprite'>            /**
</span>             * get sprite by name
             * @param name
             * @returns {WOZLLA.assets.Sprite}
             */
            SpriteAtlas.prototype.getSprite = function (name) {
                var frameData, sprite;
                if (!name) {
                    return this._entireSprite;
                }
                sprite = this._spriteCache[name];
                if (sprite) {
                    return sprite;
                }
                if (!this._spriteData) {
                    return null;
                }
                frameData = this._spriteData.frames[name];
                if (frameData) {
                    sprite = new assets.Sprite(this, {
                        x: frameData.frame.x,
                        y: frameData.frame.y,
                        width: frameData.frame.w,
                        height: frameData.frame.h
                    }, name);
                    this._spriteCache[name] = sprite;
                    return sprite;
                }
                return null;
            };
<span id='WOZLLA-assets-SpriteAtlas-method-load'>            /**
</span>             * load this asset
             * @param onSuccess
             * @param onError
             */
            SpriteAtlas.prototype.load = function (onSuccess, onError) {
                var _this = this;
                if (isImageURL(this.src)) {
                    this._imageSrc = this.src;
                    this._loadImage(function (error, image) {
                        if (error) {
                            onError &amp;&amp; onError(error);
                        }
                        else {
                            _this._generateTexture(image);
                            _this._sourceImage = image;
                            _this._entireSprite = new assets.Sprite(_this, {
                                x: 0,
                                y: 0,
                                width: image.width,
                                height: image.height
                            });
                            onSuccess &amp;&amp; onSuccess();
                        }
                    });
                }
                else {
                    this._metaSrc = this.src;
                    this._loadSpriteAtlas(function (error, image, spriteData) {
                        if (error) {
                            onError &amp;&amp; onError(error);
                        }
                        else {
                            _this._sourceImage = image;
                            _this._generateTexture(image);
                            _this._entireSprite = new assets.Sprite(_this, {
                                x: 0,
                                y: 0,
                                width: image.width,
                                height: image.height
                            });
                            _this._spriteData = spriteData;
                            onSuccess &amp;&amp; onSuccess();
                        }
                    });
                }
            };
            SpriteAtlas.prototype._loadImage = function (callback) {
                var _this = this;
                var image = new Image();
                image.src = this._imageSrc;
                image.onload = function () {
                    callback &amp;&amp; callback(null, image);
                };
                image.onerror = function () {
                    callback(&#39;Fail to load image: &#39; + _this._imageSrc);
                };
            };
            SpriteAtlas.prototype._loadSpriteAtlas = function (callback) {
                var me = this;
                WOZLLA.utils.Ajax.request({
                    url: me._metaSrc,
                    contentType: &#39;json&#39;,
                    success: function (data) {
                        var imageSuffix = data.meta.image;
                        var metaFileName = getFileName(me._metaSrc);
                        me._imageSrc = me._metaSrc.replace(new RegExp(metaFileName + &#39;$&#39;), imageSuffix);
                        me._loadImage(function (error, image) {
                            if (error) {
                                callback &amp;&amp; callback(error);
                            }
                            else {
                                callback &amp;&amp; callback(null, image, data);
                            }
                        });
                    },
                    error: function (err) {
                        callback(&#39;Fail to load sprite: &#39; + this._metaSrc + &#39;, &#39; + err.code + &#39;:&#39; + err.message);
                    }
                });
            };
            return SpriteAtlas;
        })(assets.GLTextureAsset);
        assets.SpriteAtlas = SpriteAtlas;
    })(assets = WOZLLA.assets || (WOZLLA.assets = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var math;
    (function (math) {
<span id='WOZLLA-math-Rectangle'>        /**
</span>         * @class WOZLLA.math.Rectangle
         *  a utils class for rectangle, provider some math methods
         */
        var Rectangle = (function () {
            function Rectangle(x, y, width, height) {
<span id='WOZLLA-math-Rectangle-property-x'>                /**
</span>                 * get or set x
                 * @property {number} x
                 */
                this.x = x;
<span id='WOZLLA-math-Rectangle-property-y'>                /**
</span>                 * get or set y
                 * @property {number} y
                 */
                this.y = y;
<span id='WOZLLA-math-Rectangle-property-width'>                /**
</span>                 * get or set width
                 * @property {number} width
                 */
                this.width = width;
<span id='WOZLLA-math-Rectangle-property-height'>                /**
</span>                 * get or set height
                 * @property {number} height
                 */
                this.height = height;
            }
            Object.defineProperty(Rectangle.prototype, &quot;left&quot;, {
<span id='WOZLLA-math-Rectangle-property-left'>                /**
</span>                 * @property {number} left x
                 * @readonly
                 */
                get: function () {
                    return this.x;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rectangle.prototype, &quot;right&quot;, {
<span id='WOZLLA-math-Rectangle-property-right'>                /**
</span>                 * @property {number} right x+width
                 * @readonly
                 */
                get: function () {
                    return this.x + this.width;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rectangle.prototype, &quot;top&quot;, {
<span id='WOZLLA-math-Rectangle-property-top'>                /**
</span>                 * @property {number} top y
                 * @readonly
                 */
                get: function () {
                    return this.y;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Rectangle.prototype, &quot;bottom&quot;, {
<span id='WOZLLA-math-Rectangle-property-bottom'>                /**
</span>                 * @property {number} bottom y+height
                 * @readonly
                 */
                get: function () {
                    return this.y + this.height;
                },
                enumerable: true,
                configurable: true
            });
<span id='WOZLLA-math-Rectangle-method-containsXY'>            /**
</span>             * @method containsXY
             * @param x
             * @param y
             * @returns {boolean}
             */
            Rectangle.prototype.containsXY = function (x, y) {
                return this.x &lt;= x &amp;&amp; this.right &gt; x &amp;&amp; this.y &lt;= y &amp;&amp; this.bottom &gt; y;
            };
<span id='WOZLLA-math-Rectangle-method-toString'>            /**
</span>             * get simple description of this object
             * @returns {string}
             */
            Rectangle.prototype.toString = function () {
                return &#39;Rectangle[&#39; + this.x + &#39;,&#39; + this.y + &#39;,&#39; + this.width + &#39;,&#39; + this.height + &#39;]&#39;;
            };
            return Rectangle;
        })();
        math.Rectangle = Rectangle;
    })(math = WOZLLA.math || (WOZLLA.math = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../../core/Collider.ts&quot;/&gt;
/// &lt;reference path=&quot;../../math/Rectangle.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
<span id='WOZLLA-component-CircleCollider'>        /**
</span>         * @class WOZLLA.component.CircleCollider
         */
        var CircleCollider = (function (_super) {
            __extends(CircleCollider, _super);
            function CircleCollider() {
                _super.apply(this, arguments);
            }
            CircleCollider.prototype.collideXY = function (localX, localY) {
                return this.region &amp;&amp; this.region.containsXY(localX, localY);
            };
            CircleCollider.prototype.collide = function (collider) {
                return false;
            };
            return CircleCollider;
        })(WOZLLA.Collider);
        component.CircleCollider = CircleCollider;
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../../core/Collider.ts&quot;/&gt;
/// &lt;reference path=&quot;../../math/Rectangle.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
<span id='WOZLLA-component-MaskCollider'>        /**
</span>         * @class WOZLLA.component.MaskCollider
         */
        var MaskCollider = (function (_super) {
            __extends(MaskCollider, _super);
            function MaskCollider() {
                _super.apply(this, arguments);
            }
            MaskCollider.prototype.collideXY = function (localX, localY) {
                return true;
            };
            MaskCollider.prototype.collide = function (collider) {
                return false;
            };
            return MaskCollider;
        })(WOZLLA.Collider);
        component.MaskCollider = MaskCollider;
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../../core/Collider.ts&quot;/&gt;
/// &lt;reference path=&quot;../../math/Rectangle.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
<span id='WOZLLA-component-RectCollider'>        /**
</span>         * @class WOZLLA.component.RectCollider
         */
        var RectCollider = (function (_super) {
            __extends(RectCollider, _super);
            function RectCollider() {
                _super.apply(this, arguments);
            }
            RectCollider.fromSpriteRenderer = function (spriteRenderer) {
                var rectCollider = new WOZLLA.component.RectCollider();
                var frame = spriteRenderer.sprite.frame;
                var offset = spriteRenderer.spriteOffset;
                rectCollider.region = new WOZLLA.math.Rectangle(0 - frame.width * offset.x, 0 - frame.height * offset.y, frame.width, frame.height);
                return rectCollider;
            };
            RectCollider.prototype.collideXY = function (localX, localY) {
                return this.region &amp;&amp; this.region.containsXY(localX, localY);
            };
            RectCollider.prototype.collide = function (collider) {
                return false;
            };
            return RectCollider;
        })(WOZLLA.Collider);
        component.RectCollider = RectCollider;
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-RenderCommandBase'>        /**
</span>         * @class WOZLLA.renderer.RenderCommandBase
         * @abstract
         */
        var RenderCommandBase = (function () {
            function RenderCommandBase(globalZ, layer) {
                this._globalZ = globalZ;
                this._layer = layer;
            }
            Object.defineProperty(RenderCommandBase.prototype, &quot;globalZ&quot;, {
                get: function () {
                    return this._globalZ;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(RenderCommandBase.prototype, &quot;layer&quot;, {
                get: function () {
                    return this._layer;
                },
                enumerable: true,
                configurable: true
            });
            return RenderCommandBase;
        })();
        renderer.RenderCommandBase = RenderCommandBase;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;RenderCommandBase.ts&quot;/&gt;
/// &lt;reference path=&quot;IRenderer.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (_renderer) {
<span id='WOZLLA-renderer-CustomCommand'>        /**
</span>         * @class WOZLLA.renderer.CustomCommand
         * @extends WOZLLA.renderer.RenderCommandBase
         */
        var CustomCommand = (function (_super) {
            __extends(CustomCommand, _super);
            function CustomCommand(globalZ, layer) {
                _super.call(this, globalZ, layer);
            }
            CustomCommand.prototype.execute = function (renderer) {
                throw new Error(&#39;abstract method&#39;);
            };
            return CustomCommand;
        })(_renderer.RenderCommandBase);
        _renderer.CustomCommand = CustomCommand;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Component.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/ILayerManager.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/CustomCommand.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Mask'>    /**
</span>     * Base class for all mask, mask is based on webgl stencil.
     * @class WOZLLA.Mask
     * @extends WOZLLA.Component
     * @abstract
     */
    var Mask = (function (_super) {
        __extends(Mask, _super);
        function Mask() {
            _super.apply(this, arguments);
            this.reverse = false;
            this._startGlobalZ = 0;
            this._endGlobalZ = 0;
            this._maskLayer = WOZLLA.renderer.ILayerManager.DEFAULT;
        }
<span id='WOZLLA-Mask-method-setMaskRange'>        /**
</span>         * set mask range, mask range is effect on globalZ of render commmand
         * @param start
         * @param end
         * @param layer
         */
        Mask.prototype.setMaskRange = function (start, end, layer) {
            if (layer === void 0) { layer = WOZLLA.renderer.ILayerManager.DEFAULT; }
            this._startGlobalZ = start;
            this._endGlobalZ = end;
            this._maskLayer = layer;
        };
<span id='WOZLLA-Mask-method-render'>        /**
</span>         * render this mask
         * @param renderer
         * @param flags
         */
        Mask.prototype.render = function (renderer, flags) {
            renderer.addCommand(new EnableMaskCommand(this._startGlobalZ, this._maskLayer));
            this.renderMask(renderer, flags);
            renderer.addCommand(new EndMaskCommand(this._startGlobalZ, this._maskLayer, this.reverse));
            renderer.addCommand(new DisableMaskCommand(this._endGlobalZ, this._maskLayer));
        };
<span id='WOZLLA-Mask-method-renderMask'>        /**
</span>         * do render mask graphics
         * @param renderer
         * @param flags
         */
        Mask.prototype.renderMask = function (renderer, flags) {
        };
        return Mask;
    })(WOZLLA.Component);
    WOZLLA.Mask = Mask;
    var EnableMaskCommand = (function (_super) {
        __extends(EnableMaskCommand, _super);
        function EnableMaskCommand(globalZ, layer) {
            _super.call(this, globalZ, layer);
        }
        EnableMaskCommand.prototype.execute = function (renderer) {
            var gl = renderer.gl;
            gl.enable(gl.STENCIL_TEST);
            gl.clear(gl.STENCIL_BUFFER_BIT);
            gl.colorMask(false, false, false, false);
            gl.stencilFunc(gl.ALWAYS, 1, 0);
            gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);
        };
        return EnableMaskCommand;
    })(WOZLLA.renderer.CustomCommand);
    var EndMaskCommand = (function (_super) {
        __extends(EndMaskCommand, _super);
        function EndMaskCommand(globalZ, layer, reverse) {
            _super.call(this, globalZ, layer);
            this.reverse = reverse;
        }
        EndMaskCommand.prototype.execute = function (renderer) {
            var gl = renderer.gl;
            gl.colorMask(true, true, true, true);
            gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);
            gl.stencilFunc(this.reverse ? gl.NOTEQUAL : gl.EQUAL, 1, 0xFF);
        };
        return EndMaskCommand;
    })(WOZLLA.renderer.CustomCommand);
    var DisableMaskCommand = (function (_super) {
        __extends(DisableMaskCommand, _super);
        function DisableMaskCommand(globalZ, layer) {
            _super.call(this, globalZ, layer);
        }
        DisableMaskCommand.prototype.execute = function (renderer) {
            renderer.gl.disable(renderer.gl.STENCIL_TEST);
        };
        return DisableMaskCommand;
    })(WOZLLA.renderer.CustomCommand);
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Renderer'>    /**
</span>     * Abstract base class for Renderer component
     * @class WOZLLA.Renderer
     * @abstract
     */
    var Renderer = (function (_super) {
        __extends(Renderer, _super);
        function Renderer() {
            _super.apply(this, arguments);
        }
<span id='WOZLLA-Renderer-method-render'>        /**
</span>         * render this object
         * @param renderer
         * @param flags
         */
        Renderer.prototype.render = function (renderer, flags) {
        };
        return Renderer;
    })(WOZLLA.Component);
    WOZLLA.Renderer = Renderer;
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-QuadType'>        /**
</span>         * @class WOZLLA.renderer.QuadType
         */
        var QuadType = (function () {
            function QuadType(info) {
                this._info = info;
            }
            Object.defineProperty(QuadType.prototype, &quot;size&quot;, {
                get: function () {
                    return this.strade * 4;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadType.prototype, &quot;strade&quot;, {
                get: function () {
                    return this._info[0];
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadType.prototype, &quot;vertexIndex&quot;, {
                get: function () {
                    return this._info[1];
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadType.prototype, &quot;texCoordIndex&quot;, {
                get: function () {
                    return this._info[2];
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadType.prototype, &quot;alphaIndex&quot;, {
                get: function () {
                    return this._info[3];
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadType.prototype, &quot;colorIndex&quot;, {
                get: function () {
                    return this._info[4];
                },
                enumerable: true,
                configurable: true
            });
            return QuadType;
        })();
        renderer.QuadType = QuadType;
<span id='WOZLLA-renderer-Quad'>        /**
</span>         * @class WOZLLA.renderer.Quad
         */
        var Quad = (function () {
            function Quad(count, type) {
                if (type === void 0) { type = Quad.V2T2C1A1; }
                this._count = count;
                this._type = type;
                this._storage = new Array(type.size * count);
                this._renderOffset = 0;
                this._renderCount = count;
            }
            Object.defineProperty(Quad.prototype, &quot;storage&quot;, {
                get: function () {
                    return this._storage;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Quad.prototype, &quot;count&quot;, {
                get: function () {
                    return this._count;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Quad.prototype, &quot;type&quot;, {
                get: function () {
                    return this._type;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Quad.prototype, &quot;renderOffset&quot;, {
                get: function () {
                    return this._renderOffset;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Quad.prototype, &quot;renderCount&quot;, {
                get: function () {
                    return this._renderCount;
                },
                enumerable: true,
                configurable: true
            });
            Quad.prototype.setRenderRange = function (offset, count) {
                this._renderOffset = offset;
                this._renderCount = count;
            };
            Quad.prototype.setVertices = function (x1, y1, x2, y2, x3, y3, x4, y4, offset) {
                if (offset === void 0) { offset = 0; }
                var strade = this._type.strade;
                var size = this._type.size;
                var index = this._type.vertexIndex;
                var base = size * offset + index;
                this._storage[0 + base] = x1;
                this._storage[1 + base] = y1;
                this._storage[0 + base + strade * 1] = x2;
                this._storage[1 + base + strade * 1] = y2;
                this._storage[0 + base + strade * 2] = x3;
                this._storage[1 + base + strade * 2] = y3;
                this._storage[0 + base + strade * 3] = x4;
                this._storage[1 + base + strade * 3] = y4;
            };
            Quad.prototype.setTexCoords = function (x1, y1, x2, y2, x3, y3, x4, y4, offset) {
                if (offset === void 0) { offset = 0; }
                var strade = this._type.strade;
                var size = this._type.size;
                var index = this._type.texCoordIndex;
                var base = size * offset + index;
                this._storage[0 + base] = x1;
                this._storage[1 + base] = y1;
                this._storage[0 + base + strade * 1] = x2;
                this._storage[1 + base + strade * 1] = y2;
                this._storage[0 + base + strade * 2] = x3;
                this._storage[1 + base + strade * 2] = y3;
                this._storage[0 + base + strade * 3] = x4;
                this._storage[1 + base + strade * 3] = y4;
            };
            Quad.prototype.setAlpha = function (alpha, offset) {
                if (offset === void 0) { offset = 0; }
                var strade = this._type.strade;
                var size = this._type.size;
                var index = this._type.alphaIndex;
                var base = size * offset + index;
                this._storage[base] = alpha;
                this._storage[base + strade * 1] = alpha;
                this._storage[base + strade * 2] = alpha;
                this._storage[base + strade * 3] = alpha;
            };
            Quad.prototype.setColor = function (color, offset) {
                if (offset === void 0) { offset = 0; }
                var strade = this._type.strade;
                var size = this._type.size;
                var index = this._type.colorIndex;
                var base = size * offset + index;
                this._storage[base] = color;
                this._storage[base + strade * 1] = color;
                this._storage[base + strade * 2] = color;
                this._storage[base + strade * 3] = color;
            };
            Quad.V2T2C1A1 = new QuadType([6, 0, 2, 4, 5]);
            return Quad;
        })();
        renderer.Quad = Quad;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var utils;
    (function (utils) {
        var ObjectPool = (function () {
            function ObjectPool(minCount, factory) {
                this._minCount = minCount;
                this._factory = factory;
                this._pool = [];
                for (var i = 0; i &lt; this._minCount; i++) {
                    this._pool.push(this._factory());
                }
            }
            ObjectPool.prototype.retain = function () {
                var object = this._pool.shift();
                if (object) {
                    return object;
                }
                return this._factory();
            };
            ObjectPool.prototype.release = function (obj) {
                if (this._pool.indexOf(obj) !== -1) {
                    return;
                }
                this._pool.push(obj);
            };
            return ObjectPool;
        })();
        utils.ObjectPool = ObjectPool;
    })(utils = WOZLLA.utils || (WOZLLA.utils = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;ITexture.ts&quot;/&gt;
/// &lt;reference path=&quot;Quad.ts&quot;/&gt;
/// &lt;reference path=&quot;RenderCommandBase.ts&quot;/&gt;
/// &lt;reference path=&quot;ILayerManager.ts&quot;/&gt;
/// &lt;reference path=&quot;../utils/ObjectPool.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var quadCommandPool;
<span id='WOZLLA-renderer-QuadCommand'>        /**
</span>         * @class WOZLLA.renderer.QuadCommand
         * @extends WOZLLA.renderer.RenderCommandBase
         */
        var QuadCommand = (function (_super) {
            __extends(QuadCommand, _super);
            function QuadCommand(globalZ, layer) {
                _super.call(this, globalZ, layer);
                this.isPoolable = true;
            }
            QuadCommand.init = function (globalZ, layer, texture, materialId, quad) {
                var quadCommand = quadCommandPool.retain();
                quadCommand.initWith(globalZ, layer, texture, materialId, quad);
                return quadCommand;
            };
            Object.defineProperty(QuadCommand.prototype, &quot;texture&quot;, {
                get: function () {
                    return this._texture;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadCommand.prototype, &quot;materialId&quot;, {
                get: function () {
                    return this._materialId;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(QuadCommand.prototype, &quot;quad&quot;, {
                get: function () {
                    return this._quad;
                },
                enumerable: true,
                configurable: true
            });
            QuadCommand.prototype.initWith = function (globalZ, layer, texture, materialId, quad) {
                this._globalZ = globalZ;
                this._layer = layer;
                this._texture = texture;
                this._materialId = materialId;
                this._quad = quad;
            };
            QuadCommand.prototype.release = function () {
                quadCommandPool.release(this);
            };
            return QuadCommand;
        })(renderer.RenderCommandBase);
        renderer.QuadCommand = QuadCommand;
        quadCommandPool = new WOZLLA.utils.ObjectPool(200, function () {
            return new QuadCommand(0, renderer.ILayerManager.DEFAULT);
        });
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../../core/Renderer.ts&quot;/&gt;
/// &lt;reference path=&quot;../../renderer/IRenderer.ts&quot;/&gt;
/// &lt;reference path=&quot;../../renderer/ILayerManager.ts&quot;/&gt;
/// &lt;reference path=&quot;../../renderer/QuadCommand.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
        var QuadCommand = WOZLLA.renderer.QuadCommand;
<span id='WOZLLA-component-QuadRenderer'>        /**
</span>         * @class WOZLLA.component.QuadRenderer
         * @abstract
         */
        var QuadRenderer = (function (_super) {
            __extends(QuadRenderer, _super);
            function QuadRenderer() {
                _super.apply(this, arguments);
                this._quadLayer = WOZLLA.renderer.ILayerManager.DEFAULT;
                this._quadMaterialId = WOZLLA.renderer.IMaterial.DEFAULT;
                this._quadGlobalZ = 0;
                this._quadAlpha = 1;
                this._quadColor = 0xFFFFFF;
                this._quadVertexDirty = true;
                this._quadAlphaDirty = true;
                this._quadColorDirty = true;
                this._textureUpdated = false;
            }
            QuadRenderer.prototype.setQuadRenderRange = function (offset, count) {
                this._quad.setRenderRange(offset, count);
            };
            QuadRenderer.prototype.setQuadGlobalZ = function (globalZ) {
                this._quadGlobalZ = globalZ;
            };
            QuadRenderer.prototype.setQuadLayer = function (layer) {
                this._quadLayer = layer;
            };
            QuadRenderer.prototype.setQuadMaterialId = function (materialId) {
                this._quadMaterialId = materialId;
            };
            QuadRenderer.prototype.setQuadAlpha = function (alpha) {
                this._quadAlpha = alpha;
                this._quadAlphaDirty = true;
            };
            QuadRenderer.prototype.setQuadColor = function (color) {
                this._quadColor = color;
                this._quadColorDirty = true;
            };
            QuadRenderer.prototype.setTexture = function (texture) {
                this._texture = texture;
                this._textureUVS = null;
                this._textureUpdated = true;
            };
            QuadRenderer.prototype.setTextureFrame = function (frame) {
                this._textureFrame = frame;
                this._textureUVS = null;
                this._textureUpdated = true;
            };
            QuadRenderer.prototype.setTextureOffset = function (offset) {
                this._textureOffset = offset;
                this._textureUpdated = true;
            };
            QuadRenderer.prototype.init = function () {
                this._initQuad();
                _super.prototype.init.call(this);
            };
            QuadRenderer.prototype.render = function (renderer, flags) {
                if (!this._texture) {
                    return;
                }
                if ((flags &amp; WOZLLA.GameObject.MASK_TRANSFORM_DIRTY) === WOZLLA.GameObject.MASK_TRANSFORM_DIRTY) {
                    this._quadVertexDirty = true;
                }
                if (this._textureUpdated) {
                    this._updateQuad();
                }
                if (this._quadVertexDirty) {
                    this._updateQuadVertices();
                    this._quadVertexDirty = false;
                }
                if (this._quadAlphaDirty) {
                    this._updateQuadAlpha();
                }
                if (this._quadColorDirty) {
                    this._updateQuadColor();
                }
                renderer.addCommand(QuadCommand.init(this._quadGlobalZ, this._quadLayer, this._texture, this._quadMaterialId, this._quad));
            };
            QuadRenderer.prototype._initQuad = function () {
                this._quad = new WOZLLA.renderer.Quad(1);
            };
            QuadRenderer.prototype._getTextureFrame = function () {
                return this._textureFrame || {
                    x: 0,
                    y: 0,
                    width: this._texture.descriptor.width,
                    height: this._texture.descriptor.height
                };
            };
            QuadRenderer.prototype._getTextureOffset = function () {
                return this._textureOffset || { x: 0, y: 0 };
            };
            QuadRenderer.prototype._getTextureUVS = function () {
                var tw, th, frame, uvs;
                if (this._textureUVS) {
                    return this._textureUVS;
                }
                tw = this._texture.descriptor.width;
                th = this._texture.descriptor.height;
                frame = this._textureFrame || {
                    x: 0,
                    y: 0,
                    width: tw,
                    height: th
                };
                uvs = {};
                uvs.x0 = frame.x / tw;
                uvs.y0 = frame.y / th;
                uvs.x1 = (frame.x + frame.width) / tw;
                uvs.y1 = frame.y / th;
                uvs.x2 = (frame.x + frame.width) / tw;
                uvs.y2 = (frame.y + frame.height) / th;
                uvs.x3 = frame.x / tw;
                uvs.y3 = (frame.y + frame.height) / th;
                this._textureUVS = uvs;
                return uvs;
            };
            QuadRenderer.prototype._updateQuad = function (quadIndex) {
                if (quadIndex === void 0) { quadIndex = 0; }
                this._updateQuadVertices(quadIndex);
                this._updateQuadAlpha(quadIndex);
                this._updateQuadColor(quadIndex);
                this._textureUpdated = false;
            };
            QuadRenderer.prototype._updateQuadVertices = function (quadIndex) {
                if (quadIndex === void 0) { quadIndex = 0; }
                var uvs = this._getTextureUVS();
                var frame = this._getTextureFrame();
                var offset = this._getTextureOffset();
                var matrix = this._gameObject.transform.worldMatrix;
                this._updateQuadVerticesByArgs(uvs, frame, offset, matrix, quadIndex);
                this._quadVertexDirty = false;
            };
            QuadRenderer.prototype._updateQuadVerticesByArgs = function (uvs, frame, offset, matrix, quadIndex) {
                if (quadIndex === void 0) { quadIndex = 0; }
                var a = matrix.values[0];
                var c = matrix.values[1];
                var b = matrix.values[3];
                var d = matrix.values[4];
                var tx = matrix.values[6];
                var ty = matrix.values[7];
                var w1 = -offset.x * frame.width;
                var w0 = w1 + frame.width;
                var h1 = -offset.y * frame.height;
                var h0 = h1 + frame.height;
                var x1 = a * w1 + b * h1 + tx;
                var y1 = d * h1 + c * w1 + ty;
                var x2 = a * w0 + b * h1 + tx;
                var y2 = d * h1 + c * w0 + ty;
                var x3 = a * w0 + b * h0 + tx;
                var y3 = d * h0 + c * w0 + ty;
                var x4 = a * w1 + b * h0 + tx;
                var y4 = d * h0 + c * w1 + ty;
                this._quad.setVertices(x1, y1, x2, y2, x3, y3, x4, y4, quadIndex);
                this._quad.setTexCoords(uvs.x0, uvs.y0, uvs.x1, uvs.y1, uvs.x2, uvs.y2, uvs.x3, uvs.y3, quadIndex);
            };
            QuadRenderer.prototype._clearQuadVertices = function (quadIndex) {
                if (quadIndex === void 0) { quadIndex = 0; }
                this._quad.setVertices(0, 0, 0, 0, 0, 0, 0, 0);
                this._quad.setTexCoords(0, 0, 0, 0, 0, 0, 0, 0);
            };
            QuadRenderer.prototype._updateQuadAlpha = function (quadIndex) {
                if (quadIndex === void 0) { quadIndex = 0; }
                this._quad.setAlpha(this._quadAlpha, quadIndex);
                this._quadAlphaDirty = false;
            };
            QuadRenderer.prototype._updateQuadColor = function (quadIndex) {
                if (quadIndex === void 0) { quadIndex = 0; }
                this._quad.setColor(this._quadColor, quadIndex);
                this._quadColorDirty = false;
            };
            return QuadRenderer;
        })(WOZLLA.Renderer);
        component.QuadRenderer = QuadRenderer;
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../../core/Mask.ts&quot;/&gt;
/// &lt;reference path=&quot;../renderer/QuadRenderer.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
<span id='WOZLLA-component-RectMask'>        /**
</span>         * @class WOZLLA.component.RectMask
         */
        var RectMask = (function (_super) {
            __extends(RectMask, _super);
            function RectMask() {
                _super.apply(this, arguments);
                this._helperGameObject = new WOZLLA.GameObject();
            }
            Object.defineProperty(RectMask.prototype, &quot;region&quot;, {
                get: function () {
                    return this._region;
                },
                set: function (value) {
                    this._region = value;
                    this._helperGameObject.transform.setPosition(value.x, value.y);
                    this._helperGameObject.transform.setScale(value.width, value.height);
                },
                enumerable: true,
                configurable: true
            });
            RectMask.prototype.renderMask = function (renderer, flags) {
                if (this._region) {
                    if (!this._maskQuadRenderer) {
                        this._initMaskQuadRenderer(renderer);
                    }
                    if (this._helperGameObject.transform.dirty) {
                        flags |= WOZLLA.GameObject.MASK_TRANSFORM_DIRTY;
                    }
                    if ((flags &amp; WOZLLA.GameObject.MASK_TRANSFORM_DIRTY) == WOZLLA.GameObject.MASK_TRANSFORM_DIRTY) {
                        this._helperGameObject.transform.transform(this.transform);
                    }
                    this._maskQuadRenderer.setQuadGlobalZ(this._startGlobalZ);
                    this._maskQuadRenderer.render(renderer, flags);
                }
            };
            RectMask.prototype._initMaskQuadRenderer = function (renderer) {
                var canvas = document.createElement(&#39;canvas&#39;);
                var context = canvas.getContext(&#39;2d&#39;);
                canvas.width = 1;
                canvas.height = 1;
                context.fillStyle = &#39;#FFFFFF&#39;;
                context.fillRect(0, 0, canvas.width, canvas.height);
                var descriptor = new WOZLLA.assets.HTMLImageDescriptor(canvas);
                var texture = renderer.textureManager.generateTexture(descriptor);
                this._maskQuadRenderer = new WOZLLA.component.QuadRenderer();
                this._maskQuadRenderer.setTexture(texture);
                this._helperGameObject.addComponent(this._maskQuadRenderer);
                this._helperGameObject.init();
            };
            return RectMask;
        })(WOZLLA.Mask);
        component.RectMask = RectMask;
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;QuadRenderer.ts&quot;/&gt;
/// &lt;reference path=&quot;../../assets/Sprite.ts&quot;/&gt;
/// &lt;reference path=&quot;../../assets/SpriteAtlas.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
<span id='WOZLLA-component-SpriteRenderer'>        /**
</span>         * @class WOZLLA.component.SpriteRenderer
         */
        var SpriteRenderer = (function (_super) {
            __extends(SpriteRenderer, _super);
            function SpriteRenderer() {
                _super.apply(this, arguments);
            }
            Object.defineProperty(SpriteRenderer.prototype, &quot;color&quot;, {
                get: function () {
                    return this._quadColor;
                },
                set: function (value) {
                    this.setQuadColor(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteRenderer.prototype, &quot;alpha&quot;, {
                get: function () {
                    return this._quadAlpha;
                },
                set: function (value) {
                    this.setQuadAlpha(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteRenderer.prototype, &quot;materialId&quot;, {
                get: function () {
                    return this._quadMaterialId;
                },
                set: function (value) {
                    this.setQuadMaterialId(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteRenderer.prototype, &quot;renderLayer&quot;, {
                get: function () {
                    return this._quadLayer;
                },
                set: function (value) {
                    this.setQuadLayer(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteRenderer.prototype, &quot;renderOrder&quot;, {
                get: function () {
                    return this._quadGlobalZ;
                },
                set: function (value) {
                    this.setQuadGlobalZ(value);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteRenderer.prototype, &quot;sprite&quot;, {
                get: function () {
                    return this._sprite;
                },
                set: function (sprite) {
                    var oldSprite = this._sprite;
                    this._sprite = sprite;
                    if (!sprite) {
                        this.setTexture(null);
                        this.setTextureFrame(null);
                    }
                    else {
                        this.setTextureFrame(sprite.frame);
                        if (!oldSprite || oldSprite.spriteAtlas !== sprite.spriteAtlas) {
                            this.setTexture(sprite.spriteAtlas.glTexture);
                        }
                    }
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(SpriteRenderer.prototype, &quot;spriteOffset&quot;, {
                get: function () {
                    return this._getTextureOffset();
                },
                set: function (value) {
                    this.setTextureOffset(value);
                },
                enumerable: true,
                configurable: true
            });
            return SpriteRenderer;
        })(component.QuadRenderer);
        component.SpriteRenderer = SpriteRenderer;
        WOZLLA.Component.register(SpriteRenderer, {
            name: &quot;SpriteRenderer&quot;,
            properties: [{
                name: &#39;color&#39;,
                type: &#39;int&#39;
            }]
        });
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;SpriteRenderer.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var component;
    (function (component) {
        var QuadCommand = WOZLLA.renderer.QuadCommand;
<span id='WOZLLA-component-NinePatchRenderer'>        /**
</span>         * @class WOZLLA.component.NinePatchRenderer
         */
        var NinePatchRenderer = (function (_super) {
            __extends(NinePatchRenderer, _super);
            function NinePatchRenderer() {
                _super.apply(this, arguments);
            }
            Object.defineProperty(NinePatchRenderer.prototype, &quot;renderRegion&quot;, {
                get: function () {
                    return this._renderRegion;
                },
                set: function (value) {
                    this._renderRegion = value;
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(NinePatchRenderer.prototype, &quot;patch&quot;, {
                get: function () {
                    return this._patch;
                },
                set: function (value) {
                    this._patch = value;
                    this._quadVertexDirty = true;
                },
                enumerable: true,
                configurable: true
            });
            NinePatchRenderer.prototype._initQuad = function () {
                this._quad = new WOZLLA.renderer.Quad(9);
            };
            NinePatchRenderer.prototype._updateNinePatchQuads = function () {
                this._updateNinePatchQuadVertices();
                this._updateNinePatchQuadAlpha();
                this._updateNinePatchQuadColor();
                this._textureUpdated = false;
            };
            NinePatchRenderer.prototype._updateNinePatchQuadVertices = function () {
                var transform = new WOZLLA.Transform();
                var frame = this._getTextureFrame();
                var patchUVS;
                var patchOffset = { x: 0, y: 0 };
                var patch = this._patch || new WOZLLA.math.Rectangle(0, 0, frame.width, frame.height);
                var region = this._renderRegion || patch;
                function getPatchUVS(patchFrame, texture) {
                    var tw = texture.descriptor.width;
                    var th = texture.descriptor.height;
                    var patchUVS = {};
                    patchUVS.x0 = patchFrame.x / tw;
                    patchUVS.y0 = patchFrame.y / th;
                    patchUVS.x1 = (patchFrame.x + patchFrame.width) / tw;
                    patchUVS.y1 = patchFrame.y / th;
                    patchUVS.x2 = (patchFrame.x + patchFrame.width) / tw;
                    patchUVS.y2 = (patchFrame.y + patchFrame.height) / th;
                    patchUVS.x3 = patchFrame.x / tw;
                    patchUVS.y3 = (patchFrame.y + patchFrame.height) / th;
                    return patchUVS;
                }
                var patches = [{
                    // left top
                    frame: {
                        x: frame.x,
                        y: frame.y,
                        width: patch.left,
                        height: patch.top
                    },
                    pos: {
                        x: region.x,
                        y: region.y
                    },
                    size: {
                        width: 1,
                        height: 1
                    }
                }, {
                    // left center
                    frame: {
                        x: frame.x + patch.left,
                        y: frame.y,
                        width: patch.width,
                        height: patch.top
                    },
                    pos: {
                        x: region.x + patch.left,
                        y: region.y
                    },
                    size: {
                        width: (region.width - (patch.right - patch.width)) / patch.width,
                        height: 1
                    }
                }, {
                    // right top
                    frame: {
                        x: frame.x + patch.right,
                        y: frame.y,
                        width: frame.width - patch.right,
                        height: patch.top
                    },
                    pos: {
                        x: region.right,
                        y: region.y
                    },
                    size: {
                        width: 1,
                        height: 1
                    }
                }, {
                    // left middle
                    frame: {
                        x: frame.x,
                        y: frame.y + patch.top,
                        width: patch.left,
                        height: patch.height
                    },
                    pos: {
                        x: region.x,
                        y: region.y + patch.top
                    },
                    size: {
                        width: 1,
                        height: (region.height - (patch.bottom - patch.height)) / patch.height
                    }
                }, {
                    // center middle
                    frame: {
                        x: frame.x + patch.left,
                        y: frame.y + patch.top,
                        width: patch.width,
                        height: patch.height
                    },
                    pos: {
                        x: region.x + patch.left,
                        y: region.y + patch.top
                    },
                    size: {
                        width: (region.width - (patch.right - patch.width)) / patch.width,
                        height: (region.height - (patch.bottom - patch.height)) / patch.height
                    }
                }, {
                    // right middle
                    frame: {
                        x: frame.x + patch.right,
                        y: frame.y + patch.top,
                        width: frame.width - patch.right,
                        height: patch.height
                    },
                    pos: {
                        x: region.right,
                        y: region.y + patch.top
                    },
                    size: {
                        width: 1,
                        height: (region.height - (patch.bottom - patch.height)) / patch.height
                    }
                }, {
                    // left bottom
                    frame: {
                        x: frame.x,
                        y: frame.y + patch.bottom,
                        width: frame.width - patch.right,
                        height: frame.height - patch.bottom
                    },
                    pos: {
                        x: region.x,
                        y: region.bottom
                    },
                    size: {
                        width: 1,
                        height: 1
                    }
                }, {
                    // center bottom
                    frame: {
                        x: frame.x + patch.left,
                        y: frame.y + patch.bottom,
                        width: patch.width,
                        height: frame.height - patch.bottom
                    },
                    pos: {
                        x: region.x + patch.left,
                        y: region.bottom
                    },
                    size: {
                        width: (region.width - (patch.right - patch.width)) / patch.width,
                        height: 1
                    }
                }, {
                    // right bottom
                    frame: {
                        x: frame.x + patch.right,
                        y: frame.y + patch.bottom,
                        width: frame.width - patch.right,
                        height: frame.height - patch.bottom
                    },
                    pos: {
                        x: region.right,
                        y: region.bottom
                    },
                    size: {
                        width: 1,
                        height: 1
                    }
                }];
                for (var i = 0, p; i &lt; 9; i++) {
                    p = patches[i];
                    if (p.frame.width &gt; 0 &amp;&amp; p.frame.height &gt; 0) {
                        patchUVS = getPatchUVS(p.frame, this._texture);
                        transform.set(this.gameObject.transform);
                        transform.x += p.pos.x;
                        transform.y += p.pos.y;
                        transform.setScale(p.size.width, p.size.height);
                        transform.updateWorldMatrix();
                        this._updateQuadVerticesByArgs(patchUVS, p.frame, patchOffset, transform.worldMatrix, i);
                    }
                    else {
                        this._clearQuadVertices(i);
                    }
                }
                this._quadVertexDirty = false;
            };
            NinePatchRenderer.prototype._updateNinePatchQuadAlpha = function () {
                for (var i = 0; i &lt; 9; i++) {
                    this._updateQuadAlpha(i);
                }
                this._quadAlphaDirty = false;
            };
            NinePatchRenderer.prototype._updateNinePatchQuadColor = function () {
                for (var i = 0; i &lt; 9; i++) {
                    this._updateQuadColor(i);
                }
                this._quadColorDirty = false;
            };
            NinePatchRenderer.prototype.render = function (renderer, flags) {
                if (!this._texture) {
                    return;
                }
                if ((flags &amp; WOZLLA.GameObject.MASK_TRANSFORM_DIRTY) === WOZLLA.GameObject.MASK_TRANSFORM_DIRTY) {
                    this._quadVertexDirty = true;
                }
                if (this._textureUpdated) {
                    this._updateNinePatchQuads();
                }
                if (this._quadVertexDirty) {
                    this._updateNinePatchQuadVertices();
                    this._quadVertexDirty = false;
                }
                if (this._quadAlphaDirty) {
                    this._updateNinePatchQuadAlpha();
                }
                if (this._quadColorDirty) {
                    this._updateNinePatchQuadColor();
                }
                renderer.addCommand(QuadCommand.init(this._quadGlobalZ, this._quadLayer, this._texture, this._quadMaterialId, this._quad));
            };
            return NinePatchRenderer;
        })(component.SpriteRenderer);
        component.NinePatchRenderer = NinePatchRenderer;
        WOZLLA.Component.register(NinePatchRenderer, {
            name: &quot;NinePatchRenderer&quot;,
            properties: []
        });
    })(component = WOZLLA.component || (WOZLLA.component = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;Component.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-Behaviour'>    /**
</span>     * Abstract base class for all behaviours, the {@link WOZLLA.Behaviour#update} function would be call
     * by WOZLLA engine every frame when the gameObject is actived and the property enabled of this behaviour is true
     * @class WOZLLA.Behaviour
     * @extends WOZLLA.Component
     * @abstract
     */
    var Behaviour = (function (_super) {
        __extends(Behaviour, _super);
        function Behaviour() {
            _super.apply(this, arguments);
<span id='WOZLLA-Behaviour-property-enabled'>            /**
</span>             * enabled or disabled this behaviour
             * @property {boolean} [enabled=true]
             */
            this.enabled = true;
        }
<span id='WOZLLA-Behaviour-method-update'>        /**
</span>         * call by Engine every frame
         * @method update
         */
        Behaviour.prototype.update = function () {
        };
        return Behaviour;
    })(WOZLLA.Component);
    WOZLLA.Behaviour = Behaviour;
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../event/Event.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
<span id='WOZLLA-CoreEvent'>    /**
</span>     * internal class
     * @class WOZLLA.CoreEvent
     * @extends WOZLLA.event.Event
     */
    var CoreEvent = (function (_super) {
        __extends(CoreEvent, _super);
<span id='WOZLLA-CoreEvent-method-constructor'>        /**
</span>         * new a CoreEvent
         * @method constructor
         * @param type
         * @param bubbles
         * @param data
         * @param canStopBubbles
         */
        function CoreEvent(type, bubbles, data, canStopBubbles) {
            if (bubbles === void 0) { bubbles = false; }
            if (data === void 0) { data = null; }
            if (canStopBubbles === void 0) { canStopBubbles = true; }
            _super.call(this, type, bubbles, data, canStopBubbles);
        }
        return CoreEvent;
    })(WOZLLA.event.Event);
    WOZLLA.CoreEvent = CoreEvent;
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var jsonx;
    (function (jsonx) {
        function emptyCallback(root, done) {
            done();
        }
        // reference: @src#asGameObject
        var JSONXBuilder = (function () {
            function JSONXBuilder() {
                this.doLoad = false;
                this.doInit = false;
            }
            JSONXBuilder.prototype.instantiateWithSrc = function (src, callback) {
                if (callback === void 0) { callback = emptyCallback; }
                this.src = src;
                this.newCallback = callback;
                return this;
            };
            JSONXBuilder.prototype.instantiateWithJSON = function (data, callback) {
                if (callback === void 0) { callback = emptyCallback; }
                this.data = data;
                this.newCallback = callback;
                return this;
            };
            JSONXBuilder.prototype.load = function (callback) {
                if (callback === void 0) { callback = emptyCallback; }
                this.doLoad = true;
                this.loadCallback = callback;
                return this;
            };
            JSONXBuilder.prototype.init = function () {
                if (this.doLoad) {
                    this.doInit = true;
                }
                else {
                    this.err = &#39;JSONXBuilder: init must after load&#39;;
                }
                return this;
            };
            JSONXBuilder.prototype.build = function (callback) {
                var _this = this;
                this._loadJSONData(function () {
                    if (_this._checkError(callback))
                        return;
                    _this._newGameObjectTree(function () {
                        if (_this._checkError(callback))
                            return;
                        if (!_this.doLoad) {
                            callback(_this.err, _this.root);
                            return;
                        }
                        _this.newCallback(_this.root, function () {
                            _this._loadAssets(function () {
                                if (_this._checkError(callback))
                                    return;
                                if (!_this.doInit) {
                                    callback(_this.err, _this.root);
                                    return;
                                }
                                _this._init();
                                callback(_this.err, _this.root);
                            });
                        });
                    });
                });
            };
            JSONXBuilder.prototype._checkError = function (callback) {
                if (this.err) {
                    callback(this.err, null);
                    return true;
                }
                return false;
            };
            JSONXBuilder.prototype._loadJSONData = function (callback) {
                var _this = this;
                if (this.src &amp;&amp; !this.data) {
                    WOZLLA.utils.Ajax.request({
                        url: this.src,
                        contentType: &#39;json&#39;,
                        success: function (data) {
                            _this.data = data;
                            callback &amp;&amp; callback();
                        },
                        error: function (err) {
                            _this.err = err;
                            callback &amp;&amp; callback();
                        }
                    });
                }
                else {
                    callback &amp;&amp; callback();
                }
            };
            JSONXBuilder.prototype._newGameObjectTree = function (callback) {
                var _this = this;
                this._newGameObject(this.data.root, function (root) {
                    _this.root = root;
                    callback &amp;&amp; callback();
                });
            };
            JSONXBuilder.prototype._newGameObject = function (data, callback) {
                var _this = this;
                var gameObj = new WOZLLA.GameObject(data.rect);
                gameObj.id = data.id;
                gameObj.name = data.name;
                gameObj.active = data.active;
                gameObj.visible = data.visible;
                gameObj.touchable = data.touchable;
                gameObj.transform.set(data.transform);
                var components = data.components;
                if (components &amp;&amp; components.length &gt; 0) {
                    components.forEach(function (compData) {
                        var component = WOZLLA.Component.create(compData.name);
                        gameObj.addComponent(component);
                    });
                }
                var createdChildCount = 0;
                var children = data.children;
                if (!children || children.length === 0) {
                    callback(gameObj);
                    return;
                }
                children.forEach(function (childData) {
                    if (childData.reference) {
                        _this._newReferenceObject(childData, function (child) {
                            if (child) {
                                gameObj.addChild(child);
                            }
                            createdChildCount++;
                            if (createdChildCount === children.length) {
                                callback(gameObj);
                            }
                        });
                    }
                    else {
                        _this._newGameObject(childData, function (child) {
                            gameObj.addChild(child);
                            createdChildCount++;
                            if (createdChildCount === children.length) {
                                callback(gameObj);
                            }
                        });
                    }
                });
            };
            JSONXBuilder.prototype._newReferenceObject = function (data, callback) {
                var _this = this;
                var builder = new JSONXBuilder();
                builder.instantiateWithSrc(data.reference).build(function (err, root) {
                    if (err) {
                        _this.err = err;
                    }
                    else if (root) {
                        root.name = data.name;
                        root.id = data.id;
                        root.active = data.active;
                        root.visible = data.visible;
                        root.touchable = data.touchable;
                        root.transform.set(data.transform);
                    }
                    callback(root);
                });
            };
            JSONXBuilder.prototype._loadAssets = function (callback) {
                // TODO how to load assets? the key.
                callback &amp;&amp; callback();
            };
            JSONXBuilder.prototype._init = function () {
                this.root.init();
            };
            return JSONXBuilder;
        })();
        jsonx.JSONXBuilder = JSONXBuilder;
    })(jsonx = WOZLLA.jsonx || (WOZLLA.jsonx = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var math;
    (function (math) {
<span id='WOZLLA-math-Circle'>        /**
</span>         * @class WOZLLA.math.Circle
         * a util class for circle
         */
        var Circle = (function () {
            function Circle(centerX, centerY, radius) {
<span id='WOZLLA-math-Circle-property-centerX'>                /**
</span>                 * get or set centerX
                 * @property {number} centerX
                 */
                this.centerX = centerX;
<span id='WOZLLA-math-Circle-property-centerY'>                /**
</span>                 * get or set centerY
                 * @property {number} centerY
                 */
                this.centerY = centerY;
<span id='WOZLLA-math-Circle-property-radius'>                /**
</span>                 * get or set radius
                 * @property {number} radius
                 */
                this.radius = radius;
            }
<span id='WOZLLA-math-Circle-method-containsXY'>            /**
</span>             * @method containsXY
             * @param x
             * @param y
             * @returns {boolean}
             */
            Circle.prototype.containsXY = function (x, y) {
                return Math.pow((x - this.centerX), 2) + Math.pow((y - this.centerY), 2) &lt;= this.radius;
            };
<span id='WOZLLA-math-Circle-method-toString'>            /**
</span>             * get simple description of this object
             * @returns {string}
             */
            Circle.prototype.toString = function () {
                return &#39;Circle[&#39; + this.centerX + &#39;,&#39; + this.centerY + &#39;,&#39; + this.radius + &#39;]&#39;;
            };
            return Circle;
        })();
        math.Circle = Circle;
    })(math = WOZLLA.math || (WOZLLA.math = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var math;
    (function (math) {
        var MathUtils;
        (function (MathUtils) {
            function rectIntersect(a, b) {
                return a.x &lt; b.x + b.width &amp;&amp; b.x &lt; a.x + a.width &amp;&amp; a.y &lt; b.y + b.height &amp;&amp; b.y &lt; a.y + a.height;
            }
            MathUtils.rectIntersect = rectIntersect;
            function rectIntersect2(ax, ay, aw, ah, bx, by, bw, bh) {
                return ax &lt;= bx + bw &amp;&amp; bx &lt;= ax + aw &amp;&amp; ay &lt;= by + bh &amp;&amp; by &lt;= ay + ah;
            }
            MathUtils.rectIntersect2 = rectIntersect2;
        })(MathUtils = math.MathUtils || (math.MathUtils = {}));
    })(math = WOZLLA.math || (WOZLLA.math = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var math;
    (function (math) {
<span id='WOZLLA-math-Size'>        /**
</span>         * @class WOZLLA.math.Size
         * a util class contains width and height properties
         */
        var Size = (function () {
<span id='WOZLLA-math-Size-method-constructor'>            /**
</span>             * @method constructor
             * create a new instance of Size
             * @member WOZLLA.math.Size
             * @param {number} width
             * @param {number} height
             */
            function Size(width, height) {
<span id='WOZLLA-math-Size-property-width'>                /**
</span>                 * @property {number} width
                 * get or set width of this object
                 * @member WOZLLA.math.Size
                 */
                this.width = width;
<span id='WOZLLA-math-Size-property-height'>                /**
</span>                 * @property {number} height
                 * get or set height of this object
                 * @member WOZLLA.math.Size
                 */
                this.height = height;
            }
<span id='WOZLLA-math-Size-method-toString'>            /**
</span>             * get simple description of this object
             * @returns {string}
             */
            Size.prototype.toString = function () {
                return &#39;Size[&#39; + this.width + &#39;,&#39; + this.height + &#39;]&#39;;
            };
            return Size;
        })();
        math.Size = Size;
    })(math = WOZLLA.math || (WOZLLA.math = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var IMaterialManager;
        (function (IMaterialManager) {
<span id='WOZLLA-renderer-IMaterialManager-static-property-DOC'>            /**
</span>             * @property DOC
             * @readonly
             * @static
             * @member WOZLLA.renderer.IMaterialManager
             */
            IMaterialManager.DOC = &#39;DOC&#39;;
        })(IMaterialManager = renderer.IMaterialManager || (renderer.IMaterialManager = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var IShaderManager;
        (function (IShaderManager) {
<span id='WOZLLA-renderer-IShaderManager-static-property-DOC'>            /**
</span>             * @property DOC
             * @readonly
             * @static
             * @member WOZLLA.renderer.IShaderManager
             */
            IShaderManager.DOC = &#39;DOC&#39;;
        })(IShaderManager = renderer.IShaderManager || (renderer.IShaderManager = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-TextureFormat'>        /**
</span>         * @enum WOZLLA.renderer.TextureFormat
         */
        (function (TextureFormat) {
<span id='WOZLLA-renderer-TextureFormat-property-PNG'>            /** @property {number} [PNG] */
</span>            TextureFormat[TextureFormat[&quot;PNG&quot;] = 0] = &quot;PNG&quot;;
<span id='WOZLLA-renderer-TextureFormat-property-JPEG'>            /** @property {number} [JPEG] */
</span>            TextureFormat[TextureFormat[&quot;JPEG&quot;] = 1] = &quot;JPEG&quot;;
<span id='WOZLLA-renderer-TextureFormat-property-PVR'>            /** @property {number} [PVR] */
</span>            TextureFormat[TextureFormat[&quot;PVR&quot;] = 2] = &quot;PVR&quot;;
        })(renderer.TextureFormat || (renderer.TextureFormat = {}));
        var TextureFormat = renderer.TextureFormat;
<span id='WOZLLA-renderer-PixelFormat'>        /**
</span>         * @enum WOZLLA.renderer.PixelFormat
         */
        (function (PixelFormat) {
<span id='WOZLLA-renderer-PixelFormat-property-RPGA8888'>            /** @property {number} [RPGA8888] */
</span>            PixelFormat[PixelFormat[&quot;RGBA8888&quot;] = 0] = &quot;RGBA8888&quot;;
<span id='WOZLLA-renderer-PixelFormat-property-RGBA4444'>            /** @property {number} [RGBA4444] */
</span>            PixelFormat[PixelFormat[&quot;RGBA4444&quot;] = 1] = &quot;RGBA4444&quot;;
<span id='WOZLLA-renderer-PixelFormat-property-RGB888'>            /** @property {number} [RGB888] */
</span>            PixelFormat[PixelFormat[&quot;RGB888&quot;] = 2] = &quot;RGB888&quot;;
<span id='WOZLLA-renderer-PixelFormat-property-RGB565'>            /** @property {number} [RGB565] */
</span>            PixelFormat[PixelFormat[&quot;RGB565&quot;] = 3] = &quot;RGB565&quot;;
<span id='WOZLLA-renderer-PixelFormat-property-PVRTC4'>            /** @property {number} [PVRTC4] */
</span>            PixelFormat[PixelFormat[&quot;PVRTC4&quot;] = 4] = &quot;PVRTC4&quot;;
<span id='WOZLLA-renderer-PixelFormat-property-PVRTC2'>            /** @property {number} [PVRTC2] */
</span>            PixelFormat[PixelFormat[&quot;PVRTC2&quot;] = 5] = &quot;PVRTC2&quot;;
        })(renderer.PixelFormat || (renderer.PixelFormat = {}));
        var PixelFormat = renderer.PixelFormat;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
        var ITextureManager;
        (function (ITextureManager) {
<span id='WOZLLA-renderer-ITextureManager-static-property-DOC'>            /**
</span>             * @property DOC
             * @readonly
             * @static
             * @member WOZLLA.renderer.ITextureManager
             */
            ITextureManager.DOC = &#39;DOC&#39;;
        })(ITextureManager = renderer.ITextureManager || (renderer.ITextureManager = {}));
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var renderer;
    (function (renderer) {
<span id='WOZLLA-renderer-WebGLExtension'>        /**
</span>         * @class WOZLLA.renderer.WebGLExtension
         */
        var WebGLExtension = (function () {
            function WebGLExtension() {
            }
            WebGLExtension.getExtension = function (gl, extName, doThrow) {
                if (doThrow === void 0) { doThrow = true; }
                var ext = gl.getExtension(extName) || gl.getExtension(gl, WebGLExtension.VENDOR_WEBKIT + extName);
                if (ext != null) {
                    return ext;
                }
                else if (doThrow) {
                    throw new Error(&#39;Unsupported extension: &#39; + extName);
                }
            };
            WebGLExtension.VENDOR_WEBKIT = &#39;WEBKIT_&#39;;
            WebGLExtension.PVRTC = &#39;WEBGL_compressed_texture_pvrtc&#39;;
            WebGLExtension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 0x8C02;
            WebGLExtension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 0x8C03;
            return WebGLExtension;
        })();
        renderer.WebGLExtension = WebGLExtension;
    })(renderer = WOZLLA.renderer || (WOZLLA.renderer = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../event/EventDispatcher.ts&quot;/&gt;
/// &lt;reference path=&quot;Assert.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var utils;
    (function (utils) {
        var StateMachine = (function (_super) {
            __extends(StateMachine, _super);
            function StateMachine() {
                _super.apply(this, arguments);
                this._stateConfig = {};
            }
            StateMachine.prototype.defineState = function (name, isDefault) {
                if (isDefault === void 0) { isDefault = false; }
                WOZLLA.Assert.isUndefined(this._stateConfig[name], &#39;state &quot;&#39; + name + &#39;&quot; has been defined&#39;);
                this._stateConfig[name] = {
                    data: {}
                };
                if (isDefault) {
                    this._defaultState = name;
                }
            };
            StateMachine.prototype.getStateData = function (state, key) {
                WOZLLA.Assert.isNotUndefined(this._stateConfig[state], &#39;state &quot;&#39; + state + &#39;&quot; not defined&#39;);
                return this._stateConfig[state].data[key];
            };
            StateMachine.prototype.setStateData = function (state, key, data) {
                WOZLLA.Assert.isNotUndefined(this._stateConfig[state], &#39;state &quot;&#39; + state + &#39;&quot; not defined&#39;);
                this._stateConfig[state].data[key] = data;
            };
            StateMachine.prototype.defineTransition = function (fromState, toState, transition) {
                WOZLLA.Assert.isNotUndefined(this._stateConfig[fromState], &#39;state &quot;&#39; + fromState + &#39;&quot; not defined&#39;);
                WOZLLA.Assert.isNotUndefined(this._stateConfig[toState], &#39;state &quot;&#39; + toState + &#39;&quot; not defined&#39;);
                this._stateConfig[fromState][toState] = transition;
            };
            StateMachine.prototype.init = function () {
                this._currentState = this._defaultState;
                this.dispatchEvent(new WOZLLA.event.Event(StateMachine.INIT, false, new StateEventData(this._currentState)));
            };
            StateMachine.prototype.getCurrentState = function () {
                return this._currentState;
            };
            StateMachine.prototype.changeState = function (state) {
                var _this = this;
                var from, to, transition;
                WOZLLA.Assert.isNotUndefined(this._stateConfig[state]);
                from = this._currentState;
                to = state;
                transition = this._stateConfig[state][to] || EmptyTransition.getInstance();
                if (this._currentTransition) {
                    this._currentTransition.cancel();
                }
                transition.reset();
                transition.execute(from, to, function () {
                    _this._currentTransition = null;
                    _this._currentState = to;
                    _this.dispatchEvent(new WOZLLA.event.Event(StateMachine.CHANGE, false, new StateEventData(_this._currentState)));
                });
                this._currentTransition = transition;
            };
            StateMachine.INIT = &#39;state.init&#39;;
            StateMachine.CHANGE = &#39;state.change&#39;;
            return StateMachine;
        })(WOZLLA.event.EventDispatcher);
        utils.StateMachine = StateMachine;
        var StateEventData = (function () {
            function StateEventData(state) {
                this.state = state;
            }
            return StateEventData;
        })();
        utils.StateEventData = StateEventData;
        var EmptyTransition = (function () {
            function EmptyTransition() {
                this._canceled = false;
            }
            EmptyTransition.getInstance = function () {
                if (!EmptyTransition.instance) {
                    EmptyTransition.instance = new EmptyTransition();
                }
                return EmptyTransition.instance;
            };
            EmptyTransition.prototype.reset = function () {
                this._canceled = false;
            };
            EmptyTransition.prototype.cancel = function () {
                this._canceled = true;
            };
            EmptyTransition.prototype.execute = function (fromState, toState, onComplete) {
                if (this._canceled) {
                    return;
                }
                onComplete();
            };
            return EmptyTransition;
        })();
        utils.EmptyTransition = EmptyTransition;
    })(utils = WOZLLA.utils || (WOZLLA.utils = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;../core/Component.ts&quot;/&gt;
/// &lt;reference path=&quot;../utils/StateMachine.ts&quot;/&gt;
/// &lt;reference path=&quot;../component/renderer/SpriteRenderer.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var ui;
    (function (ui) {
        var StateMachine = WOZLLA.utils.StateMachine;
<span id='WOZLLA-ui-StateWidget'>        /**
</span>         * @class WOZLLA.ui.StateWidget
         * @protected
         */
        var StateWidget = (function (_super) {
            __extends(StateWidget, _super);
            function StateWidget() {
                _super.apply(this, arguments);
                this._stateMachine = new WOZLLA.utils.StateMachine();
            }
            Object.defineProperty(StateWidget.prototype, &quot;spriteAtlas&quot;, {
                get: function () {
                    return this._spriteAtlas;
                },
                set: function (value) {
                    this._spriteAtlas = value;
                },
                enumerable: true,
                configurable: true
            });
            StateWidget.prototype.listRequiredComponents = function () {
                return [WOZLLA.component.SpriteRenderer];
            };
            StateWidget.prototype.init = function () {
                var _this = this;
                this._stateMachine.addListener(StateMachine.INIT, function (e) { return _this.onStateChange(e); });
                this._stateMachine.addListener(StateMachine.CHANGE, function (e) { return _this.onStateChange(e); });
                this._spriteRenderer = this.gameObject.renderer;
                _super.prototype.init.call(this);
            };
            StateWidget.prototype.getStateSpriteName = function (state) {
                return this._stateMachine.getStateData(state, &#39;spriteName&#39;);
            };
            StateWidget.prototype.setStateSpriteName = function (state, spriteName) {
                this._stateMachine.setStateData(state, &#39;spriteName&#39;, spriteName);
            };
            StateWidget.prototype.onStateChange = function (e) {
                this._spriteRenderer.sprite = this._spriteAtlas.getSprite(this.getStateSpriteName(e.data.state));
            };
            return StateWidget;
        })(WOZLLA.Component);
        ui.StateWidget = StateWidget;
    })(ui = WOZLLA.ui || (WOZLLA.ui = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;StateWidget.ts&quot;/&gt;
/// &lt;reference path=&quot;../component/renderer/SpriteRenderer.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var ui;
    (function (ui) {
<span id='WOZLLA-ui-Button'>        /**
</span>         * @class WOZLLA.ui.Button
         */
        var Button = (function (_super) {
            __extends(Button, _super);
            function Button() {
                _super.call(this);
                this._stateMachine.defineState(Button.STATE_NORMAL, true);
                this._stateMachine.defineState(Button.STATE_DISABLED);
                this._stateMachine.defineState(Button.STATE_PRESSED);
            }
            Object.defineProperty(Button.prototype, &quot;normalSpriteName&quot;, {
                get: function () {
                    return this.getStateSpriteName(Button.STATE_NORMAL);
                },
                set: function (spriteName) {
                    this.setStateSpriteName(Button.STATE_NORMAL, spriteName);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Button.prototype, &quot;disabledSpriteName&quot;, {
                get: function () {
                    return this.getStateSpriteName(Button.STATE_DISABLED);
                },
                set: function (spriteName) {
                    this.setStateSpriteName(Button.STATE_DISABLED, spriteName);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(Button.prototype, &quot;pressedSpriteName&quot;, {
                get: function () {
                    return this.getStateSpriteName(Button.STATE_PRESSED);
                },
                set: function (spriteName) {
                    this.setStateSpriteName(Button.STATE_PRESSED, spriteName);
                },
                enumerable: true,
                configurable: true
            });
            Button.prototype.init = function () {
                var _this = this;
                this.gameObject.addListener(&#39;touch&#39;, function (e) { return _this.onTouch(e); });
                this.gameObject.addListener(&#39;release&#39;, function (e) { return _this.onRelease(e); });
                this.gameObject.addListener(&#39;tap&#39;, function (e) { return _this.onTap(e); });
                this._stateMachine.init();
                _super.prototype.init.call(this);
            };
            Button.prototype.destroy = function () {
                this._stateMachine.clearAllListeners();
                _super.prototype.destroy.call(this);
            };
            Button.prototype.isEnabled = function () {
                return this._stateMachine.getCurrentState() !== Button.STATE_DISABLED;
            };
            Button.prototype.setEnabled = function (enabled) {
                if (enabled === void 0) { enabled = true; }
                this._stateMachine.changeState(enabled ? Button.STATE_NORMAL : Button.STATE_DISABLED);
                this._gameObject.touchable = enabled;
            };
            Button.prototype.onTouch = function (e) {
                this._stateMachine.changeState(Button.STATE_PRESSED);
            };
            Button.prototype.onRelease = function (e) {
                this._stateMachine.changeState(Button.STATE_NORMAL);
            };
            Button.prototype.onTap = function (e) {
            };
            Button.STATE_NORMAL = &#39;normal&#39;;
            Button.STATE_DISABLED = &#39;disabled&#39;;
            Button.STATE_PRESSED = &#39;pressed&#39;;
            return Button;
        })(ui.StateWidget);
        ui.Button = Button;
    })(ui = WOZLLA.ui || (WOZLLA.ui = {}));
})(WOZLLA || (WOZLLA = {}));
/// &lt;reference path=&quot;StateWidget.ts&quot;/&gt;
/// &lt;reference path=&quot;../component/renderer/SpriteRenderer.ts&quot;/&gt;
var WOZLLA;
(function (WOZLLA) {
    var ui;
    (function (ui) {
<span id='WOZLLA-ui-CheckBox'>        /**
</span>         * @class WOZLLA.ui.CheckBox
         */
        var CheckBox = (function (_super) {
            __extends(CheckBox, _super);
            function CheckBox() {
                _super.call(this);
                this._stateMachine.defineState(CheckBox.STATE_UNCHECKED, true);
                this._stateMachine.defineState(CheckBox.STATE_DISABLED);
                this._stateMachine.defineState(CheckBox.STATE_CHECKED);
            }
            Object.defineProperty(CheckBox.prototype, &quot;uncheckedSpriteName&quot;, {
                get: function () {
                    return this.getStateSpriteName(CheckBox.STATE_UNCHECKED);
                },
                set: function (spriteName) {
                    this.setStateSpriteName(CheckBox.STATE_UNCHECKED, spriteName);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(CheckBox.prototype, &quot;disabledSpriteName&quot;, {
                get: function () {
                    return this.getStateSpriteName(CheckBox.STATE_DISABLED);
                },
                set: function (spriteName) {
                    this.setStateSpriteName(CheckBox.STATE_DISABLED, spriteName);
                },
                enumerable: true,
                configurable: true
            });
            Object.defineProperty(CheckBox.prototype, &quot;checkedSpriteName&quot;, {
                get: function () {
                    return this.getStateSpriteName(CheckBox.STATE_CHECKED);
                },
                set: function (spriteName) {
                    this.setStateSpriteName(CheckBox.STATE_CHECKED, spriteName);
                },
                enumerable: true,
                configurable: true
            });
            CheckBox.prototype.init = function () {
                var _this = this;
                this._gameObject.addListener(&#39;tap&#39;, function (e) { return _this.onTap(e); });
                this._stateMachine.init();
                _super.prototype.init.call(this);
            };
            CheckBox.prototype.destroy = function () {
                this._stateMachine.clearAllListeners();
                _super.prototype.destroy.call(this);
            };
            CheckBox.prototype.isEnabled = function () {
                return this._stateMachine.getCurrentState() !== CheckBox.STATE_DISABLED;
            };
            CheckBox.prototype.setEnabled = function (enabled) {
                if (enabled === void 0) { enabled = true; }
                this._stateMachine.changeState(enabled ? CheckBox.STATE_UNCHECKED : CheckBox.STATE_DISABLED);
                this._gameObject.touchable = enabled;
            };
            CheckBox.prototype.onTap = function (e) {
                if (this._stateMachine.getCurrentState() === CheckBox.STATE_CHECKED) {
                    this._stateMachine.changeState(CheckBox.STATE_UNCHECKED);
                }
                else {
                    this._stateMachine.changeState(CheckBox.STATE_CHECKED);
                }
            };
            CheckBox.STATE_UNCHECKED = &#39;unchecked&#39;;
            CheckBox.STATE_CHECKED = &#39;checked&#39;;
            CheckBox.STATE_DISABLED = &#39;disabled&#39;;
            return CheckBox;
        })(ui.StateWidget);
        ui.CheckBox = CheckBox;
    })(ui = WOZLLA.ui || (WOZLLA.ui = {}));
})(WOZLLA || (WOZLLA = {}));
var WOZLLA;
(function (WOZLLA) {
    var utils;
    (function (utils) {
        var Ease = (function () {
            function Ease() {
            }
            Ease.get = function (amount) {
                if (amount &lt; -1) {
                    amount = -1;
                }
                if (amount &gt; 1) {
                    amount = 1;
                }
                return function (t) {
                    if (amount == 0) {
                        return t;
                    }
                    if (amount &lt; 0) {
                        return t * (t * -amount + 1 + amount);
                    }
                    return t * ((2 - t) * amount + (1 - amount));
                };
            };
            Ease.getPowIn = function (pow) {
                return function (t) {
                    return Math.pow(t, pow);
                };
            };
            Ease.getPowOut = function (pow) {
                return function (t) {
                    return 1 - Math.pow(1 - t, pow);
                };
            };
            Ease.getPowInOut = function (pow) {
                return function (t) {
                    if ((t *= 2) &lt; 1)
                        return 0.5 * Math.pow(t, pow);
                    return 1 - 0.5 * Math.abs(Math.pow(2 - t, pow));
                };
            };
            Ease.sineIn = function (t) {
                return 1 - Math.cos(t * Math.PI / 2);
            };
            Ease.sineOut = function (t) {
                return Math.sin(t * Math.PI / 2);
            };
            Ease.sineInOut = function (t) {
                return -0.5 * (Math.cos(Math.PI * t) - 1);
            };
            Ease.getBackIn = function (amount) {
                return function (t) {
                    return t * t * ((amount + 1) * t - amount);
                };
            };
            Ease.getBackOut = function (amount) {
                return function (t) {
                    t = t - 1;
                    return (t * t * ((amount + 1) * t + amount) + 1);
                };
            };
            Ease.getBackInOut = function (amount) {
                amount *= 1.525;
                return function (t) {
                    if ((t *= 2) &lt; 1)
                        return 0.5 * (t * t * ((amount + 1) * t - amount));
                    return 0.5 * ((t -= 2) * t * ((amount + 1) * t + amount) + 2);
                };
            };
            Ease.circIn = function (t) {
                return -(Math.sqrt(1 - t * t) - 1);
            };
            Ease.circOut = function (t) {
                return Math.sqrt(1 - (t) * t);
            };
            Ease.circInOut = function (t) {
                if ((t *= 2) &lt; 1) {
                    return -0.5 * (Math.sqrt(1 - t * t) - 1);
                }
                return 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);
            };
            Ease.bounceIn = function (t) {
                return 1 - Ease.bounceOut(1 - t);
            };
            Ease.bounceOut = function (t) {
                if (t &lt; 1 / 2.75) {
                    return (7.5625 * t * t);
                }
                else if (t &lt; 2 / 2.75) {
                    return (7.5625 * (t -= 1.5 / 2.75) * t + 0.75);
                }
                else if (t &lt; 2.5 / 2.75) {
                    return (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375);
                }
                else {
                    return (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375);
                }
            };
            Ease.bounceInOut = function (t) {
                if (t &lt; 0.5)
                    return Ease.bounceIn(t * 2) * .5;
                return Ease.bounceOut(t * 2 - 1) * 0.5 + 0.5;
            };
            Ease.getElasticIn = function (amplitude, period) {
                var pi2 = Math.PI * 2;
                return function (t) {
                    if (t == 0 || t == 1)
                        return t;
                    var s = period / pi2 * Math.asin(1 / amplitude);
                    return -(amplitude * Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * pi2 / period));
                };
            };
            Ease.getElasticOut = function (amplitude, period) {
                var pi2 = Math.PI * 2;
                return function (t) {
                    if (t == 0 || t == 1)
                        return t;
                    var s = period / pi2 * Math.asin(1 / amplitude);
                    return (amplitude * Math.pow(2, -10 * t) * Math.sin((t - s) * pi2 / period) + 1);
                };
            };
            Ease.getElasticInOut = function (amplitude, period) {
                var pi2 = Math.PI * 2;
                return function (t) {
                    var s = period / pi2 * Math.asin(1 / amplitude);
                    if ((t *= 2) &lt; 1)
                        return -0.5 * (amplitude * Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * pi2 / period));
                    return amplitude * Math.pow(2, -10 * (t -= 1)) * Math.sin((t - s) * pi2 / period) * 0.5 + 1;
                };
            };
            Ease.linear = function (t) {
                return t;
            };
            Ease.expoIn = function (time) {
                return time == 0 ? 0 : Math.pow(2, 10 * (time - 1)) - 0.001;
            };
            Ease.expoOut = function (time) {
                return time == 1 ? 1 : (-Math.pow(2, -10 * time) + 1);
            };
            Ease.expoInOut = function (time) {
                time /= 0.5;
                if (time &lt; 1) {
                    time = 0.5 * Math.pow(2, 10 * (time - 1));
                }
                else {
                    time = 0.5 * (-Math.pow(2, -10 * (time - 1)) + 2);
                }
                return time;
            };
            Ease.getByKey = function (key) {
                return Ease[Ease.keyMap[key]];
            };
            Ease.quadIn = Ease.getPowIn(2);
            Ease.quadOut = Ease.getPowOut(2);
            Ease.quadInOut = Ease.getPowInOut(2);
            Ease.cubicIn = Ease.getPowIn(3);
            Ease.cubicOut = Ease.getPowOut(3);
            Ease.cubicInOut = Ease.getPowInOut(3);
            Ease.quartIn = Ease.getPowIn(4);
            Ease.quartOut = Ease.getPowOut(4);
            Ease.quartInOut = Ease.getPowInOut(4);
            Ease.quintIn = Ease.getPowIn(5);
            Ease.quintOut = Ease.getPowOut(5);
            Ease.quintInOut = Ease.getPowInOut(5);
            Ease.backIn = Ease.getBackIn(1.7);
            Ease.backOut = Ease.getBackOut(1.7);
            Ease.backInOut = Ease.getBackInOut(1.7);
            Ease.elasticIn = Ease.getElasticIn(1, 0.3);
            Ease.elasticOut = Ease.getElasticOut(1, 0.3);
            Ease.elasticInOut = Ease.getElasticInOut(1, 0.3 * 1.5);
            Ease.keyMap = {
                0: &#39;linear&#39;,
                1: &#39;sineIn&#39;,
                2: &#39;sineOut&#39;,
                3: &#39;sineInOut&#39;,
                4: &#39;quadIn&#39;,
                5: &#39;quadOut&#39;,
                6: &#39;quadInOut&#39;,
                7: &#39;cubicIn&#39;,
                8: &#39;cubicOut&#39;,
                9: &#39;cubicInOut&#39;,
                10: &#39;quartIn&#39;,
                11: &#39;quartOut&#39;,
                12: &#39;quartInOut&#39;,
                13: &#39;quintIn&#39;,
                14: &#39;quintOut&#39;,
                15: &#39;quintInOut&#39;,
                16: &#39;expoIn&#39;,
                17: &#39;expoOut&#39;,
                18: &#39;expoInOut&#39;,
                19: &#39;circIn&#39;,
                20: &#39;circOut&#39;,
                21: &#39;circInOut&#39;,
                22: &#39;elasticIn&#39;,
                23: &#39;elasticOut&#39;,
                24: &#39;elasticInOut&#39;,
                25: &#39;backIn&#39;,
                26: &#39;backOut&#39;,
                27: &#39;backInOut&#39;,
                28: &#39;bounceIn&#39;,
                29: &#39;bounceOut&#39;,
                30: &#39;bounceInOut&#39;
            };
            return Ease;
        })();
        utils.Ease = Ease;
    })(utils = WOZLLA.utils || (WOZLLA.utils = {}));
})(WOZLLA || (WOZLLA = {}));
</pre>
</body>
</html>
